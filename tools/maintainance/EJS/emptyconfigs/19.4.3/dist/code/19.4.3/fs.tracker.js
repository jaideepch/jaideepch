/***************************************
* @preserve
* ForeSee Web SDK: Tracker Window
* Built April 27, 19 22:00:31
* Code version: 19.4.3
* Template version: 19.4.3
***************************************/
_fsDefine(["require","fs",_fsNormalizeUrl("fs.utils.js")],function(e,t,i){i.siteKey=t.getParam("sitekey"),t.config&&!t.config.storage&&(t.config.storage=t.getParam("stg")),t.config.brainUrl=t.getParam("brain_url")||t.config.brainUrl;var s={INVITE_SHOWN:"fs_inviteShown",INVITE_ACCEPTED:"fs_inviteAccepted",INVITE_DECLINED:"fs_inviteDeclined",INVITE_ABANDONED:"fs_inviteAbandoned",TRACKER_SHOWN:"fs_trackerShown",TRACKER_CLICKED:"fs_trackerClicked",QUALIFIER_ACCEPTED:"fs_qualifierAccepted",QUALIFIER_DECLINED:"fs_qualifierDeclined",QUALIFIER_SHOWN:"fs_qualifierShown",REMINDER_SHOWN:"fs_reminderShown",REMINDER_ACCEPTED:"fs_reminderAccepted",SURVEY_SHOWN:"fs_surveyShown"},r=function(e,t){var i;return i=new window.Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"),t?i(t):i},a=function(e){this.gs=e};a.prototype={_extras:{},set:function(e,t){this.all()[e]=t,this._extras[e]=t},get:function(e){return this.all()[e]},all:function(){return t.ext({},this.gs.get("cp")||{},this._extras)},toQueryString:function(){var e=[],i=this.all();for(var s in i)e.push("cpp["+t.enc(s)+"]="+t.enc(i[s]));return e.join("&")},erase:function(e){var t=this.all();delete t[e],this.gs.set("cp",t)},append:function(e,t,i){var s=this.gs.get("cp")||{};if(s[e]=(s[e]||"")+","+t,i){var r=s[e].split(","),a=r.length-1,n=r.length>i?r.length-i:0;s[e]=r.splice(n,a-n+1).join()}this.gs.set("cp",s)}};var n=function(e,s,r,a,n,o){this.br=e,this.data=r,this.qual=a,this.cpps=s,this.templatehtml=n,this.displayOpts=o,this.userLocale=this.data.def.language.locale||"en",this.qualified=new i.FSEvent,this.disqualified=new i.FSEvent,this.validationFailed=new i.FSEvent,this.qualifiesValue=null,"en"!==this.userLocale&&t.isDefined(this.data.def.qualifier.survey.locales[this.userLocale])&&(this.qual.survey=t.ext({},this.data.def.qualifier.survey.locales[this.userLocale]));for(var l,c=this.qual.survey.questions.length,h=0;h<c;h++){l=this.qual.survey.questions[h];for(var u=0;u<l.choices.length;u++)t.ext(l.choices[u],{id:"q"+h+"c"+u,value:"q"+h+"c"+u,name:"q"+h,type:t.toLowerCase(l.questionType)})}this.disqualified.subscribe(t.proxy(function(){this.showNoThanks()},this)),this.validationFailed.subscribe(t.proxy(function(e){alert(e)},this))};n.prototype.render=function(){var e=t.ext({},this.displayOpts,{qual:this.qual});document.documentElement.setAttribute("id","fsrQualifier"),document.body.innerHTML=r(this.templatehtml,e),i.Bind(document.getElementById("qualifierForm"),"qualifier:submit",t.proxy(function(e){i.preventDefault(e),this.validateAndSubmit()},this)),i.Bind(document.getElementById("qualCancelButton"),"qualifier:click",t.proxy(function(e){i.preventDefault(e),this.disqualified.fire()},this)),i.Bind(document.getElementById("qualCloseButton"),"qualifier:click",t.proxy(function(e){i.preventDefault(e),window.close()},this))},n.prototype.validateAndSubmit=function(){for(var e=document.querySelectorAll(".activeQuestion"),t=[],i=!1,s=0;s<e.length;s++){var r=parseInt(e[s].getAttribute("questionNum")),a=this.qual.survey.questions[r];if("RADIO"==a.questionType){for(var n=document.getElementsByName("q"+r),o=!1,l=0;l<n.length;l++)if(n[l].checked){o=!0,t.push(a.choices[l]);break}if(!o){i=!0;break}}}if(i)this.validationFailed.fire(this.qual.survey.validationFailedMsg);else{for(var c=!1,h=0;h<t.length;h++){var u=t[h];if(this.qualifiesValue=u.qualifies||null,u.cpps&&u.cpps.length>0)for(var d=0;d<u.cpps.length;d++)for(var f in u.cpps[d])this.cpps.set(f,u.cpps[d][f]);if(!1===u.qualifies){c=!0;break}}!0===c?this.disqualified.fire():this.qualified.fire()}},n.prototype.showNoThanks=function(){i.addClass(document.getElementById("fsrQualifierMain"),"acsNoDisplay"),i.removeClass(document.getElementById("fsrQualifierNoThanks"),"acsNoDisplay")};var o=function(e,t,s,r,a,n){this.br=e,this.data=s,this.rmdr=r,this.lng=s.def.language.locale,this.cpps=t,this.templatehtml=a,this.displayOpts=n,this.accepted=new i.FSEvent};o.prototype.render=function(){var e,s;document.documentElement.setAttribute("id","fsrReminder"),s=t.ext({},this.rmdr),"en"!==this.lng&&t.isDefined(this.rmdr.display.locales[this.lng])&&(s.display=this.rmdr.display.locales[this.lng]),e=t.ext({},this.displayOpts,{rmdr:s}),document.body.innerHTML=r(this.templatehtml,e),i.Bind(document.getElementById("reminderForm"),"reminder:submit",t.proxy(function(e){i.preventDefault(e),this.accepted.fire()},this))},function(e,t){this.cfg=e.cfg.config,this.cm=new p(t)}.prototype.get=function(e){var t=this.cm.get(this.cfg.site_id);if(t&&(t=JSON.parse(t),t["acs.t"]))return t=JSON.parse(t["acs.t"]),t[e]};var l=function(config,e,t,i){this.cfg=config,this.cpps=e,this.def=t,this.qual=i};l.prototype.getUrl=function(){var e=t.enc,s=this.def,r=t.config.surveyUrl+"?",a=i.now()+"_"+Math.round(1e13*Math.random()),n=s.name+"-"+(t.isDefined(s.site)?s.site+"-":"")+(t.isDefined(s.section)?this.def.section+"-":"")+(this.cpps.get("locale")||s.language.locale);this.qual&&(n+="-"+this.qual.qualifiesValue);var o={sid:e(n),cid:e(this.cfg.config.id),pattern:e(this.cpps.get(s.pattern)),a:a,b:i.hash(a),c:864e5};for(var l in o)r+=t.enc(l)+"="+t.enc(o[l])+"&";return r+=this.cpps.toQueryString()};var c="undefined"!=typeof config?config.config.surveyAsyncCurl:"i.4see.mobi";if({SERVICE_TYPES:{survey:{host:"survey.foreseeresults.com",path:"/survey",url:"/display",protocol:"https"},mobileOnExitInitialize:{host:c,path:"/e",url:"/initialize"},mobileOnExitHeartbeat:{host:c,path:"/e",url:"/recordHeartbeat"},check:{host:"controller.4seeresults.com",path:"/fsrSurvey",url:"/OTCImg",success:3},event:{host:"events.foreseeresults.com",path:"/rec",url:"/process?event=logit"},domain:{host:"survey.foreseeresults.com",path:"/survey",url:"/FSRImg",success:3},replay:{host:"replaycontroller.4seeresults.com",path:"/images",enabled:!0}}}.ping=function(e,t,s,r){(new i.ImageTransport).send({url:"https://"+e.host+e.path+(e.url||""),success:s||function(){},failure:r||function(){},data:t})},!window.btoa){var h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);window.btoa=function(e){var t,i,s,r,a,n;for(s=e.length,i=0,t="";s>i;){if(r=255&e.charCodeAt(i++),i==s){t+=h.charAt(r>>2),t+=h.charAt((3&r)<<4),t+="==";break}if(a=e.charCodeAt(i++),i==s){t+=h.charAt(r>>2),t+=h.charAt((3&r)<<4|(240&a)>>4),t+=h.charAt((15&a)<<2),t+="=";break}n=e.charCodeAt(i++),t+=h.charAt(r>>2),t+=h.charAt((3&r)<<4|(240&a)>>4),t+=h.charAt((15&a)<<2|(192&n)>>6),t+=h.charAt(63&n)}return t},window.atob=function(e){var t,i,s,r,a,n,o;for(n=e.length,a=0,o="";n>a;){do{t=u[255&e.charCodeAt(a++)]}while(n>a&&-1==t);if(-1==t)break;do{i=u[255&e.charCodeAt(a++)]}while(n>a&&-1==i);if(-1==i)break;o+=String.fromCharCode(t<<2|(48&i)>>4);do{if(61==(s=255&e.charCodeAt(a++)))return o;s=u[s]}while(n>a&&-1==s);if(-1==s)break;o+=String.fromCharCode((15&i)<<4|(60&s)>>2);do{if(61==(r=255&e.charCodeAt(a++)))return o;r=u[r]}while(n>a&&-1==r);if(-1==r)break;o+=String.fromCharCode((3&s)<<6|r)}return o}}var d=function(e,s,r){var n=r.cfg.config;this.br=e,this.stg=s,this.data=r,this.jrny=new i.Journey(n.id,n.site_id,s.get("rid"),e,50),this.cpps=new a(this.stg),this._loadResources(t.proxy(function(){document.documentElement.style.backgroundImage="none",this.ready.fire(),s.onSync.subscribe(t.proxy(function(){s.get("page_hb")||(s.onSync.unsubscribeAll(),s.setUpdateInterval(6e3),this.launchSurveyOrQualifier(),this.data.display.removeSurveyAlerts||setTimeout(t.proxy(function(){var e=t.toLowerCase(navigator.userAgent);-1==e.indexOf("msie")&&-1==e.indexOf("edge")&&-1==e.indexOf("firefox")&&this.data.display.dialog&&alert(this.data.display.dialog.surveyavailable)},this),200))},this))},this)),this.ready=new i.FSEvent};d.prototype.update=function(e,t,i){this.br=e,this.stg=t,this.data=i},d.prototype.setCPPS=function(e){if(e)for(var t in e)this.cpps.set(t,e[t])},d.prototype._loadResources=function(e){var s=this.data.template,r=s.indexOf("@")>-1,a=t.makeURI("templates/trigger/"+s+"/main.css"),n=t.makeURI("templates/trigger/"+s+"/tracker.html"),o=t.makeURI("templates/trigger/"+s+"/qualifier.html"),l=t.makeURI("templates/trigger/"+s+"/reminder.html"),c=t.getParam("gw");r&&(s=s.substr(1),t.isSelfHosted?(a=t.makeAssetURI("trigger/templates/"+s+"/main.css"),n=t.makeAssetURI("trigger/templates/"+s+"/tracker.html"),o=t.makeAssetURI("trigger/templates/"+s+"/qualifier.html"),l=t.makeAssetURI("trigger/templates/"+s+"/reminder.html")):(a=c.replace(/__gwtest__/g,"templates/"+s+"/main.css"),n=c.replace(/__gwtest__/g,"templates/"+s+"/tracker.html"),o=c.replace(/__gwtest__/g,"templates/"+s+"/qualifier.html"),l=c.replace(/__gwtest__/g,"templates/"+s+"/reminder.html"))),this.queue=new i.Async(!0,t.proxy(function(){e&&e()},this),t.proxy(function(){},this)),this.queue.enqueue(t.proxy(function(e){i.loadCSS(a,t.proxy(function(t){this._cssLink=t,e&&e.resolve()},this),null,this.br)},this)),this.queue.enqueue(t.proxy(function(e){new i.JSONP({success:t.proxy(function(t){this.templatehtml=t,e&&e.resolve()},this)}).get(n,"templates_trigger_"+s+"_")},this)),this.queue.enqueue(t.proxy(function(e){new i.JSONP({success:t.proxy(function(t){this.qualhtml=t,e&&e.resolve()},this)}).get(o,"templates_trigger_"+s+"_")},this)),this.queue.enqueue(t.proxy(function(e){new i.JSONP({success:t.proxy(function(t){this.rmdrhtml=t,e&&e.resolve()},this)}).get(l,"templates_trigger_"+s+"_")},this))},d.prototype.renderTemplate=function(){this.data.display.inviteType=this.data.display.inviteType.toUpperCase();var e=t.ext({copyrightDate:(new Date).getFullYear().toString(),supportsSVG:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")},this.data.display,this.data.cfg.config),a=t.getParam("gw");e.trackerLogo&&e.trackerLogo.length>0&&(t.isDefined(t.assetLocation)&&"undefined"!=t.assetLocation?e.trackerLogo=t.makeAssetURI("trigger/"+e.trackerLogo):e.trackerLogo=a.replace(/__gwtest__/g,e.trackerLogo)),e.vendorLogo&&e.vendorLogo.length>0&&(e.vendorLogo=t.makeAssetURI(e.vendorLogo)),e.vendorLogoPNG&&e.vendorLogoPNG.length>0&&(e.vendorLogoPNG=t.makeAssetURI(e.vendorLogoPNG)),e.trusteLogo&&e.trusteLogo.length>0&&(e.trusteLogo=t.makeAssetURI(e.trusteLogo)),e.loadImg=t.makeURI("loadimg.gif"),this._displayOpts=e,document.title=e.dialog.trackerTitle,document.body.innerHTML=r(this.templatehtml,e),this._doSizing(),this._cvTimeout=setTimeout(t.proxy(function(){this._convertTracker()},this),this.data.cfg.config.trackerConvertsAfter),i.Bind(window,"tracker:resize",t.proxy(function(){this._doSizing()},this)),this.jrny.addEventString(s.TRACKER_SHOWN)},d.prototype._doSizing=function(){var e=document.querySelectorAll("*[acsfill=true]"),t=i.getSize(window);if(e)for(var s=0;s<e.length;s++){var r=e[s],a=r.offsetLeft,n=r.offsetTop;r.style.height=t.h-n-1*a+"px"}var o=document.querySelectorAll("*[acscentervertically=true]");if(o)for(var l=0;l<o.length;l++){var c=o[l],h=c.offsetHeight,u=c.parentNode.offsetHeight;c.style.marginTop=(u-h)/2+"px"}},d.prototype._convertTracker=function(){var e,r=document.querySelectorAll(".initialContent");for(e=0;e<r.length;e++)i.addClass(r[e],"acsNoDisplay");var a=document.querySelectorAll(".showLater");for(e=0;e<a.length;e++)i.addClass(a[e],"acsDisplay");this._doSizing(),i.addClass(document.body,"acsActiveTracker");var n=document.querySelectorAll("*[acsactivatebutton=true]"),o=t.proxy(function(){this.jrny.addEventString(s.TRACKER_CLICKED),this.launchSurveyOrQualifier()},this),l=function(e){13===(window.event?e.which:e.keyCode)&&o()};for(e=0;e<n.length;e++)i.Bind(n[e],"click",o),i.Bind(n[e],"keydown",l)},d.prototype.launchSurveyOrQualifier=function(){this._cvTimeout&&(clearTimeout(this._cvTimeout),this._cvTimeout=null);for(var e=document.querySelectorAll("*[acsshowwhenloading=true]"),t=0;t<e.length;t++)i.addClass(e[t],"acsDisplay");for(var s=document.querySelectorAll("*[acshidewhenloading=true]"),r=0;r<s.length;r++)i.removeClass(s[r],"acsDisplay"),i.addClass(s[r],"acsNoDisplay");var a=this.data.def.qualifier,n=this.data.def.reminder;a&&a.useQualifier?this.goToQualifier():n&&n.useReminder?this.goToReminder():this.goToSurvey(null)},d.prototype.goToQualifier=function(){this.qualifier=new n(this.br,this.cpps,this.data,this.data.def.qualifier,this.qualhtml,this._displayOpts),this.qualifier.qualified.subscribe(t.proxy(function(){this.jrny.addEventString(s.QUALIFIER_ACCEPTED),this.goToSurvey(this.qualifier)},this),!0,!1),this.qualifier.disqualified.subscribe(t.proxy(function(){this.jrny.addEventString(s.QUALIFIER_DECLINED)},this),!0,!1),this.qualifier.render(),this.jrny.addEventString(s.QUALIFIER_SHOWN)},d.prototype.goToReminder=function(){this.reminder=new o(this.br,this.cpps,this.data,this.data.def.reminder,this.rmdrhtml,this._displayOpts),this.reminder.accepted.subscribe(t.proxy(function(){this.jrny.addEventString(s.REMINDER_ACCEPTED),this.goToSurvey()},this),!0,!1),this.reminder.render(),this.jrny.addEventString(s.REMINDER_SHOWN)},d.prototype.goToSurvey=function(e){this.jrny.addEventString(s.SURVEY_SHOWN);var i=new l(this.data.cfg,this.cpps,this.data.def,this.qualifier),r=i.getUrl();window.resizeBy(0,200),window.focus(),setTimeout(t.proxy(function(){this._doSizing(),window.location=r},this),100)};var f,p=function(e){if(f)return f;if(f=this,this.someCommunicationReceived=new i.FSEvent,this.messageReceived=new i.FSEvent,this.br=e,this.useAlt=e.isIE||"Safari"==e.browser.name||!e.supportsLocalStorage,this._trnsInterval=25,this._altVals={},this.useAlt){this._commands={};var s=t.toLowerCase(window.location.host.toString()).replace(/www\./gi,"");s.indexOf(":")>-1&&(s=s.substr(0,s.indexOf(":")));var r=new Date;r.setTime(r.getTime()+31536e6);var a={path:"/",domain:s,secure:!1,encode:!0,expires:r.toGMTString()};this._ck=new i.Cookie(a)}this._transportTimer=setInterval(t.proxy(function(){var e;this._ck?(e=this._ck.get("_fsuid"))&&this._ck.set("_fruid",e):(e=localStorage.getItem("_fsuid"))&&localStorage.setItem("_fruid",e),e&&this._init()},this),5*this._trnsInterval)};p.prototype._init=function(){clearInterval(this._transportTimer),this._ck?this._cktimer=setInterval(t.proxy(function(){var e=this._ck.get("fsmsg");e&&(this.someCommunicationReceived.fire(),e=JSON.parse(e),this._ck.kill("fsmsg"),this._ck.set("fsmsgrec",e.id),this._commands[e.t]||(this._commands[e.t]={t:e.t,k:e.k,d:[]}),this._commands[e.t].d.push(e.d),e.f&&(this._altVals[e.k]=JSON.parse(i.Compress.decompress(this._commands[e.t].d.join(""))),this.messageReceived.fire(e.k,this._altVals[e.k].v)))},this),this._trnsInterval):this.br.supportsLocalStorage&&(this._lsT=setInterval(t.proxy(function(){for(var e in localStorage)e.indexOf("__fsFr__")>-1&&(e=e.replace("__fsFr__",""),this.get(e))},this),150))},p.prototype.set=function(e,t){this._altVals[e]=t,this._ck&&this._ck.set(e,t),this.br.supportsLocalStorage&&localStorage.setItem(e,t)},p.prototype._extractValFromAlt=function(e){if(this._altVals[e])return this._altVals[e].x&&(new Date).getTime()>this._altVals[e].x?void delete this._altVals[e]:this._altVals[e].v},p.prototype._maint=function(){var e=i.now();for(var t in this._altVals)this._altVals[t].x&&this._altVals[t].x<e&&delete this._altVals[t]},p.prototype.get=function(e){if(this._maint(),!this._extractValFromAlt(e)&&this.br.supportsLocalStorage){var t="__fsFr__"+e,i=localStorage.getItem(t);if(i){i=JSON.parse(decodeURIComponent(i)),this._altVals[e]=i,localStorage.removeItem(t);var s=(new Date).getTime();i.x&&i.x<s?(delete this._altVals[e],this.messageReceived.fire()):this.messageReceived.fire(e,i.v)}}return this._extractValFromAlt(e)},p.prototype.kill=function(e){this._ck&&this._ck.kill(e),this.br.supportsLocalStorage&&(localStorage.removeItem(e),localStorage.removeItem("__fsFr__"+e)),delete this._altVals[e]},t.winReady(function(){var e=setTimeout(function(){window.close()},7e3);document.cookie="fsIce=broke";var s,r,a=new i.Browser;a.ready.subscribe(function(){var n,o=t.getParam("stg");if(o==i.storageTypes.CK||o==i.storageTypes.DS){n=new p(a);var l,c,h=new i.FSEvent,u=!1,f=t.proxy(function(i,f){var p=n.get("trackerinfo"),m=n.get("hb_i"),v=n.get("ckcpps"),y=n.get("trackercmd"),_=n.get("defupdate");if(_&&r&&(r.data.def.name=_.name),p&&(l=p,r&&(r.data=p)),m&&(c=m),v&&(s=v,n.kill("ckcpps"),r&&r.ready.subscribe(function(){r&&r.setCPPS(s)},!0,!0)),y)switch(y.method){case"close":window.close();break;case"survey":r&&r.goToSurvey&&r.goToSurvey()}h.fire(),l&&c&&!u&&(u=!0,n.kill("hb_i"),n.kill("trackerinfo"),clearInterval(g),r=new d(a,{onSync:h,get:function(e){return"rid"===e?t.getParam("uid"):n.get(e)},setUpdateInterval:function(){},cfg:{persistence:o,brain_url:t.getParam("brain_url")}},l),window.Tracker=r,r.ready.subscribe(function(){clearTimeout(e),s&&r.setCPPS(s),r.renderTemplate()},!0,!1),setInterval(t.proxy(function(){h.fire()},this),2e3))},this),g=setInterval(f,150);n.messageReceived.subscribe(f,!1,!0)}else{var m=i.getGlobalStore(a,t.getParam("uid"));m.ready.subscribe(t.proxy(function(){m.setUpdateInterval(1e3),m.watchForChanges(["trackerinfo","trackercmd"],t.proxy(function(i,n,o){if("trackercmd"==i)switch(o.method){case"close":window.close();break;case"survey":r&&r.goToSurvey&&r.goToSurvey()}m.setUpdateInterval(m.get("hb_i")),t.isDefined(r)?r.update(a,m,o):r=new d(a,m,o),window.Tracker=r,r.ready.subscribe(function(){clearTimeout(e),s&&r.setCPPS(s),r.renderTemplate()},!0,!1)},this),!1,!0)},this),!0,!0)}},!0,!0)})});