/***************************************
* @preserve
* ForeSee Web SDK: Feedback Standalone Survey
* Built April 28, 19 00:16:39
* Code version: 19.8.1
* Template version: 19.8.1
***************************************/
_fsDefine(["require","fs",_fsNormalizeUrl("$fs.utils.js"),_fsNormalizeUrl("$fs.survey.js")],function(e,fs,utils,f){
/**
 * @preserve
 * @@CONFIG_GOES_HERE@@
 */
var s={remove:function(){this.parentNode&&this.parentNode.removeChild(this)},hasClass:function(e){return-1<this.className.indexOf(e)},addClass:function(e){this.hasClass(e)||(this.className+=" "+e)},removeClass:function(e){this.className=(this.className||"").replace(e,""),this.className=this.className.replace(/[ ]+$/g,"")},$:function(e){return this.querySelectorAll(e)},css:function(e){for(var t in e)e.hasOwnProperty(t)&&(this.style[t]=e[t])}},m=function(e){if("string"==typeof e&&-1==e.indexOf("<"))return document.querySelectorAll(e);if("string"==typeof e){var t=document.createElement("div");t.innerHTML=e,e=t.firstChild}for(var i in s)s.hasOwnProperty(i)&&(e[i]=s[i]);return e},v=function(){this.$el=m('<img src="'+_fsNormalizeUrl("$loader.gif")+'" class="acs-loader">'),this.$el.setAttribute("alt","loading survey"),this.$el.setAttribute("tabindex","-1"),this.$el.setAttribute("role","alert"),this.$el.setAttribute("aria-busy","true"),this.moveOffScreen()};v.prototype.center=function(){var e=utils.getSize(window),fs=utils.getScroll(window),t=this.$el.offsetWidth,i=this.$el.offsetHeight;this.$el.css({left:(e.w-t)/2+"px",top:(e.h-i)/2+fs.y+"px",display:"block",position:"absolute"})},v.prototype.moveOffScreen=function(){this.$el.css({left:"-999px",top:"-999px",display:"none"})},v.prototype.remove=function(){this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)};var a=function(e,t){var i;return i=new window.Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"),t?i(t):i},p=function(e,t,i,s,r,n,a){var o;if(this.isStandalone=a,this.cpps=new g(n),this.cpps.config=e.global,this.networkError=new utils.FSEvent,r)for(var c in!fs.isObject(r)&&2<r.length&&(r=JSON.parse(utils.Compress.decompress(r))),r)this.cpps.set(c,r[c]);if(this.br=t,this.didSubmit=!1,document.body.setAttribute("aria-live","assertive"),this.loader=new v,document.body.appendChild(this.loader.$el),e&&e.instances&&e.instances.length)for(var d=0;d<e.instances.length;d++)if(e.instances[d].mid==s){o=this.cfg=e.instances[d];break}if(void 0===o&&(e.preview||"preview"===n)){var l=fs.getParam("datauri"),u=fs.getParam("template")||"default";o=this.cfg={mid:s,datauri:l,posturi:"",reporturi:"",surveytype:"popup",autowhitelist:!0,preview:!0,template:u,replay:!1}}if(o){var h=this,p=t.isIE&&10==t.browser.actualVersion?" acsIE10":"";document.title=this.cfg.label,this.jrny=i,this.sv=new f.SurveyBuilder(this.cfg,this.cpps,this.br),this.sv.cfg.privacyuri=this.sv.cfg.privacyuri?this.sv.cfg.privacyuri:"http://www.foresee.com/about-us/privacy-policy/",this.sv.cfg.privacytext=this.sv.cfg.privacytext?this.sv.cfg.privacytext:"Privacy policy",this.$content=m('<div id="acsMainContentDialog" class="acsMainContainerMobile--'+o.template+p+'" role="dialog" aria-labelledby="acsFeedbackDialogTitle" aria-describedby="acsFeedbackDialogDesc" aria-live="assertive"></div>'),this.networkError.subscribe(function(e){h.jrny&&(e&&e.type?h.jrny.addEventObj({name:"feedback_survey_"+e.type,properties:{mid:[h.cfg.mid]}}):h.jrny.addEventObj({name:"feedback_server_error",properties:{mid:[h.cfg.mid]}})),this.renderError(e.type)}.bind(this)),this.initQ=new utils.Async(!0,function(){this._getTemplatesAndRender()}.bind(this),function(){window.close()}.bind(this)),this.initQ.enqueue(function(e){this._getCSS(e)}.bind(this)),this.initQ.enqueue(function(e){this._getTemplate("serviceunavailable",e,function(e){this.errTemplate=e}.bind(this))}.bind(this))}utils.Bind(window,"unload",function(){!h.didSubmit&&h.jrny&&h.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[h.cfg.mid]}})})};p.prototype._getTemplatesAndRender=function(){var e=new utils.Async(!0,function(){this.renderSurvey()}.bind(this),function(){this.renderError()}.bind(this));e.enqueue(function(t){this._getSurveyData(function(e){this.survey=e,t.resolve()}.bind(this))}.bind(this)),e.enqueue(function(e){this._getTemplate("epilogue",e,function(e){this.epTemplate=e}.bind(this))}.bind(this)),e.enqueue(function(e){this._getTemplate("surveycontents",e,function(e){this.svContentsTemplate=e}.bind(this))}.bind(this))},p.prototype._getCSS=function(t){utils.loadCSS(_fsNormalizeUrl("$templates/feedback/"+(this.sv.cfg.template||"default")+"/main.css"),function(e){e?t.resolve():t.error()},null,this.br)},p.prototype._getTemplate=function(e,t,i){var s=this.cfg.template||"default",r=_fsNormalizeUrl("$templates/feedback/"+s+"/"+e+".html");new utils.JSONP({success:function(e){i(e),t&&t.resolve()}.bind(this),failure:function(e){t&&t.error()}.bind(this)}).get(r,"templates_feedback_"+s+"_")},p.prototype._showThankyou=function(){var e=a(this.epTemplate,this.survey);this.didSubmit=!0,this.$content.innerHTML=e;for(var t=this.$content.$("h1"),i=0;i<t.length;i++)m(t[i]).addClass("acs-feedback__heading acs-feedback__heading--h1");var s=this.$content.$(".acs-close-button")[0];0===(""+fs.getParam("ok")).indexOf("false")?(s.style.display="none",this.$content.$(".acs-footer")[0].style.display="none"):this.cfg.preview||utils.Bind(s,"click",function(){window.close()}),this.hideLoad()},p.prototype.showLoad=function(){document.body.setAttribute("aria-live","assertive"),document.getElementById("acsMainContentDialog").setAttribute("aria-live","assertive"),this.$content.css({display:"none"}),this.loader.center()},p.prototype.hideLoad=function(){this.loader.moveOffScreen(),utils.hasClass(this.loader.$el,"acs-loader")&&this.loader.$el.setAttribute("aria-hidden",!0),this.$content.css({display:"block"}),setTimeout(function(){document.body.removeAttribute("aria-live"),document.getElementById("acsMainContentDialog").setAttribute("aria-live","off")},1e3)},p.prototype.renderSurvey=function(){var e=this,t=m("#acsPleaseWaitTable")[0];t.parentNode.removeChild(t),this.survey.meta.prologuetext=this._addTitleDescIds(this.survey.meta.prologuetext),this.survey.meta.epiloguetext=this._addTitleDescIds(this.survey.meta.epiloguetext),this.survey.ansLogoSrc=_fsNormalizeUrl("$p_b_foresee.svg");var i=a(this.svContentsTemplate,this.survey);this.$content.innerHTML=i,window.document.body.appendChild(this.$content),this.sv.bind(this.$content),e.jrny&&e.jrny.addEventObj({name:"feedback_survey_shown",properties:{mid:[e.cfg.mid]}}),this.sv.SubmitClicked.subscribe(function(){this.showLoad(),e.jrny&&e.jrny.addEventObj({name:"feedback_submitted",properties:{mid:[e.cfg.mid]}}),this._postSurveyData(function(e){e?(this.cfg.preview||r.processImmediate(),this._showThankyou()):this.networkError.fire({type:"postdata_failed"}),window.surveycomplete=!0,"undefined"!=typeof fsrTracker&&fsrTracker.completeSurvey()}.bind(this))}.bind(this)),this.hideLoad()},p.prototype._addTitleDescIds=function(e){var t=document.createElement("div");t.innerHTML=e;var i=t.childNodes[0],s=t.childNodes[1],r="";if(2<t.childNodes.length)for(t.removeChild(t.childNodes[0]),(s=document.createElement("div")).setAttribute("style","padding: 0; margin: 0;");t.hasChildNodes();){var n=t.firstChild;t.removeChild(n),s.appendChild(n)}return i.setAttribute("id","acsFeedbackDialogTitle"),r=i.outerHTML,s&&(s.setAttribute("id","acsFeedbackDialogDesc"),r+=s.outerHTML),r},p.prototype.renderError=function(e){this.$content.innerHTML=a(this.errTemplate,this.sv);var t=this.$content.$(".acs-serviceunavailable__message")[0];if("expired"===e){for(;t.firstChild;)t.removeChild(t.firstChild);this.sv.cfg.fbexpiremessage?t.appendChild(m("<p>"+this.sv.cfg.fbexpiremessage+"</p>")):t.appendChild(m(this._unencodeHTML(this.sv.defaultCfg.expired)))}else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(m(this._unencodeHTML(this.sv.defaultCfg.unavailable)))}document.body.appendChild(this.$content);for(var i=this.$content.$("h3"),s=0;s<i.length;s++)m(i[s]).addClass("acs-feedback__heading acs-feedback__heading--h1");var r=this.$content.$(".acs-close-button")[0];this.cfg.preview||utils.Bind(r,"click",function(){window.close()}),this.hideLoad();var n=m("#acsPleaseWaitTable")[0];n&&n.parentNode.removeChild(n)},p.prototype._unencodeHTML=function(e){return e.replace(/&lt;/gi,"<").replace(/&gt;/gi,">")},p.prototype._getSurveyData=function(t){this.sv.isExpired()?this.networkError.fire({type:"expired"}):(this._surveyTimer=setTimeout(function(){this.networkError.fire({type:"timedout"})}.bind(this),1e4),new utils.AjaxTransport({url:this.cfg.datauri,method:"GET",success:function(e){this.networkError.didFire||(clearTimeout(this._surveyTimer),this.sv.SurveyData.fire(e,function(e){t&&t(e)}.bind(this)))}.bind(this),failure:function(e){clearTimeout(this._surveyTimer),this.networkError.fire({type:"getdata_failed"})}.bind(this)}).send({data:{mid:this.cfg.mid,cachebust:(new Date).getTime(),version:this.cfg.version}}))},p.prototype._postSurveyData=function(t){if(this.cfg.preview)fs.nextTick(function(){t&&t(!0)});else{this._surveyTimer=setTimeout(function(){this.networkError.fire({type:"timedout"})}.bind(this),1e4);var e,i=new utils.AjaxTransport({url:this.sv.cfg.posturi,method:"POST",success:function(e){clearTimeout(this._surveyTimer),t&&t(!0)}.bind(this),failure:function(e){clearTimeout(this._surveyTimer),sessionStorage.setItem("acsFeedbackSubmitted","true"),t&&t(!1)}.bind(this)}),s=JSON.parse(this.sv._serialize());this.jrny&&this.jrny.config&&this.jrny.config.disable_cpps&&-1<this.jrny.config.disable_cpps.indexOf("url")&&(s.url=""),fs.isArray(s.responses)&&s.responses.push({questionId:"deployment_type",answerText:this.isStandalone?"URL":"BADGE"}),e=utils.Compress.compress(JSON.stringify(fs.ext({rating:this.sv._getScore()},s))),this.isStandalone||(window.location.hash="fsSurveyComplete="+encodeURIComponent(e)),i.send({data:s,skipEncode:!0,contentType:"application/json"})}};var r={cxrid:fs.getParam("cxrid"),cxrurl:fs.getParam("cxrurl"),processImmediate:function(){r.cxrid&&r.cxrurl&&(new utils.AjaxTransport).send({method:"GET",url:r.cxrurl+"process/"+fs.enc(r.cxrid),failure:function(e){}.bind(this),success:function(e){}.bind(this)})}},g=function(e){this.ns=e,this.config=fs.config};g.prototype={_isCPPEnabled:function(e){return!this.config.disable_cpps||this.config.disable_cpps.indexOf(e)<0},set:function(e,t){if(this._isCPPEnabled(e)&&fs.supportsDomStorage){var i=JSON.parse(localStorage.getItem(this.ns)||"{}");i[e]=t,localStorage.setItem(this.ns,JSON.stringify(i))}},get:function(e){return JSON.parse(localStorage.getItem(this.ns)||"{}")[e]},all:function(){return JSON.parse(localStorage.getItem(this.ns)||"{}")}};fs.winReady(function(){var h=new utils.Browser;h.ready.subscribe(function(){var e,t,r,i,s,n,a;"true"==document.getElementsByTagName("head")[0].getAttribute("data-isstandalone")?(e=document.getElementsByTagName("head")[0],t={},r=[],i=e.getAttribute("data-url"),s=e.getAttribute("data-post-url"),n=e.getAttribute("data-version"),a=e.getAttribute("data-mid"),t={cxReplay:!1,global:{},instances:[{autowhitelist:!0,datauri:i,delay:0,disabled:!0,fbanimate:!1,fbdirection:"horizontal",fbfixed:!1,fblocation:"middleright",fbtype:"badge",icon:"aspark100.png",label:"Feedback",mid:a,popup:!0,posturi:s,reporturi:"https://voc.foresee.com/client/feedback-admin/summary",saved:null,template:"default",topics:[{answerId:"",id:"1",order:1,topicText:"Default Topic",whitelistActive:!1}],version:n||1}]},decodeURIComponent(location.search).substring(1).split("&").forEach(function(e,t,i){var s=e.match(/^cpp\[([\w\d\s]*)\]=(.*)$/i);s&&(r[s[1]]=s[2])}),new p(t,h,null,a,r,"fs",!0)):function(){var n={},r=null,a=null,o=fs.getParam("mid"),c=fs.getParam("ns");if("preview"!==c){var d=fs.getParam("uid"),e=fs.getParam("brain"),l=utils.getBrainStorage(h,d,c,e);l.setUpdateInterval(500),l.watchForChanges(["fscfg"],function(e,t,i){l.stopUpdateInterval(),o=fs.dec(i.mid),r=JSON.parse(utils.Compress.decompress(fs.dec(i.cpps)));var s=JSON.parse(fs.dec(utils.Compress.decompress(fs.dec(i.gcfg))));u(s,o,r,i.cid)},!0,!0)}else{var t=fs.getParam("_gcfg_"),i=JSON.parse(fs.dec(utils.Compress.decompress(fs.dec(t))));u(i,o,null,null)}function u(e,t,i,s){if(e.product&&e.product.instances,(n=e.product||{}).global=e.global,"preview"!==c){var r=utils.APPID.FEEDBACK;(a=new utils.Journey({customerId:s,appId:r,stg:utils.getBrainStorage(h,d,fs.config.siteKey),browser:h,useSessionId:!1,usePopupId:!0})).config=e.global}return new p(n,h,a,t,i,c,!1)}}()},!0,!0)})});