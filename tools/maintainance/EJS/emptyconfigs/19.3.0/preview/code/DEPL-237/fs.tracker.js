/***************************************
* @preserve
* ForeSee Web SDK: Tracker Window
* Built February 06, 17 18:46:10
* Code version: DEPL-237
* Template version: 19.3.0
***************************************/
_fsDefine(["require","fs",_fsNormalizeUrl("fs.utils.js")],function(t,e,i){function r(t,e,i){var r,s,n,a,o=!1;return this.count=this.count?++this.count:1,r=this.count,s="load-css-"+r,n=document.createElement("link"),n.setAttribute("id",s),n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),"undefined"!=typeof n.addEventListener?(n.addEventListener("load",function(){o||(o=!0,a&&clearTimeout(a),e(n))},!1),n.addEventListener("error",function(){a&&clearTimeout(a),i(n)},!1),a=setTimeout(function(){o=!0,e(n)},2e3)):"undefined"!=typeof n.attachEvent&&n.attachEvent("onload",function(){var t,r,a=document.styleSheets.length;try{for(;a--;)if(r=document.styleSheets[a],r.id===s)return t=r.cssText,o=!0,void e(n)}catch(t){}o||i(n)}),document.getElementsByTagName("head")[0].appendChild(n),n.setAttribute("href",t),n}i.siteKey=e.getParam("sitekey");var s={INVITE_SHOWN:"fs_inviteShown",INVITE_ACCEPTED:"fs_inviteAccepted",INVITE_DECLINED:"fs_inviteDeclined",INVITE_ABANDONED:"fs_inviteAbandoned",TRACKER_SHOWN:"fs_trackerShown",TRACKER_CLICKED:"fs_trackerClicked",QUALIFIER_ACCEPTED:"fs_qualifierAccepted",QUALIFIER_DECLINED:"fs_qualifierDeclined",QUALIFIER_SHOWN:"fs_qualifierShown",REMINDER_SHOWN:"fs_reminderShown",REMINDER_ACCEPTED:"fs_reminderAccepted",SURVEY_SHOWN:"fs_surveyShown"},n="Func",a="ion",o=function(t,e){var i;return i=new window[n+"t"+a]("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"),e?i(e):i},l=function(t,r,s,n,a,o){this.br=t,this.data=s,this.qual=n,this.cpps=r,this.templatehtml=a,this.displayOpts=o,this.qualified=new i.FSEvent,this.disqualified=new i.FSEvent,this.validationFailed=new i.FSEvent,this.qualifiesValue=null;for(var l=0;l<n.survey.questions.length;l++)for(var c=n.survey.questions[l],u=0;u<c.choices.length;u++)e.ext(c.choices[u],{id:"q"+l+"c"+u,value:"q"+l+"c"+u,name:"q"+l,type:c.questionType.toLowerCase()});this.disqualified.subscribe(e.proxy(function(){this.showNoThanks()},this)),this.validationFailed.subscribe(e.proxy(function(t){alert(t)},this))};l.prototype.render=function(){document.documentElement.setAttribute("id","fsrQualifier");var t=e.ext({},this.displayOpts,{qual:this.qual});document.body.innerHTML=o(this.templatehtml,t),i.Bind(document.getElementById("qualifierForm"),"qualifier:submit",e.proxy(function(t){i.preventDefault(t),this.validateAndSubmit()},this)),i.Bind(document.getElementById("qualCancelButton"),"qualifier:click",e.proxy(function(t){i.preventDefault(t),this.disqualified.fire()},this)),i.Bind(document.getElementById("qualCloseButton"),"qualifier:click",e.proxy(function(t){i.preventDefault(t),window.close()},this))},l.prototype.validateAndSubmit=function(){for(var t=document.querySelectorAll(".activeQuestion"),e=[],i=!1,r=0;r<t.length;r++){var s=parseInt(t[r].getAttribute("questionNum")),n=this.qual.survey.questions[s];if("RADIO"==n.questionType){for(var a=document.getElementsByName("q"+s),o=!1,l=0;l<a.length;l++)if(a[l].checked){o=!0,e.push(n.choices[l]);break}if(!o){i=!0;break}}}if(i)this.validationFailed.fire(this.qual.survey.validationFailedMsg);else{for(var c=!1,u=0;u<e.length;u++){var h=e[u];if(this.qualifiesValue=h.qualifies||null,h.cpps&&h.cpps.length>0)for(var d=0;d<h.cpps.length;d++)for(var f in h.cpps[d])this.cpps.set(f,h.cpps[d][f]);if(h.qualifies===!1){c=!0;break}}c===!0?this.disqualified.fire():this.qualified.fire()}},l.prototype.showNoThanks=function(){i.addClass(document.getElementById("fsrQualifierMain"),"acsNoDisplay"),i.removeClass(document.getElementById("fsrQualifierNoThanks"),"acsNoDisplay")};var c=function(t,e,r,s,n,a){this.br=t,this.data=r,this.rmdr=s,this.cpps=e,this.templatehtml=n,this.displayOpts=a,this.accepted=new i.FSEvent};c.prototype.render=function(){document.documentElement.setAttribute("id","fsrReminder");var t=e.ext({},this.displayOpts,{rmdr:this.rmdr});document.body.innerHTML=o(this.templatehtml,t),i.Bind(document.getElementById("reminderForm"),"reminder:submit",e.proxy(function(t){i.preventDefault(t),this.accepted.fire()},this))};var u=function(t){this.gs=t};u.prototype={_extras:{},set:function(t,e){var i=this.all();i[t]=e,this._extras[t]=e},get:function(t){return this.all()[t]},all:function(){return e.ext({},this.gs.get("cp")||{},this._extras)},toQueryString:function(){var t=[],i=this.all();for(var r in i)t.push("cpp["+e.enc(r)+"]="+e.enc(i[r]));return t.join("&")},erase:function(t){var e=this.all();delete e[t],this.gs.set("cp",e)},append:function(t,e,i){var r=this.gs.get("cp")||{};if(r[t]=(r[t]||"")+","+e,i){var s=r[t].split(","),n=s.length-1,a=s.length>i?s.length-i:0;r[t]=s.splice(a,n-a+1).join()}this.gs.set("cp",r)}};var h=function(t,e){this.cfg=t.cfg.config,this.cm=new b(e)};h.prototype.get=function(t){var e=this.cm.get(this.cfg.site_id);if(e&&(e=JSON.parse(e),e["acs.t"]))return e=JSON.parse(e["acs.t"]),e[t]};var d=function(config,t,e,i){this.cfg=config,this.cpps=t,this.def=e,this.qual=i};d.prototype.getUrl=function(){var t=e.enc,r=this.def,s=e.config.surveyUrl+"?",n=i.now()+"_"+Math.round(1e13*Math.random()),a=r.name+"-"+(e.isDefined(r.site)?r.site+"-":"")+(e.isDefined(r.section)?this.def.section+"-":"")+(this.cpps.get("locale")||r.language.locale);this.qual&&(a+="-"+this.qual.qualifiesValue);var o={sid:t(a),cid:t(this.cfg.config.id),pattern:t(this.cpps.get(r.pattern)),a:n,b:i.hash(n),c:864e5,version:e.config.codeVer};for(var l in o)s+=e.enc(l)+"="+e.enc(o[l])+"&";return s+=this.cpps.toQueryString()};var f="survey.foreseeresults.com",p="events.foreseeresults.com",m=".4seeresults.com",g="undefined"!=typeof config?config.config.surveyAsyncCurl:"i.4see.mobi",v={SERVICE_TYPES:{survey:{host:f,path:"/survey",url:"/display",protocol:"https"},mobileOnExitInitialize:{host:g,path:"/e",url:"/initialize"},mobileOnExitHeartbeat:{host:g,path:"/e",url:"/recordHeartbeat"},check:{host:"controller"+m,path:"/fsrSurvey",url:"/OTCImg",success:3},event:{host:p,path:"/rec",url:"/process?event=logit"},domain:{host:f,path:"/survey",url:"/FSRImg",success:3},replay:{host:"replaycontroller"+m,path:"/images",enabled:!0}}};if(v.log=function(t,e,config,r,s,n,a,o,l){var c=new Date,u=new i.ImageTransport,h=config.config,d=s.get("rid"),f=s.get("q"),p={ver:1,cid:h.id,rid:d,q:f,type:a||"",site:h.site_id,msg:n,tms:c.getTime(),tmz:6e4*c.getTimezoneOffset()};if(r&&(p.cat=r.name,p.sec=r.section,p.lang=r.language.locale),"object"==typeof e){p.param="";for(var m in e)p.param+=encodeURIComponent(m)+"="+encodeURIComponent(e[m])+"&"}else"string"==typeof e&&(p.param=e);for(var g in p)"undefined"!=typeof p[g]&&null!==p[g]||delete p[g];u.send({url:"https://"+t.host+t.path+(t.url||""),success:o||function(){},failure:l||function(){},data:p})},v.ping=function(t,e,r,s){var n=new i.ImageTransport;n.send({url:"https://"+t.host+t.path+(t.url||""),success:r||function(){},failure:s||function(){},data:e})},!window.btoa){var y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_=new Array((-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),62,(-1),(-1),(-1),63,52,53,54,55,56,57,58,59,60,61,(-1),(-1),(-1),(-1),(-1),(-1),(-1),0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,(-1),(-1),(-1),(-1),(-1),(-1),26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,(-1),(-1),(-1),(-1),(-1));window.btoa=function(t){var e,i,r,s,n,a;for(r=t.length,i=0,e="";r>i;){if(s=255&t.charCodeAt(i++),i==r){e+=y.charAt(s>>2),e+=y.charAt((3&s)<<4),e+="==";break}if(n=t.charCodeAt(i++),i==r){e+=y.charAt(s>>2),e+=y.charAt((3&s)<<4|(240&n)>>4),e+=y.charAt((15&n)<<2),e+="=";break}a=t.charCodeAt(i++),e+=y.charAt(s>>2),e+=y.charAt((3&s)<<4|(240&n)>>4),e+=y.charAt((15&n)<<2|(192&a)>>6),e+=y.charAt(63&a)}return e},window.atob=function(t){var e,i,r,s,n,a,o;for(a=t.length,n=0,o="";a>n;){do e=_[255&t.charCodeAt(n++)];while(a>n&&-1==e);if(-1==e)break;do i=_[255&t.charCodeAt(n++)];while(a>n&&-1==i);if(-1==i)break;o+=String.fromCharCode(e<<2|(48&i)>>4);do{if(r=255&t.charCodeAt(n++),61==r)return o;r=_[r]}while(a>n&&-1==r);if(-1==r)break;o+=String.fromCharCode((15&i)<<4|(60&r)>>2);do{if(s=255&t.charCodeAt(n++),61==s)return o;s=_[s]}while(a>n&&-1==s);if(-1==s)break;o+=String.fromCharCode((3&r)<<6|s)}return o}}var w=function(t,r,s){var n=s.cfg.config;this.br=t,this.stg=r,this.data=s,this.jrny=new i.Journey(n.id,n.site_id,r.get("rid"),new i.Browser,50),this.cpps=new u(this.stg),this._loadResources(e.proxy(function(){document.documentElement.style.backgroundImage="none",this.ready.fire(),r.onSync.subscribe(e.proxy(function(){var t=r.get("page_hb");t||(r.onSync.unsubscribeAll(),r.setUpdateInterval(6e3),this.launchSurveyOrQualifier(),this.data.display.removeSurveyAlerts||setTimeout(e.proxy(function(){var t=navigator.userAgent.toLowerCase();t.indexOf("msie")==-1&&t.indexOf("edge")==-1&&t.indexOf("firefox")==-1&&this.data.display.dialog&&alert(this.data.display.dialog.surveyavailable)},this),200))},this))},this)),this.ready=new i.FSEvent};w.prototype.update=function(t,e,i){this.br=t,this.stg=e,this.data=i},w.prototype.setCPPS=function(t){if(t)for(var e in t)this.cpps.set(e,t[e])},w.prototype._loadResources=function(t){this.queue=new i.Async((!0),e.proxy(function(){t&&t()},this),e.proxy(function(){},this)),this.queue.enqueue(e.proxy(function(t){r(_fsNormalizeUrl("templates/trigger/"+this.data.template+"/main.css"),e.proxy(function(e){this._cssLink=e,t&&t.resolve()},this))},this)),this.queue.enqueue(e.proxy(function(t){var r=new i.JSONP({success:e.proxy(function(e){this.templatehtml=e,t&&t.resolve()},this)});r.get(_fsNormalizeUrl("templates/trigger/"+this.data.template+"/tracker.html"),"templates_trigger_"+this.data.template+"_")},this)),this.queue.enqueue(e.proxy(function(t){var r=new i.JSONP({success:e.proxy(function(e){this.qualhtml=e,t&&t.resolve()},this)});r.get(_fsNormalizeUrl("templates/trigger/"+this.data.template+"/qualifier.html"),"templates_trigger_"+this.data.template+"_")},this)),this.queue.enqueue(e.proxy(function(t){var r=new i.JSONP({success:e.proxy(function(e){this.rmdrhtml=e,t&&t.resolve()},this)});r.get(_fsNormalizeUrl("templates/trigger/"+this.data.template+"/reminder.html"),"templates_trigger_"+this.data.template+"_")},this))},w.prototype.renderTemplate=function(){this.data.display.inviteType=this.data.display.inviteType.toUpperCase();var t=e.ext({copyrightDate:(new Date).getFullYear().toString(),supportsSVG:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")},this.data.display,this.data.cfg.config),r=e.getParam("gw");t.trackerLogo&&t.trackerLogo.length>0&&(t.trackerLogo=r.replace(/__gwtest__/g,t.trackerLogo)),t.vendorLogo&&t.vendorLogo.length>0&&(t.vendorLogo=_fsNormalizeUrl(t.vendorLogo)),t.vendorLogoPNG&&t.vendorLogoPNG.length>0&&(t.vendorLogoPNG=_fsNormalizeUrl(t.vendorLogoPNG)),t.trusteLogo&&t.trusteLogo.length>0&&(t.trusteLogo=_fsNormalizeUrl(t.trusteLogo)),t.loadImg=_fsNormalizeUrl("loadimg.gif"),this._displayOpts=t,document.title=t.dialog.trackerTitle,document.body.innerHTML=o(this.templatehtml,t),this._doSizing(),this._cvTimeout=setTimeout(e.proxy(function(){this._convertTracker()},this),this.data.cfg.config.trackerConvertsAfter),i.Bind(window,"tracker:resize",e.proxy(function(){this._doSizing()},this)),this.jrny.addEventString(s.TRACKER_SHOWN)},w.prototype._doSizing=function(){var t=document.querySelectorAll("*[acsfill=true]"),e=i.getSize(window);if(t)for(var r=0;r<t.length;r++){var s=t[r],n=s.offsetLeft,a=s.offsetTop;s.style.height=e.h-a-1*n+"px"}var o=document.querySelectorAll("*[acscentervertically=true]");if(o)for(var l=0;l<o.length;l++){var c=o[l],u=c.offsetHeight,h=c.parentNode.offsetHeight;c.style.marginTop=(h-u)/2+"px"}},w.prototype._convertTracker=function(){var t,r=document.querySelectorAll(".initialContent");for(t=0;t<r.length;t++)i.addClass(r[t],"acsNoDisplay");var n=document.querySelectorAll(".showLater");for(t=0;t<n.length;t++)i.addClass(n[t],"acsDisplay");this._doSizing(),i.addClass(document.body,"acsActiveTracker");var a=document.querySelectorAll("*[acsactivatebutton=true]"),o=e.proxy(function(){this.jrny.addEventString(s.TRACKER_CLICKED),this.launchSurveyOrQualifier()},this),l=function(t){var e=window.event?t.which:t.keyCode;13===e&&o()};for(t=0;t<a.length;t++)i.Bind(a[t],"click",o),i.Bind(a[t],"keydown",l)},w.prototype.launchSurveyOrQualifier=function(){this._cvTimeout&&(clearTimeout(this._cvTimeout),this._cvTimeout=null);for(var t=document.querySelectorAll("*[acsshowwhenloading=true]"),e=0;e<t.length;e++)i.addClass(t[e],"acsDisplay");for(var r=document.querySelectorAll("*[acshidewhenloading=true]"),s=0;s<r.length;s++)i.removeClass(r[s],"acsDisplay"),i.addClass(r[s],"acsNoDisplay");var n=this.data.def.qualifier,a=this.data.def.reminder;n&&n.useQualifier?this.goToQualifier():a&&a.useReminder?this.goToReminder():this.goToSurvey(null)},w.prototype.goToQualifier=function(){this.qualifier=new l(this.br,this.cpps,this.data,this.data.def.qualifier,this.qualhtml,this._displayOpts),this.qualifier.qualified.subscribe(e.proxy(function(){this.jrny.addEventString(s.QUALIFIER_ACCEPTED),this.goToSurvey(this.qualifier)},this),!0,!1),this.qualifier.disqualified.subscribe(e.proxy(function(){this.jrny.addEventString(s.QUALIFIER_DECLINED)},this),!0,!1),this.qualifier.render(),this.jrny.addEventString(s.QUALIFIER_SHOWN)},w.prototype.goToReminder=function(){this.reminder=new c(this.br,this.cpps,this.data,this.data.def.reminder,this.rmdrhtml,this._displayOpts),this.reminder.accepted.subscribe(e.proxy(function(){this.jrny.addEventString(s.REMINDER_ACCEPTED),this.goToSurvey()},this),!0,!1),this.reminder.render(),this.jrny.addEventString(s.REMINDER_SHOWN)},w.prototype.goToSurvey=function(t){this.jrny.addEventString(s.SURVEY_SHOWN);var i=new d(this.data.cfg,this.cpps,this.data.def,this.qualifier),r=i.getUrl();window.resizeBy(0,200),window.focus(),setTimeout(e.proxy(function(){this._doSizing(),window.location=r},this),100)};var S,b=function(t){if(S)return S;S=this,this.someCommunicationReceived=new i.FSEvent,this.messageReceived=new i.FSEvent;var r=t.browser;if(this.br=t,this.useAlt="Safari"==r.name||!t.supportsLocalStorage,this._trnsInterval=25,this._altVals={},this.useAlt){this._commands={};var s=window.location.host.toString().toLowerCase().replace(/www\./gi,"");s.indexOf(":")>-1&&(s=s.substr(0,s.indexOf(":")));var n=new Date;n.setTime(n.getTime()+31536e6);var a={path:"/",domain:s,secure:!1,encode:!0,expires:n.toGMTString()};this._ck=new i.Cookie(a)}this._transportTimer=setInterval(e.proxy(function(){var t;this._ck?(t=this._ck.get("_fsuid"),t&&this._ck.set("_fruid",t)):(t=localStorage.getItem("_fsuid"),t&&localStorage.setItem("_fruid",t)),t&&this._init()},this),5*this._trnsInterval)};b.prototype._init=function(){clearInterval(this._transportTimer),this._ck?this._cktimer=setInterval(e.proxy(function(){var t=this._ck.get("fsmsg");t&&(this.someCommunicationReceived.fire(),t=JSON.parse(t),this._ck.kill("fsmsg"),this._ck.set("fsmsgrec",t.id),this._commands[t.t]||(this._commands[t.t]={t:t.t,k:t.k,d:[]}),this._commands[t.t].d.push(t.d),t.f&&(this._altVals[t.k]=JSON.parse(i.Compress.decompress(this._commands[t.t].d.join(""))),this.messageReceived.fire(t.k,this._altVals[t.k].v)))},this),this._trnsInterval):this.br.supportsLocalStorage&&(this._lsT=setInterval(e.proxy(function(){for(var t in localStorage)t.indexOf("__fsFr__")>-1&&(t=t.replace("__fsFr__",""),this.get(t))},this),150))},b.prototype.set=function(t,e){this._altVals[t]=e,this._ck&&this._ck.set(t,e),this.br.supportsLocalStorage&&localStorage.setItem(t,e)},b.prototype._extractValFromAlt=function(t){if(this._altVals[t])return this._altVals[t].x&&(new Date).getTime()>this._altVals[t].x?void delete this._altVals[t]:this._altVals[t].v},b.prototype._maint=function(){var t=i.now();for(var e in this._altVals)this._altVals[e].x&&this._altVals[e].x<t&&delete this._altVals[e]},b.prototype.get=function(t){this._maint();var e=this._extractValFromAlt(t);if(!e&&this.br.supportsLocalStorage){var i="__fsFr__"+t,r=localStorage.getItem(i);if(r){r=JSON.parse(decodeURIComponent(r)),this._altVals[t]=r,localStorage.removeItem(i);var s=(new Date).getTime();r.x&&r.x<s?(delete this._altVals[t],this.messageReceived.fire()):this.messageReceived.fire(t,r.v)}}return this._extractValFromAlt(t)},b.prototype.kill=function(t){this._ck&&this._ck.kill(t),this.br.supportsLocalStorage&&(localStorage.removeItem(t),localStorage.removeItem("__fsFr__"+t)),delete this._altVals[t]},e.winReady(function(){var t=setTimeout(function(){window.close()},7e3);document.cookie="fsIce=broke";var r,s,n=new i.Browser;n.ready.subscribe(function(){var a,o=e.getParam("stg");if(o==i.storageTypes.CK||o==i.storageTypes.DS){a=new b(n);var l,c,u=new i.FSEvent,h=!1,d=e.proxy(function(i,d){var p=a.get("trackerinfo"),m=a.get("hb_i"),g=a.get("ckcpps"),v=a.get("trackercmd"),y=a.get("defupdate");y&&s&&(s.data.def.name=y.name),p&&(l=p,s&&(s.data=p)),m&&(c=m),g&&(r=g,a.kill("ckcpps"),s&&s.ready.subscribe(function(){s&&s.setCPPS(r)},!0,!0)),v&&"close"===v.method&&window.close(),u.fire(),l&&c&&!h&&(h=!0,a.kill("hb_i"),a.kill("trackerinfo"),clearInterval(f),s=new w(n,{onSync:u,get:function(t){return"rid"===t?e.getParam("uid"):a.get(t)},setUpdateInterval:function(){},cfg:{persistence:o,brain_url:e.getParam("brain_url")}},l),window.Tracker=s,s.ready.subscribe(function(){clearTimeout(t),r&&s.setCPPS(r),s.renderTemplate()},!0,!1),setInterval(e.proxy(function(){u.fire()},this),2e3))},this),f=setInterval(d,150);a.messageReceived.subscribe(d,!1,!0)}else{var p=i.getGlobalStore(n,e.getParam("uid"));p.ready.subscribe(e.proxy(function(){p.setUpdateInterval(1e3),p.watchForChanges(["trackerinfo","trackercmd"],e.proxy(function(i,a,o){"trackercmd"==i&&o.method&&"close"==o.method&&window.close(),p.setUpdateInterval(p.get("hb_i")),e.isDefined(s)?s.update(n,p,o):s=new w(n,p,o),window.Tracker=s,s.ready.subscribe(function(){clearTimeout(t),r&&s.setCPPS(r),s.renderTemplate()},!0,!1)},this),!1,!0)},this),!0,!0)}},!0,!0)})});