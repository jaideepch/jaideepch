/***************************************
* @preserve
* ForeSee Web SDK: Opt-Out Module
* Built February 06, 17 18:46:10
* Code version: DEPL-237
* Template version: 19.3.0
***************************************/
_fsDefine(["require","fs",_fsNormalizeUrl("$fs.utils.js"),"triggerconfig"],function(t,e,n,config){function o(t,e,n){var o,r,s,i,a=!1;return this.count=this.count?++this.count:1,o=this.count,r="load-css-"+o,s=document.createElement("link"),s.setAttribute("id",r),s.setAttribute("rel","stylesheet"),s.setAttribute("type","text/css"),"undefined"!=typeof s.addEventListener?(s.addEventListener("load",function(){a||(a=!0,i&&clearTimeout(i),e(s))},!1),s.addEventListener("error",function(){i&&clearTimeout(i),n(s)},!1),i=setTimeout(function(){a=!0,e(s)},2e3)):"undefined"!=typeof s.attachEvent&&s.attachEvent("onload",function(){var t,o,i=document.styleSheets.length;try{for(;i--;)if(o=document.styleSheets[i],o.id===r)return t=o.cssText,a=!0,void e(s)}catch(t){}a||n(s)}),document.getElementsByTagName("head")[0].appendChild(s),s.setAttribute("href",t),s}n.registerProduct("foresee",config);var r="Func",s="ion",i=function(t,e){var n;return n=new window[r+"t"+s]("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"),e?n(e):n},a=function(t){this.browser=t,this.stg=n.getGlobalStore(t)};a.prototype.loadResources=function(t){n.Healthy(this.browser,["static","brain"],e.proxy(function(){this.stg.ready.subscribe(e.proxy(function(){var r=e.makeURI("$templates/trigger/admintools/main.css"),s=e.makeURI("$templates/trigger/admintools/optout.html"),i=!1,a=!1,u=function(){i&&a&&t&&t()};o(r,function(t){i=!0,u()});var c=new n.JSONP({success:e.proxy(function(t){a=!0,this.template=t,u()},this)});c.get(s,"templates_trigger_admintools_")},this),!0,!0)},this),e.proxy(function(){alert("Cannot connect to remote ForeSee state server.\nPlease connect to the Internet and try again.")},this))},a.prototype._applyOptOutState=function(){this.stg.ready.subscribe(e.proxy(function(t){var n=document,o=this.stg.get("optout");if(e.isDefined(o)&&"false"!=o){n.querySelector(".acsOptOutControls").style.display="none",n.querySelector(".acsOptInControls").style.display="block";var r=new Date,s=["January","February","March","April","May","June","July","August","September","October","November","December"];r.setTime(t._data.keys.optout.x);var i=r.getDate(),a=r.getMonth(),u=r.getFullYear();n.getElementById("acswhenexpires").innerHTML=s[a]+" "+i+", "+u}else n.querySelector(".acsOptOutControls").style.display="block",n.querySelector(".acsOptInControls").style.display="none"},this),!0,!0)},a.prototype.render=function(){document.title="ForeSee Opt-Out Tool";var t=e.ext(this.browser,{siteLogo:e.config.staticUrl+"/logos/foresee/foresee.svg"}),o=i(this.template,t);document.body.innerHTML=o;var r=document.getElementById("acsOptOutButton"),s=document.getElementById("acsOptInButton");n.Bind(r,"click",e.proxy(function(t){n.preventDefault(t),this.stg.set("optout",!0,31536e6,!0),this._applyOptOutState()},this)),n.Bind(s,"click",e.proxy(function(t){n.preventDefault(t),this.stg.erase("optout",null,!0),this._applyOptOutState()},this)),this._applyOptOutState()},e.domReady(function(){var t=new n.Browser;t.ready.subscribe(function(){var e=new a(t);e.loadResources(function(){e.render()})},!0,!0)})});