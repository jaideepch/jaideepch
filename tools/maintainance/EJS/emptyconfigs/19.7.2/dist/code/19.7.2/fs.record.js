/***************************************
* @preserve
* ForeSee Web SDK: record
* Built April 27, 19 21:33:04
* Code version: 19.7.2
* Template version: 19.7.2
***************************************/
_fsDefine(["require","fs",_fsNormalizeUrl("$fs.utils.js"),"recordconfig"],function(t,fs,utils,u){var h={},l=window,d="fs_sessionStarted",e="fs_recorderCanceled",g="fs_recorderStoppedOldBrowser",c="fs_recorderTransmitFailed",f={_trackers:[],Tracker:function(t,e,i,r,s,n){var o,a;this.recorder=t,this.throttleTime=r,this.recFunction=s,this.subject=e,n||this._capture({},e),utils.Bind(e,i,(o=this,a=e,function(t){o._capture&&o._capture(t,a),a=t=null})),f._trackers.push(this),s=i=t=e=null}};f.Tracker.prototype.merge=function(t,e,i,r){var s,n,o;utils.Bind(e,i,(s=this,n=e,o=t,function(t){s._capture&&s._capture(t,n,o)})),i=t=null},f.Tracker.prototype._capture=function(t,e,i){clearTimeout(this.lastCapThrottle);var r,s,n,o,a=i||this.recorder;if(!this.lastCap||utils.now()-this.lastCap>this.throttleTime)this.recFunction.call(this,t,e,a),this.lastCap=utils.now();else{var c={};for(var h in t)6==h.length&&"layerX"!=h&&"layerY"!=h&&(c[h]=t[h]);this.lastCapThrottle=setTimeout((r=this,s=c,n=e,o=a,fs.isDefined(s.clientX)&&(s.sX=s.clientX,s.sY=s.clientY),function(){s.delayed=!0,r._capture&&r._capture(s,n,o)}),this.throttleTime)}e=t=i=a=null},f.Tracker.prototype.dispose=function(){this.lastCapThrottle&&clearTimeout(this.lastCapThrottle),fs.dispose(this)};var p=f.Tracker,s="rpid",m="mid",_="rt",T="cncl",n="SESSION",o="grft",y={_frames:[],TrackFrame:function(t,e,i){y._getFrameByXPath(t)||y._frames.push({xp:t,nd:e,rc:i,sid:y._frames.length+"_",id:utils.generateGUID(),initialized:!1})},_getFrameByXPath:function(t){for(var e=t.join("/"),i=0;i<y._frames.length;i++)if(y._frames[i].xp.join("/")==e)return y._frames[i]},_getFrameById:function(t){for(var e=0;e<y._frames.length;e++)if(y._frames[e].id==t)return y._frames[e]},BeginTrackingChildFrames:function(n){setInterval(function(){for(var t=0;t<y._frames.length;t++){var e=y._frames[t];!e.initialized&&e.nd.contentWindow&&e.nd.contentWindow.postMessage(JSON.stringify({cxr:!0,id:e.id,xp:e.xp,sid:e.sid,sp:z.getPosition(e.nd,n.win)}),"*")}},400),utils.Bind(window,"message",function(t){if(t.data&&t.data.timetounload)for(var e=0;e<y._frames.length;e++)y._frames[e].id===t.data.frameId&&(y._frames[e].initialized=!1);if(t.data=t.data+"",t.data&&fs.isFunction(t.data.indexOf)&&-1<t.data.indexOf("_cxrXDS_")){var i;try{i=JSON.parse(t.data)}catch(t){return}if(i){var r=y._getFrameById(i.id);if(r){var s=n.getLogger();r.initialized=!0,s._data&&0<s._data.length?s._data=s._data+","+i.data:s._data=i.data}}}});new p(n,n.win,"record:scroll",500,function(t,e,i){utils.getScroll(n.win);for(var r=0;r<y._frames.length;r++){var s=y._frames[r];s.initialized&&s.nd.contentWindow&&s.nd.contentWindow.postMessage(JSON.stringify({cxsp:!0,sp:z.getPosition(s.nd,n.win)}),"*")}})},SendDataToParentFrame:function(t,e,i){t.postMessage(JSON.stringify({_cxrXDS_:!0,id:e,data:i}),"*")}},v=function(t,h,e,i){this.config=e,this.browser=h,this.isXDRIFrameMode=i,this.isTop=t.getTop()==t,this.recorder=t,this.mutation=new O(t),this._setupMouseTracking(),this.sizeCapture=new p(this.recorder,this.recorder.win,"resize",700,function(t,e,i){var r=utils.getSize(i.win),s=0,n=i.getLogger(),o=z.getDocSize(i.doc),a={w:o.width,h:o.height};if(i.docSize=o,h.isMobile){var c=r;r=a,a=c,s=window.orientation}n.log(i,H.EVENT_TYPES.FRAME_SIZE,{sz:r,avs:a,st:s,m:h.isMobile},null,-350),n.log(i,H.EVENT_TYPES.DOC_SIZE,{sz:{w:o.width,h:o.height}},null,-340)});var r,s,n=this.recorder.win.onerror;this.recorder.win.onerror=function(t,e,i){this.getLogger().log(this,H.EVENT_TYPES.JAVASCRIPT_ERROR,{v:t+", "+e+", "+i}),n&&n.apply(this.win,arguments)}.bind(this.recorder),this.inputCaptures=[],this.updateNodeBinding(this.recorder.win.document.body,!1,!0),this.inputReserialize=((r=this).recorder,s=this.inputCaptures,function(){setTimeout(function(){try{r.recorder.win.document}catch(t){return}for(var t=0;t<s.length;t++){var e=s[t];s[t].hasChanged()&&fs.isDefined(e.input)&&"SELECT"!=e.input.nodeName&&(e.lastValue=e.input.value,e.serialize())}},20),r.isTop||r.recorder.getTop().eventcap.inputReserialize.apply()}),utils.Bind(this.recorder.win.document,"record:click",this.inputReserialize),utils.Bind(this.recorder.win.document,"record:touchstart",this.inputReserialize),this.config.advancedSettings&&this.config.advancedSettings.scrollEls&&(this._setupScrollTracking(),t.DomUpdated.subscribe(function(t){this._setupScrollTracking(t)}.bind(this))),t=null};v.prototype._setupScrollTracking=function(t){t||(t=document);var e=this.config.advancedSettings.scrollEls;if(fs.isString(e))for(var i=t.querySelectorAll(e),r=function(i){return function(t,e){e||(e=t.target||t.srcElement),e&&i.getLogger().log(i,H.EVENT_TYPES.SCROLL_EL,{x:i.getLogger().logXPath(i,x.getMapping(e)),ps:{x:e.scrollLeft,y:e.scrollTop}})}},s=0;s<i.length;s++)i[s]._fsrScrollCapture||(i[s]._fsrScrollCapture=new p(this.recorder,i[s],"scroll",400,r(this.recorder)))},v.prototype._setupMouseTracking=function(){var o,e,i,g=this,a=function(t,e,i,r){var s=H.EVENT_TYPES,n=i.getLogger();if(t.delayed||i.getTop().isMousedOverWindow||(n.log(i,s.WINDOW_MOUSEOUT_MOUSEENTER,{st:1}),i.getTop().isMousedOverWindow=!0),i.getTop().isMousedOverWindow){r=r||s.MOUSE_MOVE;var o={x:"unknown"!=typeof t.clientX?t.clientX:"unknown"!=typeof t.screenX?t.screenX:t.sX,y:"unknown"!=typeof t.clientY?t.clientY:"unknown"!=typeof t.screenY?t.screenY:t.sY},a=-1;if(r==s.MOUSE_CLICK||r==s.MOUSE_DOWN){var c=t.explicitOriginalTarget||t.originalTarget||t.target||t.srcElement;c&&(a=n.logXPath(i,x.getMapping(c)))}var h=utils.getScroll(i.win);if(void 0===o.x&&(o=i.lastRawMouseCoords),fs.isDefined(o)){i.lastRawMouseCoords=o;var d={x:h.x+o.x,y:h.y+o.y};if(i.win!==i.win.top)if(g.isXDRIFrameMode)d.x+=i.ifrFrameOffset.x-h.x,d.y+=i.ifrFrameOffset.y-h.y;else{var l=i.win.frameElement,u=z.getPositionRelativeToMainView(l,z.getParentWindow(l),!1);u&&(d.x+=u.x-h.x,d.y+=u.y-h.y)}n.log(i,r,{ps:d,x:a})}}},t=250;if(this.browser.isMobile){if(a=null,t=100,this.isTop){this.lastOrientation={alpha:0,beta:0,gamma:0},utils.Bind(window,"record:deviceorientation",function(t){if(fs.isDefined(t.alpha)){var e=Math.round(t.alpha),i=Math.round(t.beta),r=Math.round(t.gamma),s=this.recorder;(10<Math.abs(e-this.lastOrientation.alpha)||10<Math.abs(i-this.lastOrientation.beta)||10<Math.abs(r-this.lastOrientation.gamma))&&(this.lastOrientation.alpha=e,this.lastOrientation.beta=i,this.lastOrientation.gamma=r,s.getLogger().log(s,H.EVENT_TYPES.ORIENTATION,{ot:{a:e,b:i,g:r}}))}}.bind(this)),this.doOrientationChange=function(t){var e=this.recorder.win.document.documentElement,i=z.getDocSize(this.recorder.doc),r=0;0<Math.abs(window.orientation)&&(r=1),this.recorder.getLogger().log(this.recorder,H.EVENT_TYPES.ORIENTATION_CHANGE,{ps:utils.getScroll(this.recorder.win),oc:{isL:r,ww:e.clientWidth,wh:e.clientHeight,dw:i.width,dh:i.height,wiw:window.innerWidth,wih:window.innerHeight}})}.bind(this),utils.Bind(window,"record:orientationchange",this.doOrientationChange),this.doOrientationChange();for(var r=["start","end","cancel","leave","move"],s=function(e){return function(t){!function(t,e,i){var r=[];if(fs.isDefined(t.touches))for(var s=0;s<t.touches.length;s++){var n=t.touches[s];r.push({x:n.pageX,y:n.pageY})}i.getLogger().log(i,H.EVENT_TYPES.TOUCH,{ts:r})}(t,0,e)}},n=0;n<r.length;n++)utils.Bind(window,"record:touch"+r[n],s(this.recorder));utils.Bind(window,"record:touchstart",function(){this.EmergencySendRequired.fire()}.bind(this.recorder))}}else{var c=this.browser.isIE?this.recorder.win.document:this.recorder.win;this.isTop?this.mouseMoveCapture=new p(this.recorder,c,"record:mousemove",200,a,!0):this.mouseMoveCapture=this.recorder.getTop().eventcap.mouseMoveCapture.merge(this.recorder,c,"record:mousemove",a,!0),utils.Bind(this.recorder.win.document,"record:mousedown",function(t){this.mHandler.call(this.ctx,t,null,this.rec,H.EVENT_TYPES.MOUSE_CLICK)}.bind({ctx:this,rec:this.recorder,mHandler:a}))}if(this.scrollCapture=new p(this.recorder,this.recorder.win,"record:scroll",t,(o=a,function(t,e,i){var r=!0;if(i.win==i.win.top)if(W._browser.isMobile){var s=z.getDocSize(i.doc),n={z:{cw:window.innerWidth,ch:window.innerHeight,w:s.width,h:s.height},ps:utils.getScroll(i.win)};r=!1,i.getLogger().log(i,H.EVENT_TYPES.ZOOM,n)}else a&&o.call(this,t,e,i);r&&i.getLogger().log(i,H.EVENT_TYPES.FRAME_SCROLL,{ps:utils.getScroll(i.win)})})),this.isTop){this.browser.isMobile||(this.recorder.isMousedOverWindow=!0,utils.Bind(this.recorder.win.document,"record:mouseover",(i=this.recorder,function(t){!i||i.isMousedOverWindow||t.relatedTarget||t.fromElement||(i.getLogger().log(i,H.EVENT_TYPES.WINDOW_MOUSEOUT_MOUSEENTER,{st:1}),i.isMousedOverWindow=!0)})),utils.Bind(this.recorder.win.document,"record:mouseout",function(t){t=t||this.recorder.win.event;var e,i=this.recorder,r=t.relatedTarget||t.toElement;try{r&&(e=r.nodeName)}catch(t){}i&&i.isMousedOverWindow&&(!r||e&&"HTML"==e)&&(i.getLogger().log(i,H.EVENT_TYPES.WINDOW_MOUSEOUT_MOUSEENTER,{st:0}),i.isMousedOverWindow=!1,i.EmergencySendRequired.fire())}.bind(this)));var h=(e=this.recorder,function(){var t=z.getDocSize(e.doc);e.docSize&&e.docSize.width==t.width&&e.docSize.height==t.height||(e.docSize=t,e.getLogger().log(e,H.EVENT_TYPES.DOC_SIZE,{sz:{w:t.width,h:t.height}}))});h.apply(this,[]),this.recorder.DomUpdated.subscribe(h),h=null}a=null},v.MAX_UPDATE_NODE_BINDING_EXECUTION_TIME=500,v.prototype.updateNodeBinding=function(t,e,i){for(var r=+new Date,s=t.querySelectorAll("input, select, textarea"),n=this.inputCaptures,o=function(t){return function(){setTimeout(function(){for(var t=0;t<this.length;t++)this[t].serialize()}.bind(t),1)}},a=s.length-1;0<=a;a--){if(utils.now()-r>v.MAX_UPDATE_NODE_BINDING_EXECUTION_TIME){this.recorder.logger.log(this.recorder,H.EVENT_TYPES.INCOMPLETE_INPUT_CAPTURE,{});break}var c=s[a];if(c._fsrTracker)for(var h=n.length-1;0<=h;h--){var d=n[h];if(d.input==c&&d.hasChanged()){d.serialize();break}}else n[n.length]=new C(this.recorder,c),"reset"==c.getAttribute("type")&&utils.Bind(c,"record:click",o(n));c=null}!i&&this.browser.isIE&&this.mutation.setNodeSpecificBindings(t,e),t=n=s=null},v.prototype.dispose=function(){this.mutation.dispose(),this.mutation=null,this.recorder=null,this.inputCaptures=null,this.inputReserialize=null;var t,e=f._trackers;for(t=0;t<e.length;t++)e[t].dispose(),e.splice(t--,1);var i=M;for(t=0;t<i.length;t++)i[t].dispose(),i.splice(t--,1)};var S=function(t,e,i){var r=S,s=t.document;return r.ProcessHTML(r._getDocType(s)+s.querySelectorAll("html")[0].outerHTML,s,e,!!i.advancedSettings.pii.useWhiteListing,i)},i=S;S.ProcessHTML=function(t,e,i,r,s){return W.getCacheableObject(S._scrubHTML(t,r,s),i)},S._scrubHTML=function(t,e,i){var r,s=S,n=i.advancedSettings||{};if(t=Array.isArray(t)?t[0]:t||"",n.regexScrub)for(r=0;r<n.regexScrub.length;r++)t=t.replace(n.regexScrub[r],"");return t=s._removeInnerScriptContent(t),t=s._removeZeroWidthEntities(t),t=s._fixPreTags(t),t=s._fixViewState(t),t=s._stripOptionTags(t),t=s._convertSpecialChars(t,i),t=s._stripInputValues(t),t=e?s._whiteListBlock(t,e):s._maskFSRHiddenBlocks(t,e),e||fs.isDefined(n.keepComments)&&!0===n.keepComments||(t=s._removeComments(t)),t};var r=function(t){return t[0].indexOf("fsrHiddenBlock")<0?"":t[0]};S._removeComments=function(t){return/<!--/gim.test(t)?i._superReplace(t,/(<!--)[\w\W]*?(-->)/gim,r):t},S._convertSpecialChars=function(t,e){if(e.advancedSettings){var i,r=e.advancedSettings.specialMappings;if(fs.isDefined(r))for(i=0,len=r.length;i<len;i++)t=t.replace(r[i][0],r[i][1])}return t},S._removeInnerScriptContent=function(t){return/script/gim.test(t)?i._superReplace(t,/(<script[^>]*?>)[\s\S]*?(<\/[\w]*script>)/gim,function(t){return t[1]+t[2]}):t},S._maskFSRHiddenBlocks=function(t,e){return e?this._superReplace(t,new RegExp(".+","mig"),i._maskBlock):0<=t.indexOf("fsrHiddenBlock")?S._superReplace(t,new RegExp("\x3c!--(\\W)*fsrHiddenBlockStart[\\w\\W]*?fsrHiddenBlockEnd(\\W)*--\x3e","mig"),i._maskBlock):t},S._removeZeroWidthEntities=function(t){return t.replace(/(\u200B)|(\u200C)|(\u200D)|(\uFEFF)/g,"")},S._fixPreTags=function(t){return-1<t.indexOf("/pre")||-1<t.indexOf("/PRE")?i._superReplace(t,new RegExp("[\\s\\S]*?(?:\\/pre\\s*>)|[\\s\\S]+","mig"),i._removeFormat):t},S._fixViewState=function(t){return-1<t.indexOf("VIEWSTATE")?t.replace(/<input[^>]*name=["']?__VIEWSTATE[^>]*>/gim,'<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" />'):t};var a=function(t){return t[0].match(/<\/select[^>]*>/gim)?t[0]:""};S._stripOptionTags=function(t){return/select/gim.test(t)?i._superReplace(t,/(<option[^>]*>[\s\S]*?<\/[\w]*option>)/gim,a):t};var b=function(t,e,i){if(e)return e+i.replace(/[\w\d\s]/g,"*")+'"'};S._stripInputValues=function(t){return 0<t.length&&/value/.test(t)?t.replace(/(<(?:\s)*?input(?:[^>]+)value=\")([^>\"]*)\"/gim,b):t},S._superReplace=function(t,e,i){for(var r=e.exec(t),s="",n=0;fs.isDefined(r);)s+=t.substring(n,r.index),s+=i(r),n=r.index+r[0].length,r=e.exec(t);return s+=t.substring(n,t.length)};var E=function(t,e,i,r){return i||r||"*"};S._maskBlock=function(t){var e=t instanceof Array?t[0]:t||"";return 0<e.length?e.replace(/^(?!<!--.*)(>)|(&[^\s;]*;)|(<[^<>]*?>)|(<)^(?!<--.*)|\w/g,E).replace(/&((?!nbsp| |amp|quot).)*?;/g,"*"):""},S._removeFormat=function(t){var e=0,i=t[0];return i&&(i="",e=S._regexIndexOf(t[0],new RegExp("<\\s*?pre","mig")),i+=t[0].substring(0,e).replace(/\t/g," ").replace(/\s+/g," "),i+=t[0].substring(e)),i},S._regexIndexOf=function(t,e,i){var r=t.substring(i||0).search(e);return 0<=r?r+(i||0):r},S._regexLastIndexOf=function(t,e,i){for(var r=i,s=S.regexIndexOf(t,e,r);-1<s;)r=s,s=S.regexIndexOf(t,e,r+1);return r},S._getDocType=function(t){var e,i="",r=t.doctype,s=t.childNodes,n=0;if(v._browser.isIE&&("CSS1Compat"!=t.compatMode||5==t.documentMode))return i;if(r){try{if((e=(new XMLSerializer).serializeToString(r).toString())&&0<e.length)return e}catch(t){}i="<!DOCTYPE HTML",r.publicId&&(i=i+' PUBLIC "'+r.publicId+'"'),r.systemId&&(i=i+' SYSTEM "'+r.systemId+'"'),i+=">"}else if(s[n].text){for(;s[n].text&&(0===s[n].text.indexOf("\x3c!--")||0===s[n].text.indexOf("<?xml"));)n++;fs.isDefined(s[n].text)&&0===fs.toLowerCase(s[n].text).indexOf("<!doctype")&&(i=s[n].text)}return i},S._whiteListBlock=function(t,e){var i=t.indexOf("\x3c!--fsrWhiteListStart"),r="";return e?0<=i?r+=S._maskBlock(t.substring(0,i))+S._superReplace(t.substring(i),new RegExp("\x3c!--(\\W)*fsrWhiteListEnd(\\W)*--\x3e([\\W\\D\\S](?!!--(\\W)*fsrWhiteListStart(\\W)*--\x3e))*","mig"),S._maskBlock):this._superReplace(t,new RegExp(".+","mig"),S._maskBlock):t};var w={iFrameXpaths:{},performFrameBindings:function(t,e){if(!u.advancedSettings.skipIframes){var i,r,s,n,o,a=(e||t.win.document).querySelectorAll("iframe"),c=function(t){return function(){t.dispose()}},h=function(e){return function(t){w.bindToFrameLoad(t,e)}};for(i=0;i<a.length;i++){if(!((r=a[i])._fsrB||r.getAttribute("_fsrB"))&&!w.iFrameXpaths[x.getMapping(r)]){var d=this.testFrameOrigin(r),l=this.testFrameSrc(r);if(l&&d){if(w.iFrameXpaths[x.getMapping(r)]=!0,r.setAttribute("_fsrB",!0),!(s=this.getFrameWindow(r)))return;if(o=!1,n=this.getFrameDocument(s,!1)){this.unbindInternalIframes(n);try{-1<"complete, loaded".indexOf(n.readyState)&&(o=!0)}catch(t){}o&&(fs.isDefined(s.recorder)?s.recorder.serializeDom():(s.recorder=new X(t.stg,t.browser,s,x.getMapping(r),t,t.config),t.childRecorders.push(s.recorder),utils.Bind(s,"unload",c(s.recorder))))}s=n=null}else l&&!d&&(w.iFrameXpaths[x.getMapping(r)]=!0,r.setAttribute("_fsrB",!0),y.TrackFrame(x.getMapping(r),r,t));utils.BindOnce(r,"record:load",h(t))}r=null}t=a=null}},bindToFrameLoad:function(t,e){var i,r=t.originalTarget||t.target||t.srcElement;r&&this.testFrameSrc(r)&&w.testFrameOrigin(r)&&(i=w.getFrameWindow(r),w.getFrameDocument(i)&&(fs.isDefined(i.recorder)||(i.recorder=new X(e.stg,e.browser,i,x.getMapping(r),e,e.config,e.isIframeMode),e.childRecorders.push(i.recorder),i.recorder.ready.subscribe(function(){utils.Bind(i,"unload",this.dispose)}.bind(i.recorder),!0,!0))),i=null),t=e=r=null},testFrameSrc:function(t){var e,i=["javascript:","shim.gif","about:blank"];for(e=0;e<i.length;e++)if(-1<t.src.indexOf(i[e]))return!1;return!0},testFrameOrigin:function(t,e){var i=t.getAttribute("src");if(!i||0===i.indexOf(" "))return!1;var r=t.src;return utils.testSameDomain(e||window.location.href,r)},unbindInternalIframes:function(t){var e,i=t.querySelectorAll("iframe[_fsrB='true']");for(e=0;e<i.length;e++)i[e]._fsrB=!1},getFrameWindow:function(t){var e;return t&&t.contentWindow?e=t.contentWindow:t&&t.contentDocument&&t.contentDocument.defaultView&&(e=t.contentDocument.defaultView),e&&e!=e.top?e:null},getFrameDocument:function(t){try{return t.document}catch(t){return!1}}},M=[],C=function(t,e){if(!e._fsrTracker){e._fsrTracker=this,M.push(this),this.input=e,this.recorder=t;var s,n="";if(n=e.getAttribute("type")?e.getAttribute("type"):"text",this._isTextInput()&&(this.lastValue=e.getAttribute("value")||""),((!this._isTextInput()||e.value)&&("checkbox"!=n||e.checked)||e.type&&"select-one"==e.type)&&this.serialize(!0),utils.Bind(e,"record:scroll",function(){this.input&&this.recorder.getLogger().log(this.recorder,H.EVENT_TYPES.SCROLL_EL,{t:n,x:this.recorder.getLogger().logXPath(this.recorder,x.getMapping(this.input)),ps:{x:this.input.scrollLeft,y:this.input.scrollTop}})}.bind(this)),utils.Bind(e,"record:focus",function(){this.input&&(this._isTextInput()&&(this._updateCaret(),this._caretMonitor=setInterval(function(){this.input&&this._updateCaret()}.bind(this),350)),this.recorder.getLogger().log(this.recorder,H.EVENT_TYPES.FOCUS_BLUR,{t:n,st:1,x:this.recorder.getLogger().logXPath(this.recorder,x.getMapping(this.input))}))}.bind(this)),utils.Bind(e,"record:blur",function(t){this.input&&(this._isTextInput()&&clearInterval(this._caretMonitor),this.recorder.getLogger().log(this.recorder,H.EVENT_TYPES.FOCUS_BLUR,{t:n,st:0,x:this.recorder.getLogger().logXPath(this.recorder,x.getMapping(this.input))}))}.bind(this)),"checkbox"==n||"radio"==n){var i=function(){this.input&&this._lastCheckedState!=this.input.checked&&(this._lastCheckedState=this.input.checked,this.recorder.getLogger().log(this.recorder,H.EVENT_TYPES.VALUE_CHANGED,{t:n,b:this.input.checked,x:this.recorder.getLogger().logXPath(this.recorder,x.getMapping(this.input))}))}.bind(this);utils.Bind(e,"record:click",i),utils.Bind(t.win,"record:click",i)}"checkbox"!=n&&"radio"!=n&&utils.Bind(e,"record:change",function(){if(this.input){this._lastSelectListContents!=this.input.innerHTML&&this.serialize(),this.lastValue=this.input.value;var t=this.input.selectedOptions,e="";t&&0<t.length&&!this._isSecret()&&(e=t[0].innerText),this.recorder.getLogger().log(this.recorder,H.EVENT_TYPES.VALUE_CHANGED,{t:n,si:this.input.selectedIndex,x:this.recorder.getLogger().logXPath(this.recorder,x.getMapping(this.input)),v:e})}}.bind(this)),this._isTextInput()&&(this.lastValue=this.input.value,utils.Bind(e,"record:keydown",(s=this,function(t){var i,r;s.input&&(v._browser.isIE&&(t={keyCode:t.keyCode,charCode:t.charCode}),setTimeout((i=s,r=t,function(){if(i.input){i._updateCaret();var t=0;if("number"==typeof r.keyCode?t=r.keyCode:"number"==typeof r.which?t=r.which:"number"==typeof r.charCode&&(t=r.charCode),1<Math.abs(i.lastValue.length-i.input.value.length)||1<i.lastCaretInfo.e-i.lastCaretInfo.s)i.serialize();else{0===t&&32==r.charCode&&(t=r.charCode);var e=i.recorder.getLogger().logXPath(i.recorder,x.getMapping(i.input));t<=46||91<=t&&t<96||112<=t&&t<=145?i.recorder.getLogger().log(i.recorder,H.EVENT_TYPES.KEY_PRESS,{t:n,xp:e,sk:t,ps:{x:i.input.scrollTop,y:i.input.scrollLeft}}):i.recorder.getLogger().log(i.recorder,H.EVENT_TYPES.KEY_PRESS,{t:n,xp:e,v:i._filterTextIfApplicable(i.input.value.substr(i.lastCaretInfo.c-1,1)),ps:{x:i.input.scrollTop,y:i.input.scrollLeft}})}i.lastValue=i.input.value}}),1))}))),e=t=null}};C.prototype.hasChanged=function(){return this._lastCheckedState!=this.input.checked||this.lastValue!=this.input.value},C.prototype._filterTextIfApplicable=function(t){return t&&this._isSecret()?t.replace(/[^ \n\r\t]/g,"*"):t},C.prototype._isSecret=function(){var t=this.input.getAttribute("class")||this.input.getAttribute("className");return!(t&&-1<t.indexOf("fsrVisible")||-1<"reset,submit,button".indexOf(this.input.getAttribute("type")))},C.prototype._isTextInput=function(){var t="text",e=fs.toLowerCase(this.input.tagName);return this.input.getAttribute("type")&&(t=this.input.getAttribute("type")),("textarea"==e||utils.inArray(t,["text","password","textarea","number","email","url","search","color","tel",""]))&&"select"!==e},C.prototype.serialize=function(t){var e=fs.toLowerCase(this.input.tagName),i=this.input.getAttribute("type");if(i||"input"==(i=fs.toLowerCase(this.input.tagName))&&(i="text"),"hidden"!=i){if(t){if(!("radio"!=i&&"checkbox"!=i||this.input.checked))return void(this._lastCheckedState=!1);if(("text"==i||"password"==i||"textarea"==e)&&""===this.input.value)return}var r=this.recorder.getLogger(),s=H.EVENT_TYPES.INPUT_SERIALIZE,n=r.logXPath(this.recorder,x.getMapping(this.input));switch(i=-1<"select,textarea".indexOf(e)?e:i){case"textarea":r.log(this.recorder,s,{t:i,x:n,v:this._filterTextIfApplicable(this.input.value)||"",wt:z.getStyle(this.input,this.recorder.win,"width"),ht:z.getStyle(this.input,this.recorder.win,"height")});break;case"radio":case"checkbox":!this.input.checked&&t||(r.log(this.recorder,s,{t:i,x:n,b:this.input.checked}),this._lastCheckedState=this.input.checked);break;case"select":for(var o=[],a=0;a<this.input.options.length;a++)o[o.length]={v:this._filterTextIfApplicable(this.input.options[a].value),t:this._filterTextIfApplicable(this.input.options[a].text)};!this.input.multiple&&this._isSecret()&&1<o.length&&(o.length=1),r.log(this.recorder,s,{t:i,x:n,sz:{w:this.input.offsetWidth,h:this.input.offsetHeight},o:o,si:this.input.options.selectedIndex}),this._lastSelectListContents=this.input.innerHTML;break;default:r.log(this.recorder,s,{t:i,x:n,v:this._filterTextIfApplicable(this.input.value)||""})}}},C.prototype._updateCaret=function(){var t,e,i=this._getCaretInfo(this.input),r=this.recorder?this.recorder.getLogger():null;!r||this.lastCaretInfo&&this.lastCaretInfo.s==i.s&&this.lastCaretInfo.e==i.e&&this.lastCaretInfo.c==i.c||setTimeout((t=this,e={x:r.logXPath(this.recorder,x.getMapping(this.input)),ci:i},function(){t&&t.recorder&&t.recorder.getLogger().log(t.recorder,H.EVENT_TYPES.CARET_INFO,e)}),20),this.lastCaretInfo=i},C.prototype._getCaretInfo=function(t){var e={s:0,e:0,c:0};if(t){var i=t.value,r=t.ownerDocument;if(v._browser.isIE&&r.selection){if("textarea"==fs.toLowerCase(t.tagName)&&r.selection){i.charCodeAt(i.length-1)<14&&(i=i.replace(/34/g,"")+String.fromCharCode(28));var s=r.selection.createRange(),n=s.duplicate();n.moveToElementText(t),n.setEndPoint("StartToEnd",s),e.e=i.length-n.text.length,n.setEndPoint("StartToStart",s),e.s=i.length-n.text.length,e.c=e.e,i.substr(i.length-1)==String.fromCharCode(28)&&(i=i.substr(0,i.length-1));var o=i.substr(0,e.s).split("\n").length-1,a=i.substr(0,e.c).split("\n").length-1,c=i.substr(0,e.e).split("\n").length-1;e.c-=a,e.s-=o,e.e-=c}else if(r.selection){var h=r.selection.createRange(),d=h.duplicate();e.s=0-d.moveStart("character",-1e5),e.e=e.s+h.text.length,e.c=e.e}}else try{e.s=t.selectionStart,e.e=t.selectionEnd,e.c=e.e}catch(t){}!e.s&&e.s<0&&(e={s:0,e:0,c:0})}return e},C.prototype.dispose=function(){this.input._fsrTracker=null,this.recorder=null,this.lastValue=null,this.input=null,this.lastCaretInfo=null,this._lastSelectListContents=null,clearTimeout(this._caretMonitor)};var k=function(t){this._elementCache={},this._callbackTimer=null,this.recorder=t,this.cacheIndex=0,t=null};k.prototype.dispose=function(){fs.dispose(this._elementCache),this._elementCache=null,this.recorder=null,clearTimeout(this._callbackTimer)},k.prototype.push=function(t,e,i,r){var s={t:t,c:e,i:i,p:r,d:utils.now()};r=r||"",t&&1!=t.nodeType&&(t=t.parentNode),t&&this._elementCache&&(t._fsrKey||(t._fsrKey={id:"_"+this.cacheIndex++}),this._elementCache[t._fsrKey.id+fs.toLowerCase(r)]=s,this._callbackTimer||(this._callbackTimer=setTimeout(function(){this.handleEvents()}.bind(this),1e3)),e=t=null)},k.prototype.handleEvents=function(){this._callbackTimer=null;try{this.recorder.win.document}catch(t){return}var t,e=this._elementCache,i=utils.now();for(var r in e)(t=e[r])._fsrKey=null,"object"==typeof t&&t.t&&t.t.nodeName&&"svg"!=t.t.nodeName&&(t.c(i-t.d),fs.dispose(t),t=null);fs.dispose(this._elementCache),this._elementCache={},e=null},k.prototype.accelerate=function(){this.handleEvents()};var O=function(t){this.config=t.config,this.recorder=t,this.mutationSynonym=window.MutationObserver?"MutationObserver":!!window.WebKitMutationObserver&&"WebKitMutationObserver",this.domMethodCopies=[],this.domMethodRewrites=[],this.domUpdateThrottler=new k(this.recorder),this.supportsDomPrototypes=!v._browser.isIE||(fs.isDefined(t.win.Element)||fs.isDefined(t.win.HTMLElement))&&!u.useEleMutation,this.setupMutationObserver(this.recorder,this)||v._browser.isIE&&(this.saveDomMutationMethods(),this.supportsDomPrototypes&&this.overrideDomPrototype(),this.setNodeSpecificBindings(this.recorder.win.document),this.recorder.DomUpdated.subscribe(function(t){this.setNodeSpecificBindings(t),t=null}.bind(this))),t=null};O.mutatorInfo={ignoreNodeContentsList:"input,select,img,link,meta,title,textarea,br,hr,script".split(","),watchNodeList:"html,head,header,h1,h2,h3,h4,h5,article,aside,section,details,footer,figure,nav,body,div,span,ul,li,dd,dt,ol,dl,tr,td,span,form,img,a,area,iframe,fieldset,select,input,textarea,table,label",svgWatchNodeList:"svg,defs,g,symbol,use,circle,ellipse,line,polygon,polyline,rect,linearGradient,radialGradient,animate,animateColor,animateMotion,animateTransform,set,stop,a,altGlyphDef,clipPath,color-profile,cursor,filter,font,font-face,foreignObject,image,marker,mask,pattern,switch,text,view,path,clippath",domRewriteList:"appendChild,removeChild,removeNode,insertAdjacentHTML,replaceChild,replaceNode,swapNode,insertBefore".split(",")};var N=O.mutatorInfo;O.prototype.setupMutationObserver=function(t,e){var i=this.mutationSynonym,r=e.domAttrModifiedHandler(t,e,this.config,!0),s=e.domSubtreeModifiedHandler(t,e,this.config,!0);if(i)return e.mutationObserver=new window[i](function(t){t.forEach(function(t){var e;switch(t.type){case"attributes":I(t.attributeName,t.target.tagName)&&(e={target:t.target,attrName:t.attributeName,newValue:t.target.getAttribute(t.attributeName)},r(e)),e=null;break;case"characterData":e={target:t.target.parentNode},s(e);break;case"childList":L(t)&&(e={target:t.target},s(e),e=null)}})}),this.mutationConfig={attributes:!0,childList:!0,subtree:!0},e.mutationObserver.observe(t.win.document,this.mutationConfig),!0};var L=function(t){var e;if(t.addedNodes&&0<t.addedNodes.length)for(e=0;e<t.addedNodes.length;e++)if("SCRIPT"!=t.addedNodes[e].tagName)return!0;if(t.removedNodes&&0<t.removedNodes.length)for(e=0;e<t.removedNodes.length;e++)if("SCRIPT"!=t.removedNodes[e].tagName)return!0},I=function(t,e){return!(!t||"_"==t.substr(0,1)||"on"==t.substr(0,2)||"href"==t||0<="script,meta,title".indexOf(e))&&(!(0===t.indexOf("siz")||0===t.indexOf("jQuery"))||0===t.indexOf("_fsrb"))};O.prototype.propertyChangeHandler=function(t){var a=t.propertyName,e=t.srcElement,n=this.config;if(I(a,e.tagName)){if("innerHTML"==a||"innerText"==a||"outerHTML"==a)("outerHTML"==a||e.tagName&&"SELECT"==e.tagName)&&(e=e.parentNode),this.mutationSynonym||this.domUpdateThrottler.push(e,(o=this,l=e,function(t){var e=o.recorder,i=e.masker._tagDynamicMaskNodes(l,!1,e.win),r=x.getMapping(l),s=e.getLogger();s&&(s.log(e,H.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED,{x:s.logXPath(e,r),h:S.ProcessHTML(l.innerHTML,e.win.document,r,i,n)},null,t),o._handleDomUpdateIfNecessary(l)),i=o=l=null}),!1);else if("on"!=a.substring(0,2)){for(var i=0;i<N.domRewriteList.length;i++)if(a==N.domRewriteList[i])return;if("on"==fs.toLowerCase(a.substr(0,2)))return;var c=e[a];-1<a.indexOf("style.")&&(a="style",c=e.getAttribute(a)),this.mutationSynonym||this.domUpdateThrottler.push(e,(h=this,d=e,function(t){if(h.recorder.masker._tagDynamicMaskNodes(d,!1,h.recorder.win),"style"==a){var e=d.getAttribute("style")||d.style;e&&e.cssText&&(c=e.cssText)}var i=h.recorder.getLogger(),r=x.getMapping;if(i)if("style"==a){c&&"null"!=c||(c="");var s=i.logXPath(h,r(d,null,"id"==a)),n=d.getAttribute("style")||d.style;n&&i.log(h.recorder,H.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:a,v:void 0!==n.cssText?n.cssText:n+"",x:s},null,t)}else{var o=fs.toLowerCase(d.tagName);"object"==typeof c||"value"==a&&"input"==o&&"hidden"==d.type||utils.inArray(o,["input","select","textarea"])&&!utils.inArray(a,["className","cols","rows","class","width","height","align"])||i.log(h.recorder,H.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:a,v:c+"",x:i.logXPath(h,r(d,null,"id"==a))},null,t)}d=i=h=null}),!0,a)}var h,d,o,l;t=e=null}else e=null},O.prototype.domSubtreeModifiedHandler=function(t,a,c){return function(t){var e,i,r,s,n=t.originalTarget||t.target||t.srcElement,o=fs.toLowerCase(n.tagName);if(utils.inArray(o,N.ignoreNodeContentsList))"select"==o&&null!==n._fsrTracker&&a.domUpdateThrottler.push(n,(i=n,function(){i._fsrTracker&&i._fsrTracker.serialize()}),!1);else{if(c.advancedSettings&&c.advancedSettings.svgCaptureEnabled&&utils.inArray(o,N.svgWatchNodeList.split(","))){for(e=n;!e.innerHTML&&e.parentNode;)e=e.parentNode;n=e}a.domUpdateThrottler.push(n,(r=n,s=a,function(t){s._doDomUpdateWorkWithLog&&s._doDomUpdateWorkWithLog(r,t)}),!1)}}};O.prototype.domAttrModifiedHandler=function(s,n,t){return function(t){var o,a,c,h,e=t.attrName,i=t.newValue,r=t.originalTarget||t.target||t.srcElement;"on"==e.substr(0,2)||-1<"script,meta,title".indexOf(r.tagName)||(n.domUpdateThrottler.push(r,(o=r,a=e,c=i,h=s,function(t){var e,i=h.getLogger(),r=x.getMapping;if(i)if("class"==a&&h.masker._tagDynamicMaskNodes(o,!0,h.win),"style"==a){e=i.logXPath(h,r(o,null,"id"==a));var s=o.getAttribute("style")||o.style;s&&"_fsrb"!=a&&i.log(h,H.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:a,v:void 0!==s.cssText?s.cssText:s+"",x:e},null,t)}else if("_fsrb"!=a&&("value"!=a||"INPUT"!=o.tagName||"hidden"!=o.type)&&"on"!=fs.toLowerCase(a.substr(0,2))){var n=r(o,null,"id"==a);e=i.logXPath(h,n),i.log(h,H.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:a,v:c,x:e},null,t)}}),!0,e),r=null)}},O.prototype._doDomUpdateWorkWithLog=function(t,e){var i=this.recorder;3==t.nodeType&&(t=t.parentNode);var r=x.getMapping(t);if(0===r[0].indexOf("html")){var s=this.recorder.masker._tagDynamicMaskNodes(t,!1,i.win),n=t.innerHTML?S.ProcessHTML(t.innerHTML,i.win.document,r,s,this.config):{},o=i.getLogger();o&&(o.log(i,H.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED,{x:o.logXPath(i,r),h:n},null,e),this._handleDomUpdateIfNecessary(t))}},O.prototype._handleDomUpdateIfNecessary=function(t){var e=fs.toLowerCase(t.tagName);1!=t.nodeType||utils.inArray(e,O.ignoreNodeContentsList)||this.recorder.DomUpdated.fire(t)},O.prototype.setNodeSpecificBindings=function(t){for(var e,i=t.querySelectorAll(N.watchNodeList+", "+N.svgWatchNodeList),r=(e=this,function(t){e.propertyChangeHandler(t)}),s=i.length-1;0<=s;s--){var n,o=i[s];if(utils.BindOnce(o,"record:propertychange",r,!0,!0),!this.supportsDomPrototypes)if(!o.getAttribute("_fsrRewrite")){o.setAttribute("_fsrRewrite","true");for(var a=N.domRewriteList.length-1;0<=a;a--)o[n=N.domRewriteList[a]]=this.domMethodRewrites[n]}o=null}r=t=i=null},O.prototype.methodRewriter=function(r,s){var c=this.config;return function(){var e,t=this.parentNode,i=s.domMethodCopies[r];if(i){if("BODY"==this.tagName)try{e=i(arguments[0],arguments[1])}catch(t){e=i.apply(this,arguments)}else e=i.apply(this,arguments);var o,a;return t&&1==t.nodeType&&s.domUpdateThrottler.push(t,(o=s,a=t,function(t){var e,i,r=o.recorder.masker._tagDynamicMaskNodes(a,!1,o.recorder.win),s=x.getMapping(a),n=o.recorder.getLogger();if(n){if(e=fs.toLowerCase(a.tagName),u.svgCaptureEnabled&&utils.inArray(e,N.svgWatchNodeList.split(","))){for(i=a;!i.innerHTML;){if(!i.parentNode)return;i=i.parentNode}a=i}n.log(o.recorder,H.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED,{x:n.logXPath(o.recorder,s),h:S.ProcessHTML(a.innerHTML,o.recorder.win.document,s,r,c)},null,t),o._handleDomUpdateIfNecessary(a)}r=o=a=null}),!1),e}}},O.prototype.saveDomMutationMethods=function(){var t,e;for(e=N.domRewriteList.length-1;0<=e;e--)t=N.domRewriteList[e],this.domMethodCopies[t]=this.recorder.win.document.body[t],this.domMethodRewrites[t]=this.methodRewriter(t,this)},O.prototype.overrideDomPrototype=function(){var t,e,i=this.recorder.win,r=fs.isDefined(i.Element)?i.Element.prototype:void 0,s=fs.isDefined(i.HTMLElement)?i.HTMLElement.prototype:void 0;for(e=N.domRewriteList.length-1;0<=e;e--)t=N.domRewriteList[e],r&&-1<(r[t]+"").indexOf("native")&&(r[t]=this.domMethodRewrites[t]),s&&-1<(s[t]+"").indexOf("native")&&(s[t]=this.domMethodRewrites[t])},O.prototype.removeDomPrototypeOverrides=function(){var t,e,i=this.recorder.win,r=fs.isDefined(i.Element)?i.Element.prototype:void 0,s=fs.isDefined(i.HTMLElement)?i.HTMLElement.prototype:void 0;for(e=N.domRewriteList.length-1;0<=e;e--)t=N.domRewriteList[e],r&&r[t]&&delete r[t],s&&s[t]&&delete s[t]},O.prototype.dispose=function(){this.domUpdateThrottler&&(this.domUpdateThrottler.accelerate(),this.domUpdateThrottler.dispose()),fs.dispose(this.domMethodCopies),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.supportsDomPrototypes&&v._browser.isIE&&this.removeDomPrototypeOverrides(),this.domMethodCopies=null,this.domMethodRewrites=null,this.recorder=null};var x={getMapping:function(t,e,i){if(e=e||[],t.parentNode&&(e=x.getMapping(t.parentNode,e)),1==t.nodeType){var r,s;if(t.previousSibling){for(r=1,s=t.previousSibling;1==s.nodeType&&s.nodeName==t.nodeName&&r++,s=s.previousSibling;);1==r&&(r=null)}else if(t.nextSibling)for(s=t.nextSibling;s=1==s.nodeType&&s.nodeName==t.nodeName?(r=1,null):(r=null,s.previousSibling););e.push(D(t,r,!!i))}return e}},D=function(t,e,i){var r;return t.getAttribute&&(r=t.getAttribute("id"))&&-1<r.indexOf("yui_")&&(r=null),fs.toLowerCase(t.nodeName)+(r&&!i?"[@id='"+r+"']["+(e||1)+"]":0<e?"["+e+"]":"")};x.getNodeXPathPosition=function(t){for(var e=t.nodeType,i=t.tagName,r=0,s=t.parentNode.childNodes,n=s.length,o=0;r<n&&s[r];){if(s[r].nodeType==e&&(i&&i==s[r].tagName||!i)&&(o++,s[r]==t))return o;r++}return 0};var A=function(){},P="fsrHiddenBlockStart",R="fsrHiddenBlockEnd",B="fsrWhiteListStart",U="fsrWhiteListEnd";(A.prototype={useWhiteListing:!1,dynamicWhiteListUnblocks:[],dynamicSelectorsToMask:[],dynamicSelectorsToUnmask:[],dynamicWhiteListEls:[],dynamicSelectorsToRemask:[],dynamicSelectorsToBlockAssets:[],staticWhiteListEls:[],isMasking:!1,noMaskClassArray:[]})._maskStaticBySelector=function(t,e,i){var r,s,n,o=e.document,a=o.querySelectorAll(t),c="_fsrWL";for(this.blockingCommentStart=i?B:P,this.blockingCommentEnd=i?U:R,r=0;r<a.length;r++)"BODY"==(s=a[r]).nodeName?utils.hasClass(s,c)||(utils.addClass(s,c),s.insertBefore(o.createComment(this.blockingCommentStart),s.firstChild),s.appendChild(o.createComment(this.blockingCommentEnd))):(n=s.parentNode,utils.hasClass(n,c)||(s.insertBefore(o.createComment(this.blockingCommentStart),s.firstChild),s.appendChild(o.createComment(this.blockingCommentEnd))))},A.prototype._remaskBySelector=function(t,e){utils.removeClass(e.document.querySelectorAll(t),"fsrVisible")},A.prototype._unmaskStaticBySelector=function(t,e){utils.addClass(e.document.querySelectorAll(t),"fsrVisible")},A.prototype._obscureBySelector=function(t,e){utils.addClass(e.document.querySelectorAll(t),"fsrObscure")},A.prototype._maskDynamicBySelector=function(t,e,i){0<t.length&&"string"==typeof t&&(void 0===i||""===i||"inTxBlk"==i?(this._maskStaticBySelector(t,e,!1),this.dynamicSelectorsToMask[this.dynamicSelectorsToMask.length]=t):"evUnblk"==i?(this._unmaskStaticBySelector(t,e),this.dynamicSelectorsToUnmask[this.dynamicSelectorsToUnmask.length]=t):"evReblk"==i?(this._remaskBySelector(t,e),this.dynamicSelectorsToRemask[this.dynamicSelectorsToRemask.length]=t):"DOMWL"==i&&(this._maskStaticBySelector(t,e,!0),this.dynamicWhiteListUnblocks[this.dynamicWhiteListUnblocks.length]=t))},A.prototype._maskTitleTag=function(t,e){if(t)for(var i=e.location.href,r=e.document,s=r.head,n=s.getElementsByTagName("title")[0],o=0,a=t.length;o<a;o++)if(utils.testAgainstSearch(t[o],i)){s.insertBefore(r.createComment(P),n),s.insertBefore(r.createComment(R),n.nextSibling);break}},A.prototype._unmaskDynamicBySelector=function(t,e){this._maskDynamicBySelector(t,e,"evUnblk")},A.prototype._maskAssetDynamicBySelector=function(t,e){if(utils.addClass(e.document.querySelectorAll(t),"fsrHidden"),0<t.length){"string"==typeof t&&(t=[t]);for(var i=this.dynamicSelectorsToBlockAssets,r=0;r<t.length;r++)i[i.length]=t[r]}},A.prototype._removeVisibility=function(t,e){this._maskDynamicBySelector(t,e,"evReblk")},A.prototype._whiteListUnblockDynamic=function(t,e){this._maskDynamicBySelector(t,e,"DOMWL")},A.prototype.addClassToNoMaskArray=function(t){this.noMaskClassArray[this.noMaskClassArray.length]=t},A.prototype.isNodeMasked=function(t){var e,i,r,s=!0;if(0<this.noMaskClassArray.length&&t.className)for(e=this.noMaskClassArray,i=0;i<e.length;i++)r=e[i],-1<t.className.indexOf(r)&&(s=!1),i=r=null;return t.childNodes.length<1||!s||!!(t.childNodes[0].data&&-1<t.childNodes[0].data.indexOf(this.blockingCommentStart))},A.prototype._tagDynamicMaskNodes=function(t,e,i){var r,s,n,o=i.document,a=!1;if(!this.isMasking){if(this.isMasking=!0,this.useWhiteListing){if(a=!0,0<this.dynamicWhiteListUnblocks.length&&!e)for(r=0,s=(n=o.querySelectorAll(this.dynamicWhiteListUnblocks.join(","))).length;r<s;r++)if(z.nodeBelongsTo(t,n[r])||n[r]==t){if(!this.isNodeMasked(t)){a=!1;break}}else z.nodeBelongsTo(n[r],t)&&(this.isNodeMasked(n[r])||utils.hasClass(n[r],"_fsrWL")||(utils.addClass(n[r],"_fsrWL"),n[r].insertBefore(o.createComment(B),n[r].firstChild),n[r].appendChild(o.createComment(U))))}else if(0<this.dynamicSelectorsToMask.length&&!e)for(r=0,s=(n=o.querySelectorAll(this.dynamicSelectorsToMask.join(","))).length;r<s;r++)if(z.nodeBelongsTo(t,n[r])||n[r]==t){if(!this.isNodeMasked(t)){a=!0;break}}else z.nodeBelongsTo(n[r],t)&&(this.isNodeMasked(n[r])||(n[r].insertBefore(o.createComment(P),n[r].firstChild),n[r].appendChild(o.createComment(R))));if(0<this.dynamicSelectorsToUnmask.length){for(r=this.dynamicSelectorsToUnmask.length-1;0<=r;r--)utils.addClass(o.querySelectorAll(this.dynamicSelectorsToUnmask[r]),"fsrVisible");for(s=this.dynamicSelectorsToRemask.length-1;0<=s;s--)utils.removeClass(o.querySelectorAll(this.dynamicSelectorsToRemask[s]),"fsrVisible")}if(0<this.dynamicSelectorsToBlockAssets.length)for(r=this.dynamicSelectorsToBlockAssets.length-1;0<=r;r--)utils.addClass(o.querySelectorAll(this.dynamicSelectorsToBlockAssets[r]),"fsrHidden");this.isMasking=!1}return a},A.prototype.maskDocument=function(t,e){var o=fs.toLowerCase(e.location.href||"about:blank");if(this.useWhiteListing=!1,t.staticWhiteListEls)for(var i in t.staticWhiteListEls)if(t.staticWhiteListEls.hasOwnProperty(i)&&(-1<o.indexOf(i)||utils.testAgainstSearch(i,o))){this.useWhiteListing=!0;break}if(t.dynamicWhiteListEls)for(var r in t.dynamicWhiteListEls)if(t.dynamicWhiteListEls.hasOwnProperty(r)&&(-1<o.indexOf(r)||utils.testAgainstSearch(r,o))){this.useWhiteListing=!0;break}t.useWhiteListing=this.useWhiteListing;var s=function(t,e,i,r,s){for(var n in e)(-1<o.indexOf(n)||utils.testAgainstSearch(n,o))&&i.call(t,e[n],r,s)};this.useWhiteListing?(s(this,t.staticWhiteListEls,this._maskStaticBySelector,e,!0),s(this,t.dynamicWhiteListEls,this._whiteListUnblockDynamic,e)):(s(this,t.staticBlockEls,this._maskStaticBySelector,e),s(this,t.dynamicBlockEls,this._maskDynamicBySelector,e)),this._maskTitleTag(t.blockTitleEl,e),s(this,t.staticVisibleEls,this._unmaskStaticBySelector,e),s(this,t.dynamicVisibleEls,this._unmaskDynamicBySelector,e),s(this,t.assetBlockEls,this._maskAssetDynamicBySelector,e),s(this,t.removeVisibilityEls,this._removeVisibility,e),s(this,t.obscureEls,this._obscureBySelector,e)};var W={_browser:null,_cacheList:[],getCacheableObject:function(t,e){var i=W._browser.isMobile;e&&e.join&&(e=e.join(","));var r,s={},n=W._cacheList;for(r=n.length-1;0<=r;r--)if(n[r].str==t){s.uid=n[r].uid;break}if(!fs.isDefined(s.uid)){if(s.uid=utils.generateGUID(),(s.kl=e)&&100<t.length)for(r=n.length-1;0<=r;r--)if(n[r].kl==e){var o=F(n[r].str,t);s.diff={uid:n[r].uid,d:o};break}fs.isDefined(s.diff)?(!i||n.length<500)&&(n[n.length]={str:t,uid:s.uid,kl:s.kl}):(s.str=t,(!i||n.length<500)&&(n[n.length]=s))}return s},reset:function(){W._cacheList=[]}},F=function(t,e){for(var i=t,r=e,s=t.length,n=e.length,o=n<s?n:s,a=0,c=0,h=0;15<o-a;)h=o-Math.round((o-a)/2),i.substr(0,h)!=r.substr(0,h)?o=h:a=h;var d=e.substr(a);for(o=d.length;15<o-c;)h=o-Math.round((o-c)/2),d.substr(d.length-h)!=i.substr(i.length-h)?o=h:c=h;return{o:a,c:c,r:e.substring(a,e.length-c)}},V=[],H=function(t,e,i,r){this.config=r,this.recorder=i,this.browser=e,this.cors=new utils.AjaxTransport,this.isIframeMode=i.isIframeMode;var s=t.get([m,_,T,"pv"]),n=s[m],o=s[_],a=s[T],c=utils.getScreenResolution();this.stg=t,this.pageViews=t.get("pv"),this.failCount=0,this.transportid=0,this.lastTransmissionTime=0,this.holdTransmits=!1,this.transmitting=!1,this.canceled=!1,this.siteid=r.clientId||"unk",this.domain=document.domain.toString(),this.StorageReady=new utils.FSEvent,this.TransportReady=new utils.FSEvent,this._quickXpathCache={},this._session={},this._reset(),this.isIframeMode?(this.TransportReady.fire(),this.transmitting=!0,this.StorageReady.fire(),this.iFrameCommitItv=setInterval(this._flushAndTransmit.bind(this),1e3)):(this.log(i,H.EVENT_TYPES.PAGE_MARKER,{dtm:fs.startTS,ofs:(new Date).getTimezoneOffset(),v:e.browser.name,dv:e.browser.version,sid:r.clientId,r:"W3C",l:r.layout,m:e.isMobile,f:document.referrer.toString(),sz:{w:c.w,h:c.h}},-1),utils.Bind(window,"unload",function(){this.commitData()}.bind(this)),this._backup_storage=new utils.DomStorage(this.siteid,!1,!1,e),this._storage=new utils.WindowStorage(this.siteid,!1,e),this._syncStorage(),this._syncSession(n,!!o,!!a),this._syncData(),this.startStateMonitor(),this.startStorageMonitor(),this.TransportReady.subscribe(function(){this.StorageReady.fire(),this.transmitting&&this.startHeartbeat(),this._flushAndTransmit()}.bind(this),!0,!0),this.TransportReady.fire(),this.recorder.ready.subscribe(function(){this.recorder.EmergencySendRequired.subscribe(function(){this._flushAndTransmit(!0)}.bind(this))}.bind(this),!0,!0)),i=null};H.prototype.commitData=function(){this._flush(),this.transmitting&&this._transmit(),this._storage&&(this._storage.set(n,this._session),this._storage.setBlob(this._data),this._storage.commit()),this._backup_storage&&(this._backup_storage.set(n,this._session),this._backup_storage.setBlob(this._data),this._backup_storage.commit())},H.prototype.dispose=function(){V=[],this._flush(),this.cors.dispose(),this.iFrameCommitItv&&clearInterval(this.iFrameCommitItv),this.recorder.EmergencySendRequired.unsubscribeAll(),this.recorder.EmergencySendRequired=null,this.stopStorageMonitor(),this.stopStateMonitor()},H.prototype.setTransmitOK=function(){this.canceled||(this.transmitting=!0,this._session[_]=!0,this.stg.set(_,!0),this._flushAndTransmit(),this.startHeartbeat())},H.prototype.setTransmitNotOK=function(){this.stopHeartbeat(),this.transmitting=!1,this._session[_]=!1,this.stg.set(_,!1)},H.prototype.cancelRecord=function(t){this.setTransmitNotOK(),this.stopStateMonitor(),this.stopStorageMonitor(),this.canceled=!0,this._session[T]=!0,this.stg.set(T,!0),t&&this.stg.set(_SESSION_SYMBOLS.CANCELEDPERMANENT,this.cancel),this.iFrameCommitItv&&clearInterval(this.iFrameCommitItv),this._reset()},H.prototype._syncStorage=function(){var t,e,i=this._storage,r=this._backup_storage;i&&r&&i.isNew()&&!r.isNew()&&(t=r.get(n),i.set(n,t),e=r.getBlob(),i.setBlob(e))},H.prototype._syncSession=function(t,e,i){var r=this._storage;this._backup_storage;if(r){if(this.refreshLastTime=this.stg.get(o),this.refreshLastTime){this.refreshLastTime=parseInt(this.refreshLastTime);36e5<utils.now()-this.refreshLastTime&&(t=null,r.erase(n),this.stg.erase(m))}r.get(n)?(this._session=r.get(n),this.sessionid=this._session[s],this.gsessionid=this._session[m],r.set(s,this.sessionid),fs.isDefined(e)?(this.transmitting=e,this._session[_]=this.transmitting):(this.transmitting=this._session[_],this.stg.set(_,this.transmitting)),fs.isDefined(i)?(this.canceled=i,this._session[T]=this.canceled):(this.canceled=this._session[T],this.stg.set(T,this.canceled)),r.set(n,this._session)):(this._session={},this.sessionid=utils.generateGUID(),this._session[s]=this.sessionid,t||(t=utils.generateGUID()),this.gsessionid=t,this._session[m]=this.gsessionid,this.transmitting=e,this._session[_]=this.transmitting,this.stg.set(_,this.transmitting),this.canceled=i,this._session[T]=this.canceled,this.stg.set(T,this.canceled),this.stg.set(m,t),r.set(n,this._session),r.commit()),this.refreshLastTime=utils.now(),this._session[o]=this.refreshLastTime,this.stg.set(o,this.refreshLastTime)}},H.prototype._syncData=function(){this._storage?this._data=this._storage.getBlob():this._backup_storage&&(this._data=this._backup_storage.getBlob())},H.prototype._flushAndTransmit=function(t){if((this._storage||this._backup_storage)&&!this.canceled||this.isIframeMode){var e=this.testStorageLimit();this.transmitting&&(5e3<utils.now()-this.lastTransmissionTime||t)||e||this.isIframeMode?(this._flush(),this._transmit()):t&&this.browser.isMobile&&this.commitData()}},H.prototype.processImmediately=function(t){this.cors.send({method:"GET",url:utils.sign(fs.config.recUrl+"process/"+fs.enc(this.gsessionid)+"?delay="+(t||0)),failure:function(t){}.bind(this),success:function(t){}.bind(this)})},H.prototype._transmit=function(){if(0!==this._data.length||this.isIframeMode)if(this.isIframeMode)0<this._data.length&&(y.SendDataToParentFrame(this.recorder.iFrameParentFr,this.recorder.ifrid,this._data),this._data="");else if(this.holdTransmits&&utils.now()-this.lastTransmissionTime<1e4)this.hasEmergency=!0;else{this.holdTransmits=!0,this.hasEmergency=!1,this.lastTransmissionTime=utils.now();var t,i,r,s,e="corsservice",n=fs.toLowerCase(this.siteid.replace(/[- _.&]/g,"")),o='{"data":['+this._data+"]}",a=o.length;Y.set("rtp",e.substr(0,1)),!this.config.advancedSettings.skipCompression&&1e3<a&&a<1e6&&(o=utils.Compress.fragmentAndCompress(o)),t="datalen:"+o.length+",time:"+utils.now(),Y.increment("rta"),this.cors.send({action:"data",method:"POST",contentType:"text/plain;charset=UTF-8",encoding:fs.enc(z.getEncoding()),version:5,gSessionId:this.gsessionid,sessionId:this.sessionid,domain:this.domain||window.location.hostname,siteId:n,url:fs.config.recUrl+e+"?action=data&metadata="+fs.enc(t)+"&encoding="+fs.enc(z.getEncoding())+"&session_id="+fs.enc(this.sessionid)+"&global_session_id="+fs.enc(this.gsessionid)+"&domain="+fs.enc(this.domain)+"&site_id="+fs.enc(n)+"&version=5.0&cachebust="+Math.random(),skipEncode:!0,data:o,failure:function(t){h.jrny.addEventString(c),Y.increment("rtf"),this.failCount++,this.holdTransmits=!1;try{t=JSON.parse(t)}catch(t){}if(fs.isDefined(t.status)){var e=Math.abs(parseInt(t.status));Y.increment("rtf"+e)}if(10<this.failCount)return Y.set("rtcr",1),Y.set("rtcp",this.pageViews),void this.cancelRecord();this.hasEmergency&&setTimeout(function(){this._flushAndTransmit(!0)}.bind(this),100)}.bind(this),success:(i=this,r=this.transportid,s=this._data+"",function(t){Y.increment("rts"),i.failCount=0,i.holdTransmits=!1;try{t=JSON.parse(t)}catch(t){}if(fs.isDefined(t.status)){var e=parseInt(t.status,10);if(1==e)r==i.transportid?i._data="":i._data.substr(0,s.length)==s&&(i._data=i._data.substr(s.length));else if(2==e)return Y.set("rtcr",2),Y.set("rtcp",i.pageViews),void i.cancelRecord();i.hasEmergency&&setTimeout(function(){i._flushAndTransmit(!0)},100)}})})}},H.prototype._ping=function(){if(fs.isDefined(this.transport)&&!this.canceled){var t=fs.toLowerCase(this.siteid.replace(/[- _.&]/g,""));this.transport||(this.transport=new this.transport),this.cors.send({action:"ping",contentType:"text/plain;charset=UTF-8",sessionId:this.sessionid,siteId:t,url:fs.config.recUrl+"corsservice?action=ping&session_id="+fs.enc(this.sessionid)+"&site_id="+fs.enc(t)+"&cachebust="+Math.random(),skipEncode:!0,data:"",failure:function(){},success:function(){}})}},H.prototype._reset=function(){this._log={start:this._log?utils.now():fs.startTS,log:[],guid:utils.generateGUID()},this._log_size_est=0},H.prototype._flush=function(){if(0!==this._log.log.length){this.transportid++,this._log.log.toJSON=null;var t=JSON.stringify(this._log);t&&0<t.length&&(this._data&&0<this._data.length?this._data=this._data+","+t:this._data=t),this._reset()}},H.prototype.logXPath=function(t,e){if(!this.canceled){if(e=e.join(","),!fs.isDefined(this._quickXpathCache[e])){V[V.length]=e;var i=this.recorder.iFramexPathPrefix+(V.length-1);this._quickXpathCache[e]=i,this.log(t,H.EVENT_TYPES.XPATH_CACHE,{idx:i,xp:e},i)}return this._quickXpathCache[e]}},H.prototype.log=function(t,e,i,r,s){if(!this.canceled){var n=0;s||(s=0);var o={x:fs.isDefined(r)?r:this.logXPath(t,t.getPath()),e:e,d:i,t:Math.max(0,utils.now()-this._log.start-s)};this._log.log[this._log.log.length]=o,e==H.EVENT_TYPES.DOM_SERIALIZE?i.dom.str&&(n=i.dom.str.length,this._log_size_est+=n):e==H.EVENT_TYPES.CSS_SERIALIZE?i.stylesheet?(n=i.stylesheet.length,this._log_size_est+=n):i.v&&(n=Math.round(1*i.v.length),this._log_size_est+=n):(e==H.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED?i.h.str||i.h.diff?(n=Math.round(1*((i.h.str?i.h.str.length:0)+(i.h.diff?i.h.diff.d.r.length:0)+(i.h.kl?i.h.kl.length:0)+(i.h.uid?i.h.uid.length:0))),n+=50):n=84:n=60,this._log_size_est+=n)}},H.prototype.testStorageLimit=function(){return!this.isIframeMode&&3e6<this._data.length+this._log_size_est},H.prototype._monitorState=function(){var t=this.stg.get([T,_]),e=t[T],i=t[_];fs.isDefined(e)&&this.canceled!=e&&e?this.cancelRecord():fs.isDefined(i)&&this.transmitting!=i&&(i?this.setTransmitOK():this.setTransmitNotOK())},H.prototype.startHeartbeat=function(){this.heartbeatTransmit||(this._ping(),this.heartbeatTransmit=setInterval(function(){this._ping()}.bind(this),45e3))},H.prototype.stopHeartbeat=function(){this.heartbeatTransmit&&(clearInterval(this.heartbeatTransmit),delete this.heartbeatTransmit)},H.prototype.startStateMonitor=function(){this.stateMonitor||(this._monitorState(),this.stateMonitor=setInterval(function(){this._monitorState()}.bind(this),2e3))},H.prototype.stopStateMonitor=function(){this.stateMonitor&&(clearInterval(this.stateMonitor),delete this.stateMonitor)},H.prototype.startStorageMonitor=function(){this.storageMonitor||(this.storageMonitor=setInterval(function(){this.log(this.recorder,H.EVENT_TYPES.HEARTBEAT,{ofs:(new Date).getTimezoneOffset()},-1),this._flushAndTransmit()}.bind(this),this.browser.isMobile?1e4:2e4))},H.prototype.stopStorageMonitor=function(){this.storageMonitor&&(clearInterval(this.storageMonitor),delete this.storageMonitor)},H.prototype.clearState=function(){this._session=!1,this._storage.kill(),this._backup_storage.kill(),this.commitData()},H.EVENT_TYPES={DOM_SERIALIZE:0,XPATH_CACHE:1,FRAME_SIZE:2,FRAME_SCROLL:3,MOUSE_MOVE:4,WINDOW_MOUSEOUT_MOUSEENTER:5,INPUT_SERIALIZE:6,FOCUS_BLUR:7,KEY_PRESS:8,CARET_INFO:9,VALUE_CHANGED:10,DOM_MUTATION_NODE_MODIFIED:11,DOM_MUTATION_NODE_ATTR_MODIFIED:12,JAVASCRIPT_ERROR:13,MOUSE_CLICK:14,MOUSE_DOWN:15,MOUSE_UP:16,PAGE_MARKER:17,DOC_SIZE:18,SCROLL_EL:19,NOT_RECORDED:20,CSS_SERIALIZE:21,ORIENTATION:22,ZOOM:23,TOUCH:24,INCOMPLETE_INPUT_CAPTURE:25,ORIENTATION_CHANGE:26,CUSTOM_BEHAVIOR:27,CUSTOM_ERROR:28,HEARTBEAT:29};var Y={increment:function(t,e){try{var i=t.get("meta")||{};i[e]=(i[e]||0)+1,t.set("meta",i)}catch(t){}},set:function(t,e,i){try{var r=t.get("meta")||{};r[e]=i,t.set("meta",r)}catch(t){}}},z={nodeBelongsTo:function(t,e){if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));for(;t.parentNode;){if(t==e||t==e.body)return!0;t=t.parentNode}return!1},getEncoding:function(){return v._browser.isIE?window.document.charset:window.document.characterSet},getParentWindow:function(t){var e=t;if(t){if(t._pw)return t._pw;if(t.ownerDocument&&t.ownerDocument.defaultView)return t.ownerDocument.defaultView;for(;t.parentNode||t.document;){if(t.document)return e._pw=t;t=t.parentNode}}},getStyle:function(t,e,i){if(!e)return"";var r="",s=e.document.defaultView;return s&&s.getComputedStyle&&s.getComputedStyle(t,"")?r=s.getComputedStyle(t,"").getPropertyValue(i):t.currentStyle&&(i=i.replace(/\-(\w)/g,function(t,e){return e.toUpperCase()}),r=t.currentStyle[i]),r},getPosition:function(t,e){for(var i=0,r=0,s=z.getStyle;t;)i+=t.offsetTop+(parseFloat(s(t,e,"borderTopWidth"))||0),r+=t.offsetLeft+(parseFloat(s(t,e,"borderLeftWidth"))||0),t=t.offsetParent;return{x:r,y:i}},getPositionRelativeToMainView:function(t,e,i){for(var r,s=!1;!s&&e;){s=e.parent==e;var n=z.getPosition(t,e),o=utils.getScroll(e);i&&!s&&(n.x-=o.x,n.y-=o.y),r?(r.x+=n.x,r.y+=n.y):r=n,t=e.frameElement,e=e.parent}return r},getDocSize:function(t){var e=t||window.document,i=e.body,r=e.documentElement,s=Math.max;return{width:s(s(i.scrollWidth,r.scrollWidth),s(i.offsetWidth,r.offsetWidth),s(i.clientWidth,r.clientWidth)),height:s(s(i.scrollHeight,r.scrollHeight),s(i.offsetHeight,r.offsetHeight),s(i.clientHeight,r.clientHeight))}},externalizeStyleCSSTextToInnerHTML:function(t){var e,i,r=!1;if(fs.isDefined(u.useCSSText)||((e=document.createElement("style")).setAttribute("type","text/css"),u.useCSSText=fs.isDefined(e.styleSheet)),u.useCSSText)for(var s=0,n=(e="STYLE"==t.nodeName?[t]:t.querySelectorAll("style")).length;s<n;s++)(i=e[s]).styleSheet&&i.styleSheet.cssText&&i.styleSheet.cssText.replace(/\s/gi,"").length!=i.innerHTML.replace(/\s/gi,"").length&&(i.innerHTML=i.styleSheet.cssText,r=!0);return r}},X=function(t,e,i,r,s,n,o,a,c,h,d){W._browser=v._browser=this.browser=e,d&&this.setXFrameScrollPosition(d),this.isIframeMode=!!o,this.iFramexPathPrefix=h||"",this.ifrid=a,this.iFrameParentFr=c,this.config=n,this.stg=t,this.win=i,this.ready=new utils.FSEvent,this.childRecorders=[],this.disposed=!1,this.DomUpdated=new utils.FSEvent,this.DomUpdated.subscribe(function(){this.update.apply(this,arguments)}.bind(this)),this.EmergencySendRequired=new utils.FSEvent,this.instancePath=r||[],this.isMousedOverWindow=!1,this.logger=this.eventcap=this.recordParent=null,this.win.document&&((this.recordParent=s)||(this.logger=new H(t,e,this,this.config)),this.getLogger().StorageReady.subscribe(function(){this.ready.fire(),n.advancedSettings&&(this.masker=new A,this.masker.maskDocument(n.advancedSettings.pii,this.win)),this.serializeDom(),this.eventcap=new v(this,e,this.config,this.isIframeMode),w.performFrameBindings(this),o||y.BeginTrackingChildFrames(this),s||this.logger._flushAndTransmit(!0),e.isMobile&&this.setTransmitOK()}.bind(this),!0,!0)),r=i=s=null};X.prototype.update=function(t){t||(t=this.doc.body),0!==t.childNodes.length&&(this.eventcap.updateNodeBinding(t,!!t),w.performFrameBindings(this,t))},X.prototype.getLogger=function(){return this.recordParent?this.recordParent.getLogger():this.logger||{log:function(){}}},X.prototype.logCustomEvent=function(t,e,i){fs.isDefined(t)&&"string"==typeof t||(t=""),this.getLogger().log(this,i,{attrName:t,v:JSON.stringify(e)})},X.prototype.getPath=function(){return this._getPathCache||(this.recordParent?this._getPathCache=this.instancePath.concat(this.recordParent.getPath()):this._getPathCache=this.instancePath),this._getPathCache},X.prototype.getTop=function(){return this.recordParent?this.recordParent.getTop():this},X.prototype.setTransmitOK=function(){this.getLogger().setTransmitOK()},X.prototype.processImmediately=function(t){this.getLogger().processImmediately(t)},X.prototype.setTransmitNotOK=function(){this.getLogger().setTransmitNotOK()},X.prototype.cancelRecord=function(t){this.getLogger().cancelRecord(t)},X.prototype.dispose=function(){W.reset();var t=this;if(t.win||(t=t.recorder),!this.disposed){this.disposed=!0;for(var e=0;e<t.childRecorders.length;e++)t.childRecorders[e].dispose();t.eventcap&&t.eventcap.dispose(),t.lastRawMouseCoords&&(t.lastRawMouseCoords=null),t.eventcap=null,t.win=null,t.recordParent=null,t.DomUpdated.unsubscribeAll(),t.DomUpdated=null,t.logger&&(t.logger.dispose(),t.logger=null),t=null,utils.Unbind("record:*")}},X.prototype.clearState=function(){this.logger&&this.logger.clearState()},X.prototype.serializeDom=function(){if(this.getLogger()){var t;if(this.win==this.win.top){var e=this.win.document.body;t=W.getCacheableObject(e.innerHTML,x.getMapping(e)).uid}this.getLogger().log(this,H.EVENT_TYPES.DOM_SERIALIZE,{dom:S(this.win,this.getPath(),this.config),url:this.win.location.href.toString(),v:this.browser.agent,buid:t,start:fs.startTS,tz:(new Date).getTimezoneOffset(),domloadtime:utils.now()-fs.startTS})}},X.prototype.getGlobalId=function(){return this.getLogger().gsessionid},X.prototype.setXFrameScrollPosition=function(t){this.ifrFrameOffset=t};var j=new utils.FSEvent;fs.API.expose("beginTransmitting",function(){j.subscribe(function(){h.controller.beginTransmitting()},!0,!0)}),fs.API.expose("cancelRecord",function(){j.subscribe(function(){h.controller.cancelRecord()},!0,!0)}),fs.API.expose("getSession",function(e){e=e||function(){},j.subscribe(function(){var t=h.controller.recorder.logger;e({sessionid:t.sessionid,gsessionid:t.gsessionid,sig:t.gsessionid+"/"+t.sessionid})},!0,!0)});var q=function(t,e){this.config=t,this.browser=e};q.prototype.supported=function(){var t,n,o,e=this.config.advancedSettings||{},i=this.browser,r=this.config.blacklist,s=this.config.whitelist,a=!1,c=e.device_type_support,h=location.toString(),d=function(t,e){var i=e[t];switch(t){case"urls":case"text":for(n=0;n<i.length;n++)if(utils.testAgainstSearch(i[n],h))return!0;break;case"variables":for(n=0;n<i.length;n++)if(fs.isDefined(i[n].name)){if(o=utils.retrieveNestedVariable(l,i[n].name),i[n].value===o)return!0;if(!0===o&&"true"==i[n].value)return!0;if(!1===o&&"false"==i[n].value)return!0}break;case"cookies":var r,s=new utils.Cookie;for(n=0;n<i.length;n++)if(r=s.get(i[n].name),fs.isDefined(r)&&r==i[n].value)return!0}return!1};if(!(e.browser_cutoff[i.browser.name]&&i.browser.actualVersion>=e.browser_cutoff[i.browser.name]||e.platform_cutoff[i.os.name]&&i.os.version>=e.platform_cutoff[i.os.name]))return!1;if(c&&(!c.desktop&&!i.isMobile||!c.tablet&&i.isTablet||!c.phone&&i.isMobile&&!i.isTablet))return!1;if(r&&r.active)for(t in r)if(d(t,r))return!1;if(s&&s.active){for(t in s)if(d(t,s)){a=!0;break}if(!a)return!1}for(t=0;t<e.device_blacklist.length;t++)if(-1<fs.toLowerCase(i.agent).indexOf(e.device_blacklist[t].toLowerCase()))return!1;return!0};var K=null;function G(t,e,i,r,s){this.jrny=h.jrny=new utils.Journey(fs.config.customerId||utils.getRootDomain()||"record_customerId",utils.APPID.REPLAY,i,t),this.jrny.addEventsDefault("properties",{fs_pageViews:[i.get("pv")]}),this.initialize.apply(this,arguments)}return G.prototype.isIframe=function(){return window!=window.top},G.prototype.isCrossDomainFrame=function(){if(this.isIframe())try{return window.top.document.body.toString().length.length<0}catch(t){return!0}return!1},G.prototype.initialize=function(r,s,n,t,o){if("undefined"!=typeof Uint8Array){var e=this.isIframe(),a=this.isCrossDomainFrame();if(!e||a){if(t&&fs.ext(u.advancedSettings||{},t),this.winobj=s,this.browser=r,u&&u.instances)for(var i=0;i<u.instances.length;i++){var c=u.instances[i];if(!c.disabled){fs.ext(u,c);break}}this.crit=new q(u,r),(this.stg=n).ready.subscribe(function(){r.ready.subscribe(function(){if(this.crit.supported()){var i=this.stg.get(["rt","i","pv"]);a?utils.Bind(window,"message",function(t){if(t.data=t.data+"",t.data&&fs.isFunction(t.data.indexOf)&&3<t.data.length&&-1<t.data.indexOf("{")){var e;try{e=JSON.parse(t.data)}catch(t){return}e.src&&"fsframe"==e.src||(e.cxr&&e.id?(this.recorder=new X(n,r,s,e.xp,null,u,a,e.id,t.source,e.sid,e.sp),this.recorder.ready.subscribe(function(){o.set("replay_id",this.recorder.logger.gsessionid),o.set("sessionid",this.recorder.logger.sessionid)}.bind(this),!0,!0),i.rt||"x"!==i.i||this.beginTransmitting(),utils.Bind(window,"unload",function(){if(this.recorder){var t=this.recorder.ifrid;window.top.postMessage({unloadiFrame:!0,frameId:t},"*"),this.recorder.dispose(),this.recorder=null}}.bind(this))):e.cxsp&&this.recorder&&this.recorder.setXFrameScrollPosition(e.sp))}}.bind(this)):(this.recorder=new X(n,r,s,null,null,u,a),this.recorder.ready.subscribe(function(){o.set("replay_id",this.recorder.logger.gsessionid),o.set("sessionid",this.recorder.logger.sessionid)}.bind(this),!0,!0),this.jrny&&1===i.pv&&this.jrny.addEventString(d),i.rt||"x"!==i.i||this.beginTransmitting(),utils.Bind(window,"unload",function(){this.recorder&&(this.recorder.dispose(),this.recorder=null)}.bind(this)),e||(t=this,h.controller=t,j.fire()))}var t}.bind(this),!0,!0)}.bind(this),!0,!0)}}else this.jrny&&this.jrny.addEventString(g)},G.prototype.beginTransmitting=function(){this.recorder&&this.recorder.setTransmitOK()},G.prototype.dispose=function(){this.recorder&&(this.transmitIfCan(),this.recorder.dispose(),this.recorder=null,K=null)},G.prototype.transmitIfCan=function(){var t=this.recorder;if(t){var e=t.getLogger();e&&e.transmitting&&e._flushAndTransmit()}},G.prototype.cancelRecord=function(){this.recorder&&(this.recorder.dispose(),this.recorder=null),this.jrny&&this.jrny.addEventString(e)},G.prototype.getGlobalId=function(){return this.recorder&&this.recorder.getGlobalId()},G.getInstance=function(t,e,i,r,s){return null===K&&(K=new G(t,e,i,r,s)),K},G.disposeInstance=function(){K&&(K.dispose(),K=null)},G});