/***************************************
* @preserve
* ForeSee Web SDK: record
* Built February 21, 17 17:43:58
* Code version: 19.3.2-rc.8
* Template version: 19.3.2-rc.7
***************************************/
_fsDefine(["require","fs",_fsNormalizeUrl("$fs.utils.js"),"recordconfig"],function(t,e,i,r){function s(){this.initialize.apply(this,arguments)}var n={},o={_trackers:[]};o.Tracker=function(t,e,r,s,n,a){this.recorder=t,this.throttleTime=s,this.recFunction=n,this.subject=e,a||this._capture({},e),i.Bind(e,r,function(t,e){return function(i){t._capture&&t._capture(i,e),i=null,e=null}}(this,e)),o._trackers.push(this),e=null,t=null,r=null,n=null},o.Tracker.prototype.merge=function(t,e,r,s){i.Bind(e,r,function(t,e,i){return function(r){t._capture&&t._capture(r,e,i)}}(this,e,t)),t=null,r=null,s=null},o.Tracker.prototype._capture=function(t,r,s){clearTimeout(this.lastCapThrottle);var n=s||this.recorder;if(!this.lastCap||i.now()-this.lastCap>this.throttleTime)this.recFunction.call(this,t,r,n),this.lastCap=i.now();else{var o={};for(var a in t)6==a.length&&"layerX"!=a&&"layerY"!=a&&(o[a]=t[a]);this.lastCapThrottle=setTimeout(function(t,i,r,s){return e.isDefined(i.clientX)&&(i.sX=i.clientX,i.sY=i.clientY),function(){i.delayed=!0,t._capture&&t._capture(i,r,s)}}(this,o,r,n),this.throttleTime)}n=null,s=null,t=null,r=null},o.Tracker.prototype.dispose=function(){this.lastCapThrottle&&clearTimeout(this.lastCapThrottle),e.dispose(this)};var a=o.Tracker,c={SESSIONID:"rpid",GLOBALSESSIONID:"mid",TRANSMITTING:"rt",CANCELED:"cncl",CANCELEDPERMANENT:"rcp",SESSION:"SESSION",DATA:"DATA",GLOBALREFRESHTIME:"grft"},h={_frames:[]};h.TrackFrame=function(t,e,r){var s=h._getFrameByXPath(t);s||h._frames.push({xp:t,nd:e,rc:r,sid:h._frames.length+"_",id:i.generateGUID(),initialized:!1})},h._getFrameByXPath=function(t){for(var e=t.join("/"),i=0;i<h._frames.length;i++)if(h._frames[i].xp.join("/")==e)return h._frames[i]},h._getFrameById=function(t){for(var e=0;e<h._frames.length;e++)if(h._frames[e].id==t)return h._frames[e]},h.BeginTrackingChildFrames=function(t){setInterval(function(){for(var e=0;e<h._frames.length;e++){var i=h._frames[e];!i.initialized&&i.nd.contentWindow&&i.nd.contentWindow.postMessage(JSON.stringify({cxr:!0,id:i.id,xp:i.xp,sid:i.sid,sp:U.getPosition(i.nd,t.win)}),"*")}},400),i.Bind(window,"message",function(i){if(i.data.timetounload)for(var r=0;r<h._frames.length;r++)h._frames[r].id===i.data.frameId&&(h._frames[r].initialized=!1);if(i.data=i.data+"",i.data&&e.isFunction(i.data.indexOf)&&i.data.indexOf("_cxrXDS_")>-1){var s;try{s=JSON.parse(i.data)}catch(t){return}if(s){var n=h._getFrameById(s.id);if(n){var o=t.getLogger();n.initialized=!0,o._data&&o._data.length>0?o._data=o._data+","+s.data:o._data=s.data}}}});new a(t,t.win,"record:scroll",500,function(e,r,s){for(var n=(i.getScroll(t.win),0);n<h._frames.length;n++){var o=h._frames[n];o.initialized&&o.nd.contentWindow&&o.nd.contentWindow.postMessage(JSON.stringify({cxsp:!0,sp:U.getPosition(o.nd,t.win)}),"*")}})},h.SendDataToParentFrame=function(t,e,i){t.postMessage(JSON.stringify({_cxrXDS_:!0,id:e,data:i}),"*")};var l=function(t,r,config,s){this.config=config,this.browser=r,this.isXDRIFrameMode=s,this.isTop=t.getTop()==t,this.recorder=t,this.mutation=new E(t),this._setupMouseTracking(),this.sizeCapture=new a(this.recorder,this.recorder.win,"resize",700,function(t,e,s){var n=i.getSize(s.win),o=0,a=s.getLogger(),c=U.getDocSize(s.doc),h={w:c.width,h:c.height};if(s.docSize=c,r.isMobile){var l=n;n=h,h=l,o=window.orientation}a.log(s,P.EVENT_TYPES.FRAME_SIZE,{sz:n,avs:h,st:o,m:r.isMobile},null,-350),a.log(s,P.EVENT_TYPES.DOC_SIZE,{sz:{w:c.width,h:c.height}},null,-340)});var n=this.recorder.win.onerror;this.recorder.win.onerror=e.proxy(function(t,e,i){this.getLogger().log(this,P.EVENT_TYPES.JAVASCRIPT_ERROR,{v:t+", "+e+", "+i}),n&&n.apply(this.win,arguments)},this.recorder),this.inputCaptures=[],this.updateNodeBinding(this.recorder.win.document.body,!1,!0),this.inputReserialize=function(t,i,r){return function(){setTimeout(function(){try{t.recorder.win.document}catch(t){return}for(var i=0;i<r.length;i++){var s=r[i];r[i].hasChanged()&&e.isDefined(s.input)&&"SELECT"!=s.input.nodeName&&(s.lastValue=s.input.value,s.serialize())}},20),t.isTop||t.recorder.getTop().eventcap.inputReserialize.apply()}}(this,this.recorder,this.inputCaptures),i.Bind(this.recorder.win.document,"record:click",this.inputReserialize),i.Bind(this.recorder.win.document,"record:touchstart",this.inputReserialize),this.config.advancedSettings&&this.config.advancedSettings.scrollEls&&(this._setupScrollTracking(),t.DomUpdated.subscribe(e.proxy(function(t){this._setupScrollTracking(t)},this))),t=null};l.prototype._setupScrollTracking=function(t){t||(t=document);var i=this.config.advancedSettings.scrollEls;if(e.isString(i))for(var r=t.querySelectorAll(i),s=function(t){return function(e,i){i||(i=e.target||e.srcElement),i&&t.getLogger().log(t,P.EVENT_TYPES.SCROLL_EL,{x:t.getLogger().logXPath(t,M.getMapping(i)),ps:{x:i.scrollLeft,y:i.scrollTop}})}},n=0;n<r.length;n++)r[n]._fsrScrollCapture||(r[n]._fsrScrollCapture=new a(this.recorder,r[n],"scroll",400,s(this.recorder)))},l.prototype._setupMouseTracking=function(){var t=this,r=function(r,s,n,o){var a=P.EVENT_TYPES,c=n.getLogger();if(r.delayed||n.getTop().isMousedOverWindow||(c.log(n,a.WINDOW_MOUSEOUT_MOUSEENTER,{st:1}),n.getTop().isMousedOverWindow=!0),n.getTop().isMousedOverWindow){o=o||a.MOUSE_MOVE;var h={x:"unknown"!=typeof r.clientX?r.clientX:"unknown"!=typeof r.screenX?r.screenX:r.sX,y:"unknown"!=typeof r.clientY?r.clientY:"unknown"!=typeof r.screenY?r.screenY:r.sY},l=-1;if(o==a.MOUSE_CLICK||o==a.MOUSE_DOWN){var d=r.explicitOriginalTarget||r.originalTarget||r.target||r.srcElement;d&&(l=c.logXPath(n,M.getMapping(d)))}var u=i.getScroll(n.win);if("undefined"==typeof h.x&&(h=n.lastRawMouseCoords),e.isDefined(h)){n.lastRawMouseCoords=h;var g={x:u.x+h.x,y:u.y+h.y};if(n.win!==n.win.top)if(t.isXDRIFrameMode)g.x+=n.ifrFrameOffset.x-u.x,g.y+=n.ifrFrameOffset.y-u.y;else{var p=n.win.frameElement,f=U.getPositionRelativeToMainView(p,U.getParentWindow(p),!1);f&&(g.x+=f.x-u.x,g.y+=f.y-u.y)}c.log(n,o,{ps:g,x:l})}}},s=250;if(this.browser.isMobile){if(r=null,s=100,this.isTop){this.lastOrientation={alpha:0,beta:0,gamma:0},i.Bind(window,"record:deviceorientation",e.proxy(function(t){if(e.isDefined(t.alpha)){var i=Math.round(t.alpha),r=Math.round(t.beta),s=Math.round(t.gamma),n=10,o=this.recorder;(Math.abs(i-this.lastOrientation.alpha)>n||Math.abs(r-this.lastOrientation.beta)>n||Math.abs(s-this.lastOrientation.gamma)>n)&&(this.lastOrientation.alpha=i,this.lastOrientation.beta=r,this.lastOrientation.gamma=s,o.getLogger().log(o,P.EVENT_TYPES.ORIENTATION,{ot:{a:i,b:r,g:s}}))}},this)),this.doOrientationChange=e.proxy(function(t){var e=this.recorder.win.document.documentElement,r=U.getDocSize(this.recorder.doc),s=0;Math.abs(window.orientation)>0&&(s=1),this.recorder.getLogger().log(this.recorder,P.EVENT_TYPES.ORIENTATION_CHANGE,{ps:i.getScroll(this.recorder.win),oc:{isL:s,ww:e.clientWidth,wh:e.clientHeight,dw:r.width,dh:r.height,wiw:window.innerWidth,wih:window.innerHeight}})},this),i.Bind(window,"record:orientationchange",this.doOrientationChange),this.doOrientationChange();for(var n=function(t,i,r){var s=[];if(e.isDefined(t.touches))for(var n=0;n<t.touches.length;n++){var o=t.touches[n];s.push({x:o.pageX,y:o.pageY})}r.getLogger().log(r,P.EVENT_TYPES.TOUCH,{ts:s})},o=["start","end","cancel","leave","move"],c=function(t){return function(e){n(e,"",t)}},h=0;h<o.length;h++)i.Bind(window,"record:touch"+o[h],c(this.recorder));i.Bind(window,"record:touchstart",e.proxy(function(){this.EmergencySendRequired.fire()},this.recorder))}}else{var l=this.browser.isIE?this.recorder.win.document:this.recorder.win;this.isTop?this.mouseMoveCapture=new a(this.recorder,l,"record:mousemove",200,r,!0):this.mouseMoveCapture=this.recorder.getTop().eventcap.mouseMoveCapture.merge(this.recorder,l,"record:mousemove",r,!0),i.Bind(this.recorder.win.document,"record:mousedown",e.proxy(function(t){this.mHandler.call(this.ctx,t,null,this.rec,P.EVENT_TYPES.MOUSE_CLICK)},{ctx:this,rec:this.recorder,mHandler:r}))}if(this.scrollCapture=new a(this.recorder,this.recorder.win,"record:scroll",s,function(t){return function(e,s,n){var o=!0;if(n.win==n.win.top)if(D._browser.isMobile){var a=U.getDocSize(n.doc),c={cw:window.innerWidth,ch:window.innerHeight,w:a.width,h:a.height},h={z:c,ps:i.getScroll(n.win)};o=!1,n.getLogger().log(n,P.EVENT_TYPES.ZOOM,h)}else r&&t.call(this,e,s,n);o&&n.getLogger().log(n,P.EVENT_TYPES.FRAME_SCROLL,{ps:i.getScroll(n.win)})}}(r)),this.isTop){this.browser.isMobile||(this.recorder.isMousedOverWindow=!0,i.Bind(this.recorder.win.document,"record:mouseover",function(t,e){return function(t){!e||e.isMousedOverWindow||t.relatedTarget||t.fromElement||(e.getLogger().log(e,P.EVENT_TYPES.WINDOW_MOUSEOUT_MOUSEENTER,{st:1}),e.isMousedOverWindow=!0)}}(this,this.recorder)),i.Bind(this.recorder.win.document,"record:mouseout",e.proxy(function(t){t=t?t:this.recorder.win.event;var e,i=this.recorder,r=t.relatedTarget||t.toElement;try{r&&(e=r.nodeName)}catch(t){}i&&i.isMousedOverWindow&&(!r||e&&"HTML"==e)&&(i.getLogger().log(i,P.EVENT_TYPES.WINDOW_MOUSEOUT_MOUSEENTER,{st:0}),i.isMousedOverWindow=!1,i.EmergencySendRequired.fire())},this)));var d=function(t){return function(){var e=U.getDocSize(t.doc);t.docSize&&t.docSize.width==e.width&&t.docSize.height==e.height||(t.docSize=e,t.getLogger().log(t,P.EVENT_TYPES.DOC_SIZE,{sz:{w:e.width,h:e.height}}))}}(this.recorder);d.apply(this,[]),this.recorder.DomUpdated.subscribe(d),d=null}r=null},l.MAX_UPDATE_NODE_BINDING_EXECUTION_TIME=500,l.prototype.updateNodeBinding=function(t,r,s){for(var n=+new Date,o=t.querySelectorAll("input, select, textarea"),a=this.inputCaptures,c=function(t){return function(){setTimeout(e.proxy(function(){for(var t=0;t<this.length;t++)this[t].serialize()},t),1)}},h=o.length-1;h>=0;h--){if(i.now()-n>l.MAX_UPDATE_NODE_BINDING_EXECUTION_TIME){this.recorder.logger.log(this.recorder,P.EVENT_TYPES.INCOMPLETE_INPUT_CAPTURE,{});break}var d=o[h];if(d._fsrTracker)for(var u=a.length-1;u>=0;u--){var g=a[u];if(g.input==d&&g.hasChanged()){g.serialize();break}}else a[a.length]=new y(this.recorder,d),"reset"==d.getAttribute("type")&&i.Bind(d,"record:click",c(a));d=null}!s&&this.browser.isIE&&this.mutation.setNodeSpecificBindings(t,r),o=null,a=null,t=null},l.prototype.dispose=function(){this.mutation.dispose(),this.mutation=null,this.recorder=null,this.inputCaptures=null,this.inputReserialize=null;var t,e=o._trackers;for(t=0;t<e.length;t++)e[t].dispose(),e.splice(t--,1);var i=T;for(t=0;t<i.length;t++)i[t].dispose(),i.splice(t--,1)};var d=function(t,e,config){var i=d,r=t.document;return i.ProcessHTML(i._getDocType(r)+r.querySelectorAll("html")[0].outerHTML,r,e,!!config.advancedSettings.pii.useWhiteListing,config)},u=d;d.ProcessHTML=function(t,e,i,r,config){return D.getCacheableObject(d._scrubHTML(t,r,config),i)},d._scrubHTML=function(t,i,config){var r,s=d,n=config.advancedSettings||{};if(t=e.isArray(t)?t[0]:t||"",n.regexScrub)for(r=0;r<n.regexScrub.length;r++)t=t.replace(n.regexScrub[r],"");return t=s._removeInnerScriptContent(t),t=s._removeZeroWidthEntities(t),t=s._fixPreTags(t),t=s._fixViewState(t),t=s._stripOptionTags(t),t=s._convertSpecialChars(t,config),t=s._stripInputValues(t),t=i?s._whiteListBlock(t,i):s._maskFSRHiddenBlocks(t,i),i||e.isDefined(n.keepComments)&&n.keepComments===!0||(t=s._removeComments(t)),t};var g=function(t){return t[0].indexOf("fsrHiddenBlock")<0?"":t[0]};d._removeComments=function(t){return/<!--/gim.test(t)?u._superReplace(t,/(<!--)[\w\W]*?(-->)/gim,g):t},d._convertSpecialChars=function(t,config){if(config.advancedSettings){var i,r=config.advancedSettings.specialMappings;if(e.isDefined(r))for(i=0,len=r.length;i<len;i++)t=t.replace(r[i][0],r[i][1])}return t},d._removeInnerScriptContent=function(t){return/script/gim.test(t)?u._superReplace(t,/(<script[^>]*?>)[\s\S]*?(<\/[\w]*script>)/gim,function(t){return t[1]+t[2]}):t},d._maskFSRHiddenBlocks=function(t,e){return e?this._superReplace(t,new RegExp(".+","mig"),u._maskBlock):t.indexOf("fsrHiddenBlock")>=0?d._superReplace(t,new RegExp("<!--(\\W)*fsrHiddenBlockStart[\\w\\W]*?fsrHiddenBlockEnd(\\W)*-->","mig"),u._maskBlock):t},d._removeZeroWidthEntities=function(t){return t.replace(/(\u200B)|(\u200C)|(\u200D)|(\uFEFF)/g,"")},d._fixPreTags=function(t){return t.indexOf("/pre")>-1||t.indexOf("/PRE")>-1?u._superReplace(t,new RegExp("[\\s\\S]*?(?:\\/pre\\s*>)|[\\s\\S]+","mig"),u._removeFormat):t},d._fixViewState=function(t){return t.indexOf("VIEWSTATE")>-1?t.replace(/<input[^>]*name=["']?__VIEWSTATE[^>]*>/gim,'<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" />'):t};var p=function(t){var e=t[0].match(/<\/select[^>]*>/gim);return e?t[0]:""};d._stripOptionTags=function(t){return/select/gim.test(t)?u._superReplace(t,/(<option[^>]*>[\s\S]*?<\/[\w]*option>)/gim,p):t};var f=function(t,e,i){if(e)return e+i.replace(/[\w\d\s]/g,"*")+'"'};d._stripInputValues=function(t){return t.length>0&&/value/.test(t)?t.replace(/(<(?:\s)*?input(?:[^>]+)value=\")([^>\"]*)\"/gim,f):t},d._superReplace=function(t,i,r){for(var s,n=i.exec(t),o="",a=0;e.isDefined(n);)o+=t.substring(a,n.index),s=r(n),o+=s,a=n.index+n[0].length,n=i.exec(t);return o+=t.substring(a,t.length)};var m=function(t,e,i,r){return i||r||"*"};d._maskBlock=function(t){var e=t instanceof Array?t[0]:t||"";return e.length>0?e.replace(/(>)|(&[^\s;]*;)|(<[^<>]*?>)|(<)|\w/g,m).replace(/&((?!nbsp| |amp).)*?;/g,"*"):""},d._removeFormat=function(t){var e=0,i=t[0];return i&&(i="",e=d._regexIndexOf(t[0],new RegExp("<\\s*?pre","mig")),i+=t[0].substring(0,e).replace(/\t/g," ").replace(/\s+/g," "),i+=t[0].substring(e)),i},d._regexIndexOf=function(t,e,i){var r=t.substring(i||0).search(e);return r>=0?r+(i||0):r},d._regexLastIndexOf=function(t,e,i){for(var r=i,s=d.regexIndexOf(t,e,r);s>-1;)r=s,s=d.regexIndexOf(t,e,r+1);return r},d._getDocType=function(t){var i,r="",s=t.doctype,n=t.childNodes,o=0;if(l._browser.isIE&&("CSS1Compat"!=t.compatMode||5==t.documentMode))return r;if(s){try{if(i=(new XMLSerializer).serializeToString(s).toString(),i&&i.length>0)return i}catch(t){}r="<!DOCTYPE HTML",s.publicId&&(r=r+' PUBLIC "'+s.publicId+'"'),s.systemId&&(r=r+' SYSTEM "'+s.systemId+'"'),r+=">"}else if(n[o].text){for(;n[o].text&&(0===n[o].text.indexOf("<!--")||0===n[o].text.indexOf("<?xml"));)o++;e.isDefined(n[o].text)&&0===n[o].text.toLowerCase().indexOf("<!doctype")&&(r=n[o].text)}return r},d._whiteListBlock=function(t,e){var i=t.indexOf("<!--fsrWhiteListStart"),r="";return e?i>=0?r+=d._maskBlock(t.substring(0,i))+d._superReplace(t.substring(i),new RegExp("<!--(\\W)*fsrWhiteListEnd(\\W)*-->([\\W\\D\\S](?!!--(\\W)*fsrWhiteListStart(\\W)*-->))*","mig"),d._maskBlock):this._superReplace(t,new RegExp(".+","mig"),d._maskBlock):t};var _={iFrameXpaths:{}};_.performFrameBindings=function(t,s){if(!r.advancedSettings.skipIframes){var n,o,a,c,l,d,u=(s||t.win.document).querySelectorAll("iframe"),g=function(t){return function(){t.dispose()}},p=function(t){return function(e){_.bindToFrameLoad(e,t)}};for(n=0;n<u.length;n++){if(o=u[n],a=o._fsrB||o.getAttribute("_fsrB"),!a&&!_.iFrameXpaths[M.getMapping(o)]){var f=this.testFrameOrigin(o),m=this.testFrameSrc(o);if(m&&f){if(_.iFrameXpaths[M.getMapping(o)]=!0,o.setAttribute("_fsrB",!0),c=this.getFrameWindow(o),!c)return;if(l=this.getFrameDocument(c,!1),d=!1,l){this.unbindInternalIframes(l);try{"complete, loaded".indexOf(l.readyState)>-1&&(d=!0)}catch(t){}d&&(e.isDefined(c.recorder)?c.recorder.serializeDom():(c.recorder=new W(t.stg,t.browser,c,M.getMapping(o),t,t.config),t.childRecorders.push(c.recorder),i.Bind(c,"unload",g(c.recorder))))}l=null,c=null}else m&&!f&&(_.iFrameXpaths[M.getMapping(o)]=!0,o.setAttribute("_fsrB",!0),h.TrackFrame(M.getMapping(o),o,t));i.BindOnce(o,"record:load",p(t))}o=null}u=null,t=null}},_.bindToFrameLoad=function(t,r){var s,n=t.originalTarget||t.target||t.srcElement;n&&this.testFrameSrc(n)&&_.testFrameOrigin(n)&&(s=_.getFrameWindow(n),_.getFrameDocument(s)&&(e.isDefined(s.recorder)||(s.recorder=new W(r.stg,r.browser,s,M.getMapping(n),r,r.config,r.isIframeMode),r.childRecorders.push(s.recorder),s.recorder.ready.subscribe(e.proxy(function(){i.Bind(s,"unload",this.dispose)},s.recorder),!0,!0))),s=null),n=null,r=null,t=null},_.testFrameSrc=function(t){var e,i=["javascript:","shim.gif","about:blank"];for(e=0;e<i.length;e++)if(t.src.indexOf(i[e])>-1)return!1;return!0},_.testFrameOrigin=function(t,e){var r=t.getAttribute("src");if(!r||0===r.indexOf(" "))return!1;var s=t.src;return i.testSameDomain(e||window.location.href,s)},_.unbindInternalIframes=function(t){var e,i=t.querySelectorAll("iframe[_fsrB='true']");for(e=0;e<i.length;e++)i[e]._fsrB=!1},_.getFrameWindow=function(t){var e;return t&&t.contentWindow?e=t.contentWindow:t&&t.contentDocument&&t.contentDocument.defaultView&&(e=t.contentDocument.defaultView),e&&e!=e.top?e:null},_.getFrameDocument=function(t){var e;try{return e=t.document}catch(t){return!1}};var T=[],y=function(t,r){if(!r._fsrTracker){r._fsrTracker=this,T.push(this),this.input=r,this.recorder=t;var s="";if(s=r.getAttribute("type")?r.getAttribute("type").toLowerCase():"text",this._isTextInput()&&(this.lastValue=r.getAttribute("value")||""),((!this._isTextInput()||r.value)&&("checkbox"!=s||r.checked)||r.type&&"select-one"==r.type)&&this.serialize(!0),i.Bind(r,"record:scroll",e.proxy(function(){this.input&&this.recorder.getLogger().log(this.recorder,P.EVENT_TYPES.SCROLL_EL,{t:s,x:this.recorder.getLogger().logXPath(this.recorder,M.getMapping(this.input)),ps:{x:this.input.scrollLeft,y:this.input.scrollTop}})},this)),i.Bind(r,"record:focus",e.proxy(function(){this.input&&(this._isTextInput()&&(this._updateCaret(),this._caretMonitor=setInterval(e.proxy(function(){this.input&&this._updateCaret()},this),350)),this.recorder.getLogger().log(this.recorder,P.EVENT_TYPES.FOCUS_BLUR,{t:s,st:1,x:this.recorder.getLogger().logXPath(this.recorder,M.getMapping(this.input))}))},this)),i.Bind(r,"record:blur",e.proxy(function(t){this.input&&(this._isTextInput()&&clearInterval(this._caretMonitor),this.recorder.getLogger().log(this.recorder,P.EVENT_TYPES.FOCUS_BLUR,{t:s,st:0,x:this.recorder.getLogger().logXPath(this.recorder,M.getMapping(this.input))}))},this)),"checkbox"==s||"radio"==s){var n=e.proxy(function(){this.input&&this._lastCheckedState!=this.input.checked&&(this._lastCheckedState=this.input.checked,this.recorder.getLogger().log(this.recorder,P.EVENT_TYPES.VALUE_CHANGED,{t:s,b:this.input.checked,x:this.recorder.getLogger().logXPath(this.recorder,M.getMapping(this.input))}))},this);i.Bind(r,"record:click",n),i.Bind(t.win,"record:click",n)}"checkbox"!=s&&"radio"!=s&&i.Bind(r,"record:change",e.proxy(function(){if(this.input){this._lastSelectListContents!=this.input.innerHTML&&this.serialize(),this.lastValue=this.input.value;var t=this.input.selectedOptions,e="";t&&t.length>0&&!this._isSecret()&&(e=t[0].innerText),this.recorder.getLogger().log(this.recorder,P.EVENT_TYPES.VALUE_CHANGED,{t:s,si:this.input.selectedIndex,x:this.recorder.getLogger().logXPath(this.recorder,M.getMapping(this.input)),v:e})}},this)),this._isTextInput()&&(this.lastValue=this.input.value,i.Bind(r,"record:keydown",function(t){return function(e){t.input&&(l._browser.isIE&&(e={keyCode:e.keyCode,charCode:e.charCode}),setTimeout(function(t,e){return function(){t._updateCaret();var i=0;if("number"==typeof e.keyCode?i=e.keyCode:"number"==typeof e.which?i=e.which:"number"==typeof e.charCode&&(i=e.charCode),Math.abs(t.lastValue.length-t.input.value.length)>1||t.lastCaretInfo.e-t.lastCaretInfo.s>1)t.serialize();else{0===i&&32==e.charCode&&(i=e.charCode);var r=t.recorder.getLogger().logXPath(t.recorder,M.getMapping(t.input));i<=46||i>=91&&i<96||i>=112&&i<=145?t.recorder.getLogger().log(t.recorder,P.EVENT_TYPES.KEY_PRESS,{t:s,xp:r,sk:i,ps:{x:t.input.scrollTop,y:t.input.scrollLeft}}):t.recorder.getLogger().log(t.recorder,P.EVENT_TYPES.KEY_PRESS,{t:s,xp:r,v:t._filterTextIfApplicable(t.input.value.substr(t.lastCaretInfo.c-1,1)),ps:{x:t.input.scrollTop,y:t.input.scrollLeft}})}t.lastValue=t.input.value}}(t,e),1))}}(this))),t=null,r=null}};y.prototype.hasChanged=function(){return this._lastCheckedState!=this.input.checked||this.lastValue!=this.input.value},y.prototype._filterTextIfApplicable=function(t){return t&&this._isSecret()?t.replace(/[^ \n\r\t]/g,"*"):t},y.prototype._isSecret=function(){var t=this.input.getAttribute("class")||this.input.getAttribute("className");return!(t&&t.indexOf("fsrVisible")>-1||"reset,submit,button".indexOf(this.input.getAttribute("type"))>-1)},y.prototype._isTextInput=function(){var t="text",e=this.input.tagName.toLowerCase(),r=["text","password","textarea","number","email","url","search","color","tel",""];return this.input.getAttribute("type")&&(t=this.input.getAttribute("type").toLowerCase()),("textarea"==e||i.inArray(t,r))&&"select"!==e},y.prototype.serialize=function(t){var e=this.input.tagName.toLowerCase(),i=this.input.getAttribute("type");if(i||(i=this.input.tagName.toLowerCase(),"input"==i&&(i="text")),"hidden"!=i){if(t){if(!("radio"!=i&&"checkbox"!=i||this.input.checked))return void(this._lastCheckedState=!1);if(("text"==i||"password"==i||"textarea"==e)&&""===this.input.value)return}var r=this.recorder.getLogger(),s=P.EVENT_TYPES.INPUT_SERIALIZE,n=r.logXPath(this.recorder,M.getMapping(this.input));switch(i="select,textarea".indexOf(e)>-1?e:i){case"textarea":r.log(this.recorder,s,{t:i,x:n,v:this._filterTextIfApplicable(this.input.value)||"",wt:U.getStyle(this.input,this.recorder.win,"width"),ht:U.getStyle(this.input,this.recorder.win,"height")});break;case"radio":case"checkbox":!this.input.checked&&t||(r.log(this.recorder,s,{t:i,x:n,b:this.input.checked}),this._lastCheckedState=this.input.checked);break;case"select":for(var o=[],a=0;a<this.input.options.length;a++)o[o.length]={v:this._filterTextIfApplicable(this.input.options[a].value),t:this._filterTextIfApplicable(this.input.options[a].text)};!this.input.multiple&&this._isSecret()&&o.length>1&&(o.length=1),r.log(this.recorder,s,{t:i,x:n,sz:{w:this.input.offsetWidth,h:this.input.offsetHeight},o:o,si:this.input.options.selectedIndex}),this._lastSelectListContents=this.input.innerHTML;break;default:r.log(this.recorder,s,{t:i,x:n,v:this._filterTextIfApplicable(this.input.value)||""})}}},y.prototype._updateCaret=function(){var t=this._getCaretInfo(this.input);this.lastCaretInfo&&this.lastCaretInfo.s==t.s&&this.lastCaretInfo.e==t.e&&this.lastCaretInfo.c==t.c||setTimeout(function(t,e){return function(){t.recorder.getLogger().log(t.recorder,P.EVENT_TYPES.CARET_INFO,e)}}(this,{x:this.recorder.getLogger().logXPath(this.recorder,M.getMapping(this.input)),ci:t}),1),this.lastCaretInfo=t},y.prototype._getCaretInfo=function(){var t=this.input,e=t.value,i=t.ownerDocument,r={s:0,e:0,c:0};if(l._browser.isIE){if("textarea"==t.tagName.toLowerCase()&&i.selection){e.charCodeAt(e.length-1)<14&&(e=e.replace(/34/g,"")+String.fromCharCode(28));var s=i.selection.createRange(),n=s.duplicate();n.moveToElementText(t),n.setEndPoint("StartToEnd",s),r.e=e.length-n.text.length,n.setEndPoint("StartToStart",s),r.s=e.length-n.text.length,r.c=r.e,e.substr(e.length-1)==String.fromCharCode(28)&&(e=e.substr(0,e.length-1));var o=e.substr(0,r.s).split("\n").length-1,a=e.substr(0,r.c).split("\n").length-1,c=e.substr(0,r.e).split("\n").length-1;r.c-=a,r.s-=o,r.e-=c}else if(i.selection){var h=i.selection.createRange(),d=h.duplicate();r.s=0-d.moveStart("character",-1e5),r.e=r.s+h.text.length,r.c=r.e}}else try{r.s=t.selectionStart,r.e=t.selectionEnd,r.c=r.e}catch(t){}return!r.s&&r.s<0&&(r={s:0,e:0,c:0}),r},y.prototype.dispose=function(){this.input._fsrTracker=null,this.recorder=null,this.lastValue=null,this.input=null,this.lastCaretInfo=null,this._lastSelectListContents=null,clearTimeout(this._caretMonitor)};var S=function(t){this._elementCache={},this._callbackTimer=null,this.recorder=t,this.cacheIndex=0,t=null};S.prototype.dispose=function(){e.dispose(this._elementCache),this._elementCache=null,this.recorder=null,clearTimeout(this._callbackTimer)},S.prototype.push=function(t,r,s,n){var o={t:t,c:r,i:s,p:n,d:i.now()};n=n||"",t&&1!=t.nodeType&&(t=t.parentNode),t&&this._elementCache&&(t._fsrKey||(t._fsrKey={id:"_"+this.cacheIndex++}),this._elementCache[t._fsrKey.id+n.toLowerCase()]=o,this._callbackTimer||(this._callbackTimer=setTimeout(e.proxy(function(){this.handleEvents()},this),1e3)),t=null,r=null)},S.prototype.handleEvents=function(){this._callbackTimer=null;try{this.recorder.win.document}catch(t){return}var t,r=this._elementCache,s=i.now();for(var n in r)t=r[n],t._fsrKey=null,"object"==typeof t&&t.t&&t.t.nodeName&&"svg"!=t.t.nodeName&&(t.c(s-t.d),e.dispose(t),t=null);e.dispose(this._elementCache),this._elementCache={},r=null},S.prototype.accelerate=function(){this.handleEvents()};var E=function(t){this.config=t.config,this.recorder=t,this.mutationSynonym=window.MutationObserver?"MutationObserver":!!window.WebKitMutationObserver&&"WebKitMutationObserver",this.domMethodCopies=[],this.domMethodRewrites=[],this.domUpdateThrottler=new S(this.recorder),this.supportsDomPrototypes=!l._browser.isIE||(e.isDefined(t.win.Element)||e.isDefined(t.win.HTMLElement))&&!r.useEleMutation,this.setupMutationObserver(this.recorder,this)||l._browser.isIE&&(this.saveDomMutationMethods(),this.supportsDomPrototypes&&this.overrideDomPrototype(),this.setNodeSpecificBindings(this.recorder.win.document),this.recorder.DomUpdated.subscribe(e.proxy(function(t){this.setNodeSpecificBindings(t),t=null},this))),t=null};E.mutatorInfo={ignoreNodeContentsList:"input,select,img,link,meta,title,textarea,br,hr,script".split(","),watchNodeList:"html,head,header,h1,h2,h3,h4,h5,article,aside,section,details,footer,figure,nav,body,div,span,ul,li,dd,dt,ol,dl,tr,td,span,form,img,a,area,iframe,fieldset,select,input,textarea,table,label",svgWatchNodeList:"svg,defs,g,symbol,use,circle,ellipse,line,polygon,polyline,rect,linearGradient,radialGradient,animate,animateColor,animateMotion,animateTransform,set,stop,a,altGlyphDef,clipPath,color-profile,cursor,filter,font,font-face,foreignObject,image,marker,mask,pattern,switch,text,view,path,clippath",domRewriteList:"appendChild,removeChild,removeNode,insertAdjacentHTML,replaceChild,replaceNode,swapNode,insertBefore".split(",")};var v=E.mutatorInfo;E.prototype.setupMutationObserver=function(t,e){var i=this,r=this.mutationSynonym,s=e.domAttrModifiedHandler(t,e,i.config,!0),n=e.domSubtreeModifiedHandler(t,e,i.config,!0);if(r)return e.mutationObserver=new window[r](function(t){t.forEach(function(t){var e;switch(t.type){case"attributes":b(t.attributeName,t.target.tagName)&&(e={target:t.target,attrName:t.attributeName,newValue:t.target.getAttribute(t.attributeName)},s(e)),e=null;break;case"characterData":e={target:t.target.parentNode},n(e);break;case"childList":w(t)&&(e={target:t.target},n(e),e=null)}})}),this.mutationConfig={attributes:!0,childList:!0,subtree:!0},e.mutationObserver.observe(t.win.document,this.mutationConfig),!0};var w=function(t){var e,i;if(t.addedNodes&&t.addedNodes.length>0)for(e=0;e<t.addedNodes.length;e++)if(i=t.addedNodes[e],"SCRIPT"!=i.tagName)return!0;if(t.removedNodes&&t.removedNodes.length>0)for(e=0;e<t.removedNodes.length;e++)if(i=t.removedNodes[e],"SCRIPT"!=i.tagName)return!0},b=function(t,e){return!(!t||"_"==t.substr(0,1)||"on"==t.substr(0,2)||"href"==t||"script,meta,title".indexOf(e)>=0)&&(!(0===t.indexOf("siz")||0===t.indexOf("jQuery"))||0===t.indexOf("_fsrb"))};E.prototype.propertyChangeHandler=function(t){var e=t.propertyName,r=t.srcElement,config=this.config;if(!b(e,r.tagName))return void(r=null);if("innerHTML"==e||"innerText"==e||"outerHTML"==e)("outerHTML"==e||r.tagName&&"select"==r.tagName.toLowerCase())&&(r=r.parentNode),this.mutationSynonym||this.domUpdateThrottler.push(r,function(t,e){return function(i){var r=t.recorder,s=r.masker._tagDynamicMaskNodes(e,!1,r.win),n=M.getMapping(e),o=r.getLogger();o&&(o.log(r,P.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED,{x:o.logXPath(r,n),h:d.ProcessHTML(e.innerHTML,r.win.document,n,s,config)},null,i),t._handleDomUpdateIfNecessary(e)),e=null,t=null,s=null}}(this,r),!1);else if("on"!=e.substring(0,2)){for(var s=0;s<v.domRewriteList.length;s++)if(e==v.domRewriteList[s])return;if("on"==e.substr(0,2).toLowerCase())return;var n=r[e];e.indexOf("style.")>-1&&(e="style",n=r.getAttribute(e)),this.mutationSynonym||this.domUpdateThrottler.push(r,function(t,r){return function(s){if(t.recorder.masker._tagDynamicMaskNodes(r,!1,t.recorder.win),"style"==e){var o=r.getAttribute("style")||r.style;o&&o.cssText&&(n=o.cssText)}var a=t.recorder.getLogger(),c=M.getMapping;if(a)if("style"==e){n&&"null"!=n||(n="");var h=a.logXPath(t,c(r,null,"id"==e)),l=r.getAttribute("style")||r.style;l&&a.log(t.recorder,P.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:e,v:"undefined"!=typeof l.cssText?l.cssText:l+"",x:h},null,s)}else{var d=r.tagName.toLowerCase();"object"==typeof n||"value"==e&&"input"==d&&"hidden"==r.type||i.inArray(d,["input","select","textarea"])&&!i.inArray(e,["className","cols","rows","class","width","height","align"])||a.log(t.recorder,P.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:e,v:n+"",x:a.logXPath(t,c(r,null,"id"==e))},null,s)}t=null,a=null,r=null}}(this,r),!0,e)}r=null,t=null},E.prototype.domSubtreeModifiedHandler=function(t,e,r){return function(t){var s,n=t.originalTarget||t.target||t.srcElement,o=n.tagName?n.tagName.toLowerCase():"";if(i.inArray(o,v.ignoreNodeContentsList))"select"==o&&null!==n._fsrTracker&&e.domUpdateThrottler.push(n,function(t){return function(){t._fsrTracker&&t._fsrTracker.serialize()}}(n),!1);else{if(r.advancedSettings&&r.advancedSettings.svgCaptureEnabled&&i.inArray(o,v.svgWatchNodeList.split(","))){for(s=n;!s.innerHTML&&s.parentNode;)s=s.parentNode;n=s}e.domUpdateThrottler.push(n,function(t,e){return function(i){e._doDomUpdateWorkWithLog&&e._doDomUpdateWorkWithLog(t,i)}}(n,e),!1)}}};var N=function(t,e,i,r,s,n){return function(s){var n,o=r.getLogger(),a=M.getMapping;if(o)if("class"==e&&r.masker._tagDynamicMaskNodes(t,!0,r.win),"style"==e){n=o.logXPath(r,a(t,null,"id"==e));var c=t.getAttribute("style")||t.style;c&&"_fsrb"!=e&&o.log(r,P.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:e,v:"undefined"!=typeof c.cssText?c.cssText:c+"",x:n},null,s)}else if("_fsrb"!=e&&("value"!=e||"input"!=t.tagName.toLowerCase()||"hidden"!=t.type)&&"on"!=e.substr(0,2).toLowerCase()){var h=a(t,null,"id"==e);n=o.logXPath(r,h),o.log(r,P.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:e,v:i,x:n},null,s)}}};E.prototype.domAttrModifiedHandler=function(t,e,i){return function(r){var s=r.attrName,n=r.newValue,o=r.originalTarget||r.target||r.srcElement;"on"==s.substr(0,2)||"script,meta,title".indexOf(o.tagName)>-1||(e.domUpdateThrottler.push(o,N(o,s,n,t,e,i),!0,s),o=null)}},E.prototype._doDomUpdateWorkWithLog=function(t,e){var i=this.recorder;3==t.nodeType&&(t=t.parentNode);var r=M.getMapping(t);if(0===r[0].indexOf("html")){var s=this.recorder.masker._tagDynamicMaskNodes(t,!1,i.win),n=t.innerHTML?d.ProcessHTML(t.innerHTML,i.win.document,r,s,this.config):{},o=i.getLogger();o&&(o.log(i,P.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED,{x:o.logXPath(i,r),h:n},null,e),this._handleDomUpdateIfNecessary(t))}},E.prototype._handleDomUpdateIfNecessary=function(t){var e=t.tagName?t.tagName.toLowerCase():"";1!=t.nodeType||i.inArray(e,E.ignoreNodeContentsList)||this.recorder.DomUpdated.fire(t)},E.prototype.setNodeSpecificBindings=function(t){for(var e=t.querySelectorAll(v.watchNodeList+", "+v.svgWatchNodeList),r=function(t){return function(e){t.propertyChangeHandler(e)}}(this),s=e.length-1;s>=0;s--){var n=e[s];if(i.BindOnce(n,"record:propertychange",r,!0,!0),!this.supportsDomPrototypes){var o,a=n.getAttribute("_fsrRewrite");if(!a){n.setAttribute("_fsrRewrite","true");for(var c=v.domRewriteList.length-1;c>=0;c--)o=v.domRewriteList[c],n[o]=this.domMethodRewrites[o]}}n=null}e=null,t=null,r=null},E.prototype.methodRewriter=function(t,e){var config=this.config;return function(){var s,n=this.parentNode,o=e.domMethodCopies[t];if(o){if("BODY"==this.tagName)try{s=o(arguments[0],arguments[1])}catch(t){s=o.apply(this,arguments)}else s=o.apply(this,arguments);return n&&1==n.nodeType&&e.domUpdateThrottler.push(n,function(t,e){
return function(s){var n,o,a=t.recorder.masker._tagDynamicMaskNodes(e,!1,t.recorder.win),c=M.getMapping(e),h=t.recorder.getLogger();if(h){if(n=e.tagName.toLowerCase(),r.svgCaptureEnabled&&i.inArray(n,v.svgWatchNodeList.split(","))){for(o=e;!o.innerHTML;){if(!o.parentNode)return;o=o.parentNode}e=o}h.log(t.recorder,P.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED,{x:h.logXPath(t.recorder,c),h:d.ProcessHTML(e.innerHTML,t.recorder.win.document,c,a,config)},null,s),t._handleDomUpdateIfNecessary(e)}e=null,t=null,a=null}}(e,n),!1),s}}},E.prototype.saveDomMutationMethods=function(){var t,e;for(e=v.domRewriteList.length-1;e>=0;e--)t=v.domRewriteList[e],this.domMethodCopies[t]=this.recorder.win.document.body[t],this.domMethodRewrites[t]=this.methodRewriter(t,this)},E.prototype.overrideDomPrototype=function(){var t,i,r=this.recorder.win,s=e.isDefined(r.Element)?r.Element.prototype:void 0,n=e.isDefined(r.HTMLElement)?r.HTMLElement.prototype:void 0;for(i=v.domRewriteList.length-1;i>=0;i--)t=v.domRewriteList[i],s&&(s[t]+"").indexOf("native")>-1&&(s[t]=this.domMethodRewrites[t]),n&&(n[t]+"").indexOf("native")>-1&&(n[t]=this.domMethodRewrites[t])},E.prototype.removeDomPrototypeOverrides=function(){var t,i,r=this.recorder.win,s=e.isDefined(r.Element)?r.Element.prototype:void 0,n=e.isDefined(r.HTMLElement)?r.HTMLElement.prototype:void 0;for(i=v.domRewriteList.length-1;i>=0;i--)t=v.domRewriteList[i],s&&s[t]&&delete s[t],n&&n[t]&&delete n[t]},E.prototype.dispose=function(){this.domUpdateThrottler&&(this.domUpdateThrottler.accelerate(),this.domUpdateThrottler.dispose()),e.dispose(this.domMethodCopies),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.supportsDomPrototypes&&l._browser.isIE&&this.removeDomPrototypeOverrides(),this.domMethodCopies=null,this.domMethodRewrites=null,this.recorder=null};var M={};M.getMapping=function(t,e,i){if(e=e||[],t.parentNode&&(e=M.getMapping(t.parentNode,e)),1==t.nodeType){var r,s;if(t.previousSibling){r=1,s=t.previousSibling;do 1==s.nodeType&&s.nodeName==t.nodeName&&r++,s=s.previousSibling;while(s);1==r&&(r=null)}else if(t.nextSibling){s=t.nextSibling;do 1==s.nodeType&&s.nodeName==t.nodeName?(r=1,s=null):(r=null,s=s.previousSibling);while(s)}e.push(I(t,r,!!i))}return e};var I=function(t,e,i){var r;return t.getAttribute&&(r=t.getAttribute("id"),r&&r.indexOf("yui_")>-1&&(r=null)),t.nodeName.toLowerCase()+(r&&!i?"[@id='"+r+"']["+(e||1)+"]":e>0?"["+e+"]":"")};M.getNodeXPathPosition=function(t){for(var e=t.nodeType,i=t.tagName,r=t.parentNode,s=0,n=r.childNodes,o=n.length,a=0;o>s&&n[s];){if(n[s].nodeType==e&&(i&&i==n[s].tagName||!i)&&(a++,n[s]==t))return a;s++}return 0};var C=function(){};C.prototype={useWhiteListing:!1,dynamicWhiteListUnblocks:[],dynamicSelectorsToMask:[],dynamicSelectorsToUnmask:[],dynamicWhiteListEls:[],dynamicSelectorsToRemask:[],dynamicSelectorsToBlockAssets:[],staticWhiteListEls:[],isMasking:!1,noMaskClassArray:[]};var O="fsrHiddenBlockStart",L="fsrHiddenBlockEnd",x="fsrWhiteListStart",k="fsrWhiteListEnd";C.prototype._maskStaticBySelector=function(t,e,r){var s,n,o,a=e.document,c=a.querySelectorAll(t),h=r?x:O,l=r?k:L,d="_fsrWL";for(s=0;s<c.length;s++)n=c[s],"BODY"==n.nodeName?i.hasClass(n,d)||(i.addClass(n,d),n.insertBefore(a.createComment(h),n.firstChild),n.appendChild(a.createComment(l))):(o=n.parentNode,i.hasClass(o,d)||(i.addClass(o,d),o.insertBefore(a.createComment(h),n),o.insertBefore(a.createComment(l),n.nextSibling)))},C.prototype._remaskBySelector=function(t,e){i.removeClass(e.document.querySelectorAll(t),"fsrVisible")},C.prototype._unmaskStaticBySelector=function(t,e){i.addClass(e.document.querySelectorAll(t),"fsrVisible")},C.prototype._obscureBySelector=function(t,e){i.addClass(e.document.querySelectorAll(t),"fsrObscure")},C.prototype._maskDynamicBySelector=function(t,e,i){t.length>0&&"string"==typeof t&&(void 0===i||""===i||"inTxBlk"==i?(this._maskStaticBySelector(t,e,!1),this.dynamicSelectorsToMask[this.dynamicSelectorsToMask.length]=t):"evUnblk"==i?(this._unmaskStaticBySelector(t,e),this.dynamicSelectorsToUnmask[this.dynamicSelectorsToUnmask.length]=t):"evReblk"==i?(this._remaskBySelector(t,e),this.dynamicSelectorsToRemask[this.dynamicSelectorsToRemask.length]=t):"DOMWL"==i&&(this._maskStaticBySelector(t,e,!0),this.dynamicWhiteListUnblocks[this.dynamicWhiteListUnblocks.length]=t))},C.prototype._unmaskDynamicBySelector=function(t,e){this._maskDynamicBySelector(t,e,"evUnblk")},C.prototype._maskAssetDynamicBySelector=function(t,e){if(i.addClass(e.document.querySelectorAll(t),"fsrHidden"),t.length>0){"string"==typeof t&&(t=[t]);for(var r=this.dynamicSelectorsToBlockAssets,s=0;s<t.length;s++)r[r.length]=t[s]}},C.prototype._removeVisibility=function(t,e){this._maskDynamicBySelector(t,e,"evReblk")},C.prototype._whiteListUnblockDynamic=function(t,e){this._maskDynamicBySelector(t,e,"DOMWL")},C.prototype.addClassToNoMaskArray=function(t){this.noMaskClassArray[this.noMaskClassArray.length]=t},C.prototype.isNodeMasked=function(t){var e,i,r,s=!0;if(this.noMaskClassArray.length>0&&t.className)for(e=this.noMaskClassArray,i=0;i<e.length;i++)r=e[i],t.className.indexOf(r)>-1&&(s=!1),i=r=null;return t.childNodes.length<1||!s||!!(t.childNodes[0].data&&t.childNodes[0].data.indexOf(O)>-1)},C.prototype._tagDynamicMaskNodes=function(t,e,r){var s,n,o,a=r.document,c=!1,h="_fsrWL";if(!this.isMasking){if(this.isMasking=!0,this.useWhiteListing){if(c=!0,this.dynamicWhiteListUnblocks.length>0&&!e)for(o=a.querySelectorAll(this.dynamicWhiteListUnblocks.join(",")),s=0,n=o.length;s<n;s++)if(U.nodeBelongsTo(t,o[s])||o[s]==t){if(!this.isNodeMasked(t)){c=!1;break}}else U.nodeBelongsTo(o[s],t)&&(this.isNodeMasked(o[s])||i.hasClass(o[s],h)||(i.addClass(o[s],h),o[s].insertBefore(a.createComment(x),o[s].firstChild),o[s].appendChild(a.createComment(k))))}else if(this.dynamicSelectorsToMask.length>0&&!e)for(o=a.querySelectorAll(this.dynamicSelectorsToMask.join(",")),s=0,n=o.length;s<n;s++)if(U.nodeBelongsTo(t,o[s])||o[s]==t){if(!this.isNodeMasked(t)){c=!0;break}}else U.nodeBelongsTo(o[s],t)&&(this.isNodeMasked(o[s])||(o[s].insertBefore(a.createComment(O),o[s].firstChild),o[s].appendChild(a.createComment(L))));if(this.dynamicSelectorsToUnmask.length>0){for(s=this.dynamicSelectorsToUnmask.length-1;s>=0;s--)i.addClass(a.querySelectorAll(this.dynamicSelectorsToUnmask[s]),"fsrVisible");for(n=this.dynamicSelectorsToRemask.length-1;n>=0;n--)i.removeClass(a.querySelectorAll(this.dynamicSelectorsToRemask[n]),"fsrVisible")}if(this.dynamicSelectorsToBlockAssets.length>0)for(s=this.dynamicSelectorsToBlockAssets.length-1;s>=0;s--)i.addClass(a.querySelectorAll(this.dynamicSelectorsToBlockAssets[s]),"fsrHidden");this.isMasking=!1}return c},C.prototype.maskDocument=function(t,e){var r=(e.location.href||"about:blank").toLowerCase();if(this.useWhiteListing=!1,t.staticWhiteListEls)for(var s in t.staticWhiteListEls)if(t.staticWhiteListEls.hasOwnProperty(s)&&(r.indexOf(s)>-1||i.testAgainstSearch(s,r))){this.useWhiteListing=!0;break}if(t.dynamicWhiteListEls)for(var n in t.dynamicWhiteListEls)if(t.dynamicWhiteListEls.hasOwnProperty(n)&&(r.indexOf(n)>-1||i.testAgainstSearch(n,r))){this.useWhiteListing=!0;break}t.useWhiteListing=this.useWhiteListing;var o=function(t,e,s,n,o){for(var a in e)(r.indexOf(a)>-1||i.testAgainstSearch(a,r))&&s.call(t,e[a],n,o)};this.useWhiteListing?(o(this,t.staticWhiteListEls,this._maskStaticBySelector,e,!0),o(this,t.dynamicWhiteListEls,this._whiteListUnblockDynamic,e)):(o(this,t.staticBlockEls,this._maskStaticBySelector,e),o(this,t.dynamicBlockEls,this._maskDynamicBySelector,e)),o(this,t.staticVisibleEls,this._unmaskStaticBySelector,e),o(this,t.dynamicVisibleEls,this._unmaskDynamicBySelector,e),o(this,t.assetBlockEls,this._maskAssetDynamicBySelector,e),o(this,t.removeVisibilityEls,this._removeVisibility,e),o(this,t.obscureEls,this._obscureBySelector,e)};var D={_browser:null,_cacheList:[]};D.getCacheableObject=function(t,r){var s=D._browser.isMobile;r&&r.join&&(r=r.join(","));var n,o={},a=D,c=a._cacheList;for(n=c.length-1;n>=0;n--)if(c[n].str==t){o.uid=c[n].uid;break}if(!e.isDefined(o.uid)){if(o.uid=i.generateGUID(),o.kl=r,r&&t.length>100)for(n=c.length-1;n>=0;n--)if(c[n].kl==r){var h=A(c[n].str,t);o.diff={uid:c[n].uid,d:h};break}e.isDefined(o.diff)?(!s||c.length<500)&&(c[c.length]={str:t,uid:o.uid,kl:o.kl}):(o.str=t,(!s||c.length<500)&&(c[c.length]=o))}return o},D.reset=function(){D._cacheList=[]};var A=function(t,e){for(var i=t,r=e,s=t.length,n=e.length,o=s>n?n:s,a=o,c=0,h=0,l=0,d=0;a-c>15;)d=Math.round((a-c)/2),l=a-d,i.substr(0,l)!=r.substr(0,l)?a=l:c=l;var u=e.substr(c);for(a=u.length;a-h>15;)d=Math.round((a-h)/2),l=a-d,u.substr(u.length-l)!=i.substr(i.length-l)?a=l:h=l;return{o:c,c:h,r:e.substring(c,e.length-h)}},R=[],P=function(t,r,s,config){this.config=config,this.recorder=s,this.browser=r,this.cors=new i.CORS(r,t.fstg),this.isIframeMode=s.isIframeMode;var n=t.get([c.GLOBALSESSIONID,c.TRANSMITTING,c.CANCELED,"pv"]),o=n[c.GLOBALSESSIONID],a=n[c.TRANSMITTING],h=n[c.CANCELED],l=i.getScreenResolution();this.stg=t,this.pageViews=t.get("pv"),this.failCount=0,this.transportid=0,this.lastTransmissionTime=0,this.holdTransmits=!1,this.transmitting=!1,this.canceled=!1,this.siteid=config.clientId||"unk",this.domain=document.domain.toString(),this.StorageReady=new i.FSEvent,this.TransportReady=new i.FSEvent,this._quickXpathCache={},this._reset(),this.isIframeMode?(this.TransportReady.fire(),this.transmitting=!0,this.StorageReady.fire(),this.iFrameCommitItv=setInterval(e.proxy(this._flushAndTransmit,this),1e3)):(this.log(s,P.EVENT_TYPES.PAGE_MARKER,{dtm:e.startTS,ofs:(new Date).getTimezoneOffset(),v:r.browser.name,dv:r.browser.version,sid:config.clientId,r:"W3C",l:config.layout,m:r.isMobile,f:document.referrer.toString(),sz:{w:l.w,h:l.h}},-1),i.Bind(window,"unload",e.proxy(function(){this.commitData()},this)),this._backup_storage=new i.DomStorage(this.siteid,!1,!1,r),this._storage=new i.WindowStorage(this.siteid,!1,r),this._syncStorage(),this._syncSession(o,!!a,!!h),this._syncData(),this.startStateMonitor(),this.startStorageMonitor(),this.TransportReady.subscribe(e.proxy(function(){this.StorageReady.fire(),this.transmitting&&this.startHeartbeat(),this._flushAndTransmit()},this),!0,!0),this.TransportReady.fire(),this.recorder.ready.subscribe(e.proxy(function(){this.recorder.EmergencySendRequired.subscribe(e.proxy(function(){this._flushAndTransmit(!0)},this))},this),!0,!0)),s=null};P.prototype.commitData=function(){this._flush(),this.transmitting&&this._transmit(),this._storage&&(this._storage.set(c.SESSION,this._session),this._storage.setBlob(this._data),this._storage.commit()),this._backup_storage&&(this._backup_storage.set(c.SESSION,this._session),this._backup_storage.setBlob(this._data),this._backup_storage.commit())},P.prototype.dispose=function(){this._flush(),this.cors.dispose(),this.iFrameCommitItv&&clearInterval(this.iFrameCommitItv),this.recorder.EmergencySendRequired.unsubscribeAll(),this.recorder.EmergencySendRequired=null,this.stopStorageMonitor(),this.stopStateMonitor()},P.prototype.setTransmitOK=function(){this.canceled||(this.transmitting=!0,this._session[c.TRANSMITTING]=!0,this.stg.set(c.TRANSMITTING,!0),this._flushAndTransmit(),this.startHeartbeat())},P.prototype.setTransmitNotOK=function(){this.stopHeartbeat(),this.transmitting=!1,this._session[c.TRANSMITTING]=!1,this.stg.set(c.TRANSMITTING,!1)},P.prototype.cancelRecord=function(t){this.setTransmitNotOK(),this.stopStateMonitor(),this.stopStorageMonitor(),this.canceled=!0,this._session[c.CANCELED]=!0,this.stg.set(c.CANCELED,!0),t&&this.stg.set(_SESSION_SYMBOLS.CANCELEDPERMANENT,this.cancel),this.iFrameCommitItv&&clearInterval(this.iFrameCommitItv),this._reset()},P.prototype._syncStorage=function(){var t,e,i=this._storage,r=this._backup_storage;i&&r&&i.isNew()&&!r.isNew()&&(t=r.get(c.SESSION),i.set(c.SESSION,t),e=r.getBlob(),i.setBlob(e))},P.prototype._syncSession=function(t,r,s){var n=this._storage||this._backup_storage;if(n){if(this.refreshLastTime=this.stg.get(c.GLOBALREFRESHTIME),this.refreshLastTime){this.refreshLastTime=parseInt(this.refreshLastTime);var o=36e5;i.now()-this.refreshLastTime>o&&(t=null,n.erase(c.SESSION),this.stg.erase([c.GLOBALSESSIONID,c.SESSIONID]))}n.get(c.SESSION)?(this._session=n.get(c.SESSION),this.sessionid=this._session[c.SESSIONID],this.gsessionid=this._session[c.GLOBALSESSIONID],this.stg.set(c.SESSIONID,this.sessionid),e.isDefined(r)?(this.transmitting=r,this._session[c.TRANSMITTING]=this.transmitting):(this.transmitting=this._session[c.TRANSMITTING],this.stg.set(c.TRANSMITTING,this.transmitting)),e.isDefined(s)?(this.canceled=s,this._session[c.CANCELED]=this.canceled):(this.canceled=this._session[c.CANCELED],this.stg.set(c.CANCELED,this.canceled)),n.set(c.SESSION,this._session)):(this._session={},this.sessionid=i.generateGUID(),this._session[c.SESSIONID]=this.sessionid,t||(t=i.generateGUID()),this.gsessionid=t,this._session[c.GLOBALSESSIONID]=this.gsessionid,this.stg.set(c.GLOBALSESSIONID,this.gsessionid),this.transmitting=r,this._session[c.TRANSMITTING]=this.transmitting,this.stg.set(c.TRANSMITTING,this.transmitting),this.canceled=s,this._session[c.CANCELED]=this.canceled,this.stg.set(c.CANCELED,this.canceled),n.set(c.SESSION,this._session),n.commit()),this.refreshLastTime=i.now(),this._session[c.GLOBALREFRESHTIME]=this.refreshLastTime,this.stg.set(c.GLOBALREFRESHTIME,this.refreshLastTime)}},P.prototype._syncData=function(){this._storage?this._data=this._storage.getBlob():this._backup_storage&&(this._data=this._backup_storage.getBlob())},P.prototype._flushAndTransmit=function(t){if((this._storage||this._backup_storage)&&!this.canceled||this.isIframeMode){var e=this.testStorageLimit();this.transmitting&&(i.now()-this.lastTransmissionTime>5e3||t)||e||this.isIframeMode?(this._flush(),this._transmit()):t&&this.browser.isMobile&&this.commitData()}},P.prototype.processImmediately=function(t){i.Healthy(this.browser,["cxreplay"],e.proxy(function(){this.cors.send({method:"GET",url:i.sign(e.config.recUrl+"process/"+e.enc(this.gsessionid)+"?delay="+(t||0)),failure:e.proxy(function(t){},this),success:e.proxy(function(t){},this)})},this))},P.prototype._transmit=function(){if(0!==this._data.length||this.isIframeMode)return this.isIframeMode?void(this._data.length>0&&(h.SendDataToParentFrame(this.recorder.iFrameParentFr,this.recorder.ifrid,this._data),this._data="")):this.holdTransmits&&i.now()-this.lastTransmissionTime<1e4?void(this.hasEmergency=!0):void i.Healthy(this.browser,["cxreplay"],e.proxy(function(){this.holdTransmits=!0,this.hasEmergency=!1,this.lastTransmissionTime=i.now();var t,r="corsservice",s=this.siteid.replace(/[- _.&]/g,"").toLowerCase(),n='{"data":['+this._data+"]}",o=n.length;B.set("rtp",r.substr(0,1)),!this.config.advancedSettings.skipCompression&&o>1e3&&o<1e6&&(n=i.Compress.fragmentAndCompress(n)),t="datalen:"+n.length+",time:"+i.now(),B.increment("rta"),this.cors.send({action:"data",method:"POST",contentType:"text/plain;charset=UTF-8",encoding:e.enc(U.getEncoding()),version:5,gSessionId:this.gsessionid,sessionId:this.sessionid,domain:this.domain||window.location.hostname,siteId:s,url:e.config.recUrl+r+"?action=data&metadata="+e.enc(t)+"&encoding="+e.enc(U.getEncoding())+"&session_id="+e.enc(this.sessionid)+"&global_session_id="+e.enc(this.gsessionid)+"&domain="+e.enc(this.domain)+"&site_id="+e.enc(s)+"&version=5.0&cachebust="+Math.random(),skipEncode:!0,data:n,failure:e.proxy(function(t){B.increment("rtf"),this.failCount++,this.holdTransmits=!1;try{t=JSON.parse(t)}catch(t){}if(e.isDefined(t.status)){var i=Math.abs(parseInt(t.status));B.increment("rtf"+i)}return this.failCount>10?(B.set("rtcr",1),B.set("rtcp",this.pageViews),void this.cancelRecord()):void(this.hasEmergency&&setTimeout(e.proxy(function(){this._flushAndTransmit(!0)},this),100))},this),success:function(t,i,r){return function(s){B.increment("rts"),t.failCount=0,t.holdTransmits=!1;try{s=JSON.parse(s)}catch(t){}if(e.isDefined(s.status)){var n=parseInt(s.status,10);if(1==n)i==t.transportid?t._data="":t._data.substr(0,r.length)==r&&(t._data=t._data.substr(r.length));else if(2==n)return B.set("rtcr",2),B.set("rtcp",t.pageViews),void t.cancelRecord();t.hasEmergency&&setTimeout(function(){t._flushAndTransmit(!0)},100)}}}(this,this.transportid,this._data+"")})},this))},P.prototype._ping=function(){e.isDefined(this.transport)&&!this.canceled&&i.Healthy(this.browser,["cxreplay"],e.proxy(function(){var t=this.siteid.replace(/[- _.&]/g,"").toLowerCase();this.transport||(this.transport=new this.transport),this.cors.send({action:"ping",contentType:"text/plain;charset=UTF-8",sessionId:this.sessionid,siteId:t,url:e.config.recUrl+"corsservice?action=ping&session_id="+e.enc(this.sessionid)+"&site_id="+e.enc(t)+"&cachebust="+Math.random(),skipEncode:!0,data:"",failure:function(){},success:function(){}})},this))},P.prototype._reset=function(){this._log={start:this._log?i.now():e.startTS,log:[],guid:i.generateGUID()},this._log_size_est=0},P.prototype._flush=function(){if(0!==this._log.log.length){this.transportid++,this._log.log.toJSON=null;var t=JSON.stringify(this._log);t&&t.length>0&&(this._data&&this._data.length>0?this._data=this._data+","+t:this._data=t),this._reset()}},P.prototype.logXPath=function(t,i){if(!this.canceled){if(i=i.join(","),!e.isDefined(this._quickXpathCache[i])){R[R.length]=i;var r=this.recorder.iFramexPathPrefix+(R.length-1);this._quickXpathCache[i]=r,this.log(t,P.EVENT_TYPES.XPATH_CACHE,{idx:r,xp:i},r)}return this._quickXpathCache[i]}},P.prototype.log=function(t,r,s,n,o){if(!this.canceled){var a=0;o||(o=0);var c={x:e.isDefined(n)?n:this.logXPath(t,t.getPath()),e:r,d:s,t:Math.max(0,i.now()-this._log.start-o)};this._log.log[this._log.log.length]=c,r==P.EVENT_TYPES.DOM_SERIALIZE?s.dom.str&&(a=s.dom.str.length,this._log_size_est+=a):r==P.EVENT_TYPES.CSS_SERIALIZE?s.stylesheet?(a=s.stylesheet.length,this._log_size_est+=a):s.v&&(a=Math.round(1*s.v.length),this._log_size_est+=a):r==P.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED?s.h.str||s.h.diff?(a=Math.round(1*((s.h.str?s.h.str.length:0)+(s.h.diff?s.h.diff.d.r.length:0)+(s.h.kl?s.h.kl.length:0)+(s.h.uid?s.h.uid.length:0))),a+=50,this._log_size_est+=a):(a=84,this._log_size_est+=a):(a=60,this._log_size_est+=a)}},P.prototype.testStorageLimit=function(){return!this.isIframeMode&&this._data.length+this._log_size_est>3e6},P.prototype._monitorState=function(){var t=this.stg.get([c.CANCELED,c.TRANSMITTING]),i=t[c.CANCELED],r=t[c.TRANSMITTING];return e.isDefined(i)&&this.canceled!=i&&i?void this.cancelRecord():void(e.isDefined(r)&&this.transmitting!=r&&(r?this.setTransmitOK():this.setTransmitNotOK()))},P.prototype.startHeartbeat=function(){this.heartbeatTransmit||(this._ping(),this.heartbeatTransmit=setInterval(e.proxy(function(){this._ping()},this),45e3))},P.prototype.stopHeartbeat=function(){this.heartbeatTransmit&&(clearInterval(this.heartbeatTransmit),delete this.heartbeatTransmit)},P.prototype.startStateMonitor=function(){this.stateMonitor||(this._monitorState(),this.stateMonitor=setInterval(e.proxy(function(){this._monitorState()},this),2e3))},P.prototype.stopStateMonitor=function(){this.stateMonitor&&(clearInterval(this.stateMonitor),delete this.stateMonitor)},P.prototype.startStorageMonitor=function(){this.storageMonitor||(this.storageMonitor=setInterval(e.proxy(function(){this.log(this.recorder,P.EVENT_TYPES.HEARTBEAT,{ofs:(new Date).getTimezoneOffset()},-1),this._flushAndTransmit()},this),this.browser.isMobile?1e4:2e4))},P.prototype.stopStorageMonitor=function(){this.storageMonitor&&(clearInterval(this.storageMonitor),delete this.storageMonitor)},P.prototype.clearState=function(){this._session=!1,this._storage.kill(),this._backup_storage.kill(),this.commitData()},P.EVENT_TYPES={DOM_SERIALIZE:0,XPATH_CACHE:1,FRAME_SIZE:2,FRAME_SCROLL:3,MOUSE_MOVE:4,WINDOW_MOUSEOUT_MOUSEENTER:5,INPUT_SERIALIZE:6,FOCUS_BLUR:7,KEY_PRESS:8,CARET_INFO:9,VALUE_CHANGED:10,DOM_MUTATION_NODE_MODIFIED:11,DOM_MUTATION_NODE_ATTR_MODIFIED:12,JAVASCRIPT_ERROR:13,MOUSE_CLICK:14,MOUSE_DOWN:15,MOUSE_UP:16,PAGE_MARKER:17,DOC_SIZE:18,SCROLL_EL:19,NOT_RECORDED:20,CSS_SERIALIZE:21,ORIENTATION:22,ZOOM:23,TOUCH:24,INCOMPLETE_INPUT_CAPTURE:25,ORIENTATION_CHANGE:26,CUSTOM_BEHAVIOR:27,CUSTOM_ERROR:28,HEARTBEAT:29};var B={};B.increment=function(t,e){try{var i=t.get("meta")||{};i[e]=(i[e]||0)+1,t.set("meta",i)}catch(t){}},B.set=function(t,e,i){try{var r=t.get("meta")||{};r[e]=i,t.set("meta",r)}catch(t){}};var U={};U.nodeBelongsTo=function(t,e){if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));for(;t.parentNode;){if(t==e||t==e.body)return!0;t=t.parentNode}return!1},U.getEncoding=function(){return l._browser.isIE?window.document.charset:window.document.characterSet},U.getParentWindow=function(t){var e=t;if(t){if(t._pw)return t._pw;if(t.ownerDocument&&t.ownerDocument.defaultView)return t.ownerDocument.defaultView;for(;t.parentNode||t.document;){if(t.document)return e._pw=t,t;t=t.parentNode}}},U.getStyle=function(t,e,i){if(!e)return"";var r="",s=e.document.defaultView;return s&&s.getComputedStyle&&s.getComputedStyle(t,"")?r=s.getComputedStyle(t,"").getPropertyValue(i):t.currentStyle&&(i=i.replace(/\-(\w)/g,function(t,e){return e.toUpperCase()}),r=t.currentStyle[i]),r},U.getPosition=function(t,e){for(var i=0,r=0,s=U.getStyle;t;)i+=t.offsetTop+(parseFloat(s(t,e,"borderTopWidth"))||0),r+=t.offsetLeft+(parseFloat(s(t,e,"borderLeftWidth"))||0),t=t.offsetParent;return{x:r,y:i}},U.getPositionRelativeToMainView=function(t,e,r){for(var s,n=!1;!n&&e;){n=e.parent==e;var o=U.getPosition(t,e),a=i.getScroll(e);r&&!n&&(o.x-=a.x,o.y-=a.y),s?(s.x+=o.x,s.y+=o.y):s=o,t=e.frameElement,e=e.parent}return s},U.getDocSize=function(t){var e=t||window.document,i=e.body,r=e.documentElement,s=Math.max;return{width:s(s(i.scrollWidth,r.scrollWidth),s(i.offsetWidth,r.offsetWidth),s(i.clientWidth,r.clientWidth)),height:s(s(i.scrollHeight,r.scrollHeight),s(i.offsetHeight,r.offsetHeight),s(i.clientHeight,r.clientHeight))}},U.externalizeStyleCSSTextToInnerHTML=function(t){var i,s,n=!1;if(e.isDefined(r.useCSSText)||(i=document.createElement("style"),i.setAttribute("type","text/css"),r.useCSSText=e.isDefined(i.styleSheet)),r.useCSSText){i="style"==t.nodeName.toLowerCase()?[t]:t.querySelectorAll("style");for(var o=0,a=i.length;o<a;o++)s=i[o],s.styleSheet&&s.styleSheet.cssText&&s.styleSheet.cssText.replace(/\s/gi,"").length!=s.innerHTML.replace(/\s/gi,"").length&&(s.innerHTML=s.styleSheet.cssText,n=!0)}return n};var W=function(t,r,s,n,o,config,a,c,d,u,g){D._browser=l._browser=this.browser=r,g&&this.setXFrameScrollPosition(g),this.isIframeMode=!!a,this.iFramexPathPrefix=u||"",this.ifrid=c,this.iFrameParentFr=d,this.config=config,this.stg=t,this.win=s,this.ready=new i.FSEvent,this.childRecorders=[],this.disposed=!1,this.DomUpdated=new i.FSEvent,this.DomUpdated.subscribe(e.proxy(function(){this.update.apply(this,arguments)},this)),this.EmergencySendRequired=new i.FSEvent,this.instancePath=n||[],this.isMousedOverWindow=!1,this.logger=this.eventcap=this.recordParent=null,this.win.document&&(this.recordParent=o,o||(this.logger=new P(t,r,this,this.config)),this.getLogger().StorageReady.subscribe(e.proxy(function(){this.ready.fire(),config.advancedSettings&&(this.masker=new C,this.masker.maskDocument(config.advancedSettings.pii,this.win)),this.serializeDom(),this.eventcap=new l(this,r,this.config,this.isIframeMode),_.performFrameBindings(this),a||h.BeginTrackingChildFrames(this),o||this.logger._flushAndTransmit(!0),r.isMobile&&this.setTransmitOK()},this),!0,!0)),o=null,s=null,n=null};W.prototype.update=function(t){t||(t=this.doc.body),0!==t.childNodes.length&&(this.eventcap.updateNodeBinding(t,!!t),_.performFrameBindings(this,t))},W.prototype.getLogger=function(){return this.recordParent?this.recordParent.getLogger():this.logger||{log:function(){}}},W.prototype.logCustomEvent=function(t,i,r){e.isDefined(t)&&"string"==typeof t||(t=""),this.getLogger().log(this,r,{attrName:t,v:JSON.stringify(i)})},W.prototype.getPath=function(){return this._getPathCache||(this.recordParent?this._getPathCache=this.instancePath.concat(this.recordParent.getPath()):this._getPathCache=this.instancePath),this._getPathCache},W.prototype.getTop=function(){return this.recordParent?this.recordParent.getTop():this},W.prototype.setTransmitOK=function(){this.getLogger().setTransmitOK()},W.prototype.processImmediately=function(t){this.getLogger().processImmediately(t)},W.prototype.setTransmitNotOK=function(){this.getLogger().setTransmitNotOK()},W.prototype.cancelRecord=function(t){this.getLogger().cancelRecord(t)},W.prototype.dispose=function(){D.reset();var t=this;if(t.win||(t=t.recorder),!this.disposed){this.disposed=!0;for(var e=0;e<t.childRecorders.length;e++)t.childRecorders[e].dispose();t.eventcap&&t.eventcap.dispose(),t.lastRawMouseCoords&&(t.lastRawMouseCoords=null),t.eventcap=null,t.win=null,t.recordParent=null,t.DomUpdated.unsubscribeAll(),t.DomUpdated=null,t.logger&&(t.logger.dispose(),t.logger=null),t=null,i.Unbind("record:*")}},W.prototype.clearState=function(){this.logger&&this.logger.clearState()},W.prototype.serializeDom=function(){if(this.getLogger()){var t;if(this.win==this.win.top){var r=this.win.document.body;t=D.getCacheableObject(r.innerHTML,M.getMapping(r)).uid}this.getLogger().log(this,P.EVENT_TYPES.DOM_SERIALIZE,{dom:d(this.win,this.getPath(),this.config),url:this.win.location.href.toString(),v:this.browser.agent,buid:t,start:e.startTS,tz:(new Date).getTimezoneOffset(),domloadtime:i.now()-e.startTS})}},W.prototype.getGlobalId=function(){return this.getLogger().gsessionid},W.prototype.setXFrameScrollPosition=function(t){this.ifrFrameOffset=t};var F=new i.FSEvent;e.API.expose("beginTransmitting",function(){F.subscribe(function(){n.controller.beginTransmitting()},!0,!0)}),e.API.expose("cancelRecord",function(){F.subscribe(function(){n.controller.cancelRecord()},!0,!0)}),e.API.expose("getSession",function(t){t=t||function(){},F.subscribe(function(){var e=n.controller.recorder.logger;t({sessionid:e.sessionid,gsessionid:e.gsessionid,sig:e.gsessionid+"/"+e.sessionid})},!0,!0)});var V=function(t){n.controller=t,F.fire()},H=function(config,t){this.config=config,this.browser=t};H.prototype.supported=function(){var t,e=this.config.advancedSettings,r=this.browser,s=this.config.blacklist,n=e.device_type_support,o=location.toString();if(!(e.browser_cutoff[r.browser.name]&&r.browser.actualVersion>=e.browser_cutoff[r.browser.name]||e.platform_cutoff[r.os.name]&&r.os.version>=e.platform_cutoff[r.os.name]))return!1;if(n&&(!n.desktop&&!r.isMobile||!n.tablet&&r.isTablet||!n.phone&&r.isMobile&&!r.isTablet))return!1;if(s&&s.active&&s.text&&s.text.length>0)for(t=0;t<s.text.length;t++)if(i.testAgainstSearch(s.text[t],o))return!1;for(t=0;t<e.device_blacklist.length;t++)if(r.agent.toLowerCase().indexOf(e.device_blacklist[t].toLowerCase())>-1)return!1;return!0};var z=null;return s.prototype.isIframe=function(){return window!=window.top},s.prototype.isCrossDomainFrame=function(){if(this.isIframe())try{var t=window.top.document.body.toString().length;return t.length<0}catch(t){return!0}return!1},s.prototype.initialize=function(t,s,n,o){"undefined"!=typeof Uint8Array&&i.Healthy(t,["cxreplay"],e.proxy(function(){var a=this.isIframe(),c=this.isCrossDomainFrame();if(!a||c){if(o&&e.ext(r.advancedSettings||{},o),this.winobj=s,this.browser=t,r&&r.instances)for(var h=0;h<r.instances.length;h++){var l=r.instances[h];if(!l.disabled){e.ext(r,l);break}}this.crit=new H(r,t),this.stg=n,n.ready.subscribe(e.proxy(function(){t.ready.subscribe(e.proxy(function(){this.crit.supported()&&(c?i.Bind(window,"message",e.proxy(function(o){if(o.data=o.data+"",o.data&&e.isFunction(o.data.indexOf)&&o.data.length>3&&o.data.indexOf("{")>-1){var a;try{a=JSON.parse(o.data)}catch(t){return}a.src&&"fsframe"==a.src||(a.cxr&&a.id?(this.recorder=new W(n,t,s,a.xp,null,r,c,a.id,o.source,a.sid,a.sp),i.Bind(window,"unload",e.proxy(function(){if(this.recorder){var t=this.recorder.ifrid;window.top.postMessage({unloadiFrame:!0,frameId:t},"*"),this.recorder.dispose(),this.recorder=null}},this))):a.cxsp&&this.recorder&&this.recorder.setXFrameScrollPosition(a.sp))}},this)):(this.recorder=new W(n,t,s,null,null,r,c),i.Bind(window,"unload",e.proxy(function(){this.recorder&&(this.recorder.dispose(),this.recorder=null)},this)),a||V(this)))},this),!0,!0)},this),!0,!0)}},this),function(){})},s.prototype.beginTransmitting=function(){this.recorder&&this.recorder.setTransmitOK()},s.prototype.dispose=function(){this.recorder&&(this.transmitIfCan(),this.recorder.dispose(),z=null)},s.prototype.transmitIfCan=function(){var t=this.recorder;if(t){var e=t.getLogger();e&&e.transmitting&&e._flushAndTransmit()}},s.prototype.cancelRecord=function(){this.recorder&&(this.recorder.dispose(),this.recorder=null)},s.getInstance=function(t,e,i,r){return null===z&&(z=new s(t,e,i,r)),z},s});