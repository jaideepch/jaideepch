/***************************************
* @preserve
* ForeSee Web SDK: mouseoff
* Built April 27, 19 21:28:57
* Code version: 19.7.5
* Template version: 19.7.5
***************************************/
_fsDefine(["require","fs",_fsNormalizeUrl("$fs.utils.js")],function(e,fs,utils){var t=function(e,t,s,o,i){fs.ext(this,{browser:s,gstg:o,journey:i,trigger:e,surveydef:t,mode:fs.toLowerCase(t.mouseoff.mode)},!1),fs.supportsDomStorage?"lasttab"!=this.mode||!s.isIE&&"Edge"!=s.browser.name||(this.mode="multitab"):this.mode="off"};return t.prototype.initialize=function(){var n,a,f,u,r,m=0,h=0,t=utils.now(),s=t;this.mousemoveHandler=function(e){100<(t=utils.now())-s&&(f=Math.sqrt(Math.pow(e.pageX-m,2)+Math.pow(e.pageY-h,2))/(t-s),m=e.pageX,h=e.pageY,s=t)}.bind(this),this.mouseleaveHandler=function(e){var t,s,o,i;document.hasFocus()&&(t=m,s=h,o=e.pageX,i=e.pageY,a=window.pageYOffset,n=window.pageXOffset,pagewidth=window.innerWidth,r=(a-(i-(u=(i-s)/(o-t))*o))/u-n,isNaN(r)&&(r=o),i<s&&0<=r&&r<=pagewidth)&&(this.dispose(),this.gstg._sync(function(){this.gstg.get("i")||(this.trigger.cpps.set("mouseoff",!0),this.journey.addEventsDefault("properties",{fs_inviteType:["mouseoff"]}),this.surveydef.mouseoff.sp&&this.surveydef.mouseoff.sp.reg&&this.journey.addEventsDefault("properties",{fs_samplePercentage:[this.surveydef.mouseoff.sp.reg]}),this.surveydef.mouseoff.lf&&this.journey.addEventsDefault("properties",{fs_loyaltyFactor:[this.surveydef.mouseoff.lf]}),this.journey.addEventObj({name:"fs_mouseoff",metrics:{fs_mouseoff_speed:f,fs_mouseoff_slope:Math.max(u,-9999),fs_mouseoff_pagewidth:pagewidth,fs_mouseoff_xintercept:r,fs_mouseoff_xpercentage:r/pagewidth,fs_mouseoff_pagenumber:this.gstg.get("pv")}}),this.successCb())}.bind(this)))}.bind(this)},t.prototype.startListening=function(e,t){var s,o=this.surveydef.mouseoff.minPageTime||0,i=this.surveydef.mouseoff.minSiteTime||0,n=this.gstg.get("sst")+i-utils.now(),a=Math.max(o,n);if(this.storagePrefix="lthb_",this.startCb=e||function(){},this.successCb=t||function(){},"multitab"===this.mode)s=this.startListeningMultiTab;else{if("lasttab"!==this.mode)return;this.setupStorageKeys(),s=this.startListeningLastTab}this.timeout=setTimeout(s.bind(this),a)},t.prototype.startListeningMultiTab=function(){this.startCb(),utils.Bind(document.documentElement,"mouseoff:mousemove",this.mousemoveHandler,!0),utils.Bind(document.documentElement,"mouseoff:mouseleave",this.mouseleaveHandler,!0),this.setupInviteStatusWatching()},t.prototype.setupStorageKeys=function(){var e="safari"===this.br?"onbeforeunload":"unload",t=this.tabKey=sessionStorage.getItem("fsrMouseOff"),s=this.storagePrefix;t&&!function(e){for(var t in localStorage)if(t===s+e)return!0;return!1}(t)||(t=Math.round(1e6*Math.random()),sessionStorage.setItem("fsrMouseOff",t)),localStorage.setItem(s+t,1),utils.Bind(window,"mouseoff:"+e,function(){localStorage.removeItem(s+t)})},t.prototype.startListeningLastTab=function(){var t,s,o,i=this.storagePrefix,e=function(e){e&&e.key&&0!==e.key.indexOf(i)||(o=function(){for(var e in t=0,s=[],localStorage)0===e.indexOf(i)&&(++t,s.push(e));return 1===t}(),this.gstg.get("i")?this.dispose():o&&!this.listening?(this.startCb(),utils.Bind(document.documentElement,"mouseoff:mousemove",this.mousemoveHandler,!0),utils.Bind(document.documentElement,"mouseoff:mouseleave",this.mouseleaveHandler,!0),this.listening=!0):o||(utils.Unbind(document.documentElement,"mouseoff:mousemove",this.mousemoveHandler),utils.Unbind(document.documentElement,"mouseoff:mouseleave",this.mouseleaveHandler),this.listening=!1))}.bind(this);this.setupInviteStatusWatching(),e(),utils.Bind(window,"mouseoff:storage",e)},t.prototype.setupInviteStatusWatching=function(){this.gstg.setUpdateInterval(1e4),this.gstg.watchForChanges(["i"],function(e,t,s){this.gstg.setUpdateInterval(6e4),this.dispose()}.bind(this),!0,!0)},t.prototype.dispose=function(){utils.Unbind("mouseoff:*"),clearTimeout(this.timeout),localStorage.removeItem(this.storagePrefix+this.tabKey)},t});