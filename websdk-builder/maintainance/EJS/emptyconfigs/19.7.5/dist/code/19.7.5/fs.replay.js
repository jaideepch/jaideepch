/***************************************
* @preserve
* ForeSee Web SDK: Replay JavaScript
* Built April 27, 19 21:28:57
* Code version: 19.7.5
* Template version: 19.7.5
***************************************/
_fsDefine(["require","fs",_fsNormalizeUrl("fs.utils.js")],function(t,fs,utils){var a={playbackFrameBorder:2,overlayShadeFadeTime:0,overlayShadeSkipTime:1500};a.pathFSLogo=fs.makeAssetURI("/fslogo.svg"),a.data=["body {","  background-color: #777;","  padding: 0;","  margin: 0;","  width: 100%;","  height: 100vh;","  display: flex;","  justify-content: center;","  align-items: center;","  overflow: hidden;","}","","/************"," * iframe"," ************/","","iframe#playback {","  border: ",a.playbackFrameBorder+"px solid #333;","  background-color: #fff;","  box-shadow: 10px 10px 10px #555;","}","","/************"," * UI"," ************/","",".overlay {","  z-index: 901;","  position: absolute;","}","",".overlay>div>* {","  transition: opacity ",Math.round(a.overlayShadeFadeTime)+"ms ease-in;","}","",".overlay .hidden {","  opacity: 0;","}","",".overlay .center {","  position: absolute;","  top: 50%;","  left: 50%;","  transform: translate(-50%, -50%);","}","","#shade {","  width: 100%;","  height: 100%;","  background-image: url('"+a.pathFSLogo+"');","  background-color: #fff;","  background-repeat: no-repeat;","  background-position: 50% 50%;","  background-size: 30%;","  filter: grayscale(1) brightness(2.5) invert(1);","}","","#shade.pageEnd {","  filter: grayscale(1) brightness(2.5);","}","","#progress {","  height: 5%;","  background-color: #444;","  position: relative;","  top: 90%;","}","","#counter {","  width: 100%;","  height: 100%;","  background-color: #000d;","  color: #fff;","}","","#counter #graph {","  position: absolute;","  width: 16em;","  top: 50%;","  left: 50%;","  transform: translate(-50%, -50%);","  z-index: -1;","}","","#counter #graph circle#c {","  stroke: #7db1ef95;","  cx: 0.5;","  cy: 0.5;","  r: 0.25;","  fill: none;","  stroke-width: 0.5px;","  stroke-dashoffset: 1.57;","  transition: stroke-dashoffset ",Math.round(a.overlayShadeSkipTime)+"ms linear;","  stroke-dasharray: 1.57;","  transform: translate(0%, 100%) rotate(-90deg);","}","","#counter #caption{","  position: absolute;","  top: 50%;","  left: 50%;","  transform: translate(-50%, -50%);","  z-index: -1;",'  font-family: "Helvetica Neue", "Liberation Sans", sans-serif;',"  font-size: 32pt;","}"].join("\n");var h={UNKNOWN:0,DOM_SERIALIZE:1,FRAME_SIZE:3,FRAME_SCROLL:4,MOUSE_MOVE:5,WINDOW_MOUSEOUT_MOUSEENTER:6,INPUT_SERIALIZE:7,FOCUS_BLUR:8,KEY_PRESS:9,CARET_INFO:10,VALUE_CHANGED:11,ATTR_MODIFIED:13,JAVASCRIPT_ERROR:14,MOUSE_CLICK:15,MOUSE_DOWN:16,MOUSE_UP:17,PAGE_MARKER:18,DOC_SIZE:19,SCROLL_EL:20,NOT_RECORDED:22,CSS_SERIALIZE:23,ORIENTATION:24,ZOOM:25,TOUCH:26,SKIPTIME:27,INCOMPLETE_INPUT_CAPTURE:28,ORIENTATION_CHANGE:29,CUSTOM:30,CUSTOM_ERROR:31,PAGE_VISIBLE:32,HEARTBEAT:33,NODE_ADDED:34,NODE_REMOVED:35,INPUT_RESIZE:36,CHAR_DATA:37,DOM_MODIFICATIONS:38,NODE_MOVED:39,PAGE_ERROR:40,ASSET_ERROR:41};function e(){this.elIndex=new Map,this.idIndex=new Map,this.idEl=new Map,this.root=null,this.nextId=1}e.prototype.scan=function(t){var e,i,o=[],s={id:0,p:0,t:t.nodeType,c:o};for(null==this.root&&(this.root=s),e=0,i=t.childNodes.length;e<i;e++)o.push(this.scan(t.childNodes[e]));if(this._track(t,s),null!=t.nodeValue&&(s.v=t.nodeValue),"#"!==t.nodeName[0]){if(s.n=t.nodeName,t.hasAttributes&&t.hasAttributes())for(s.a={},e=0,i=t.attributes.length;e<i;e++)s.a[t.attributes[e].name]=t.attributes[e].value;10===t.nodeType&&(s.publicId&&(s.publicId=t.publicId),s.systemId&&(s.systemId=t.systemId))}for(e=0,i=o.length;e<i;e++)o[e].p=s.id;return s},e.prototype.import=function(t){var e,i;if(null==this.root&&(this.root=t),t.c)for(e=0,i=t.c.length;e<i;e++)this.import(t.c[e]);return this.idIndex.set(t.id,t),t},e.prototype.add=function(t){var e,i,o=t.parentNode,s=this.get(o);return e=this.scan(t),i=Array.prototype.indexOf.call(o.childNodes,t),s.c.splice(i,0,e),e.p=s.id,e},e.prototype.insert=function(t,e){var i=this.getById(e.p);return this.import(e),i.c||(i.c=[]),i.c.splice(t,0,e),e},e.prototype.move=function(t,e,i,o){var s,n=this.get(t),r=this.getById(n.p),a=this.get(e);r.c.splice(r.c.indexOf(n),1),n.p=a.id,i?o?a.c.splice(a.c.indexOf(this.get(o)),0,n):((s=a.c.indexOf(this.get(i))+1)>a.c.length&&(s=a.c.length),s<0&&(s=0),a.c.splice(s,0,n)):a.c.unshift(n)},e.prototype.moveById=function(t,e,i){var o=this.getById(t),s=this.getById(o.p),n=this.getById(e);s.c.splice(s.c.indexOf(o),1),n.c||(n.c=[]),n.c.splice(i,0,o),o.p=n.id},e.prototype.get=function(t){return this.elIndex.get(t)},e.prototype.getById=function(t){return this.idIndex.get(t)},e.prototype.remove=function(t){var e,i,o=this.get(t);for(e=o.c.length-1;0<=e;e--)this.remove(this.idEl.get(o.c[e].id));return this.elIndex.delete(t),this.idIndex.delete(o.id),this.idEl.delete(o.id),(i=this.getById(o.p)).c.splice(i.c.indexOf(o),1),o},e.prototype.removeById=function(t){var e,i=this.getById(t),o=this.getById(i.p);if(i.c)for(e=i.c.length-1;0<=e;e--)this.removeById(i.c[e].id);return this.idIndex.delete(t),o.c.splice(o.c.indexOf(i),1),i},e.prototype._track=function(t,e){var i=this.nextId;return this.nextId++,e.id=i,this.elIndex.set(t,e),this.idIndex.set(i,e),this.idEl.set(i,t),i},e.prototype.dispose=function(){this.elIndex.clear(),this.idIndex.clear(),this.idEl.clear(),this.nextId=1,this.root=null};var i={_animations:[],_clearInactiveAnimations:function(){for(var t=0;t<this._animations.length;t++)!0===this._animations[t].finished&&this._animations.splice(t--,1)},TWEENS:{EASE_IN:function(t,e,i,o){return i*(t/=o)*t+e},EASE_OUT:function(t,e,i,o){return-i*(t/=o)*(t-2)+e},EASE_IN_OUT:function(t,e,i,o){return(t/=o/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e}}};function s(t){var e={tween:i.TWEENS.EASE_IN_OUT,frameCallback:function(){},singleton:{},duration:2e3,frameTime:30,finished:function(){}};this.options=fs.ext(e,t,!1),this.finished=!1,this.paused=!1,this.options.singleton&&(this.options.singleton._animation&&this.options.singleton._animation.stop(),this.options.singleton._animation=this),i._clearInactiveAnimations(),i._animations[i._animations.length]=this}s.prototype.go=function(){var t;this.finished=!1,this.startTime=utils.now(),this.animInterval=setInterval((t=this,function(){t._anim()}),this.options.frameTime)},s.prototype.stop=function(){this.finished=!0,clearInterval(this.animInterval),i._clearInactiveAnimations(),this.options.finished&&this.options.finished.call(this)},s.prototype.pause=function(){this.paused=!0,this.pauseTime=utils.now(),clearInterval(this.animInterval)},s.prototype.resume=function(){var t;!0===this.paused&&(this.paused=!1,this.startTime+=utils.now()-this.paseTime,this.animInterval=setInterval((t=this,function(){t._anim()}),this.options.frameTime))},s.prototype._anim=function(){var t=utils.now()-this.startTime;t>this.options.duration&&(t=this.options.duration);var e=this.options.tween.call(this,t,0,1,this.options.duration);isNaN(e)&&(e=1),1<e?e=1:e<0&&(e=0),this.options.frameCallback.call(this.options.singleton,e,this.options),(1<=e||t>=this.options.duration)&&this.stop()};function o(t){this.root=t,this.tree=new e,this.idEl=new Map,this.loadPromises=[],this.initialLoad=!0}function n(){}o.prototype.import=function(t){if(this.initialLoad=!0,this.tree.import(t),t.a)for(var e in t.a)this.setElAttribute(this.root,e,t.a[e]);this.reconstruct(this.root,t),this.initialLoad=!1},o.prototype.get=function(t){return this.idEl.get(t)},o.prototype.insert=function(t,e){var i,o;if(i=this.tree.getById(e.p)){this.tree.insert(t,e),o=this.createElement(e);var s=this.get(i.id);try{!i.c||t>=i.c.length?s.appendChild(o):s.insertBefore(o,this.get(i.c[t].id))}catch(t){return void console.error("Attempt to insert node into a element that can't contain nodes:",s)}this.reconstruct(o,e)}else console.warn("Attempt to insert node into unknown parent:",e.p)},o.prototype.move=function(t,e,i){var o=this.get(t);if(o){var s=this.get(e);s?(o.parentNode.removeChild(o),i>=s.childNodes.length?s.appendChild(o):s.insertBefore(o,s.childNodes[i]),this.tree.moveById(t,e,i)):console.warn("Attempt to move node to unknown parent node:",e)}else console.warn("Attempt to move unknown node:",t)},o.prototype.remove=function(t){var e=this.get(t),i=this.tree.getById(t);e&&i?(this.forget(i),e.parentNode.removeChild(e),this.tree.removeById(t)):console.warn("Attempt to remove node",t,"which doesn't exist!")},o.prototype.updateCharData=function(t,e){var i=this.get(t),o=this.tree.getById(t);if(o&&i)if(o.v=e,3===i.nodeType&&"STYLE"===i.parentNode.nodeName){var s=i.parentNode.parentNode,n=this.tree.getById(o.p);this.forget(n);var r=i.parentNode,a=this.createElement(n);this.reconstruct(a,n),s.replaceChild(a,r)}else i.nodeValue=e;else console.warn("Attempt to change text of unknown node:",t)},o.prototype.modifyAttr=function(t,e,i){var o=this.get(t),s=this.tree.getById(t);if(s&&o&&o.setAttribute)if(s.a=s.a||{},s.a[e]=i,"style"===e&&s.redact&&(o.style.filter="brightness(0)"),"src"!==e&&"href"!==e||!this.willElementLoad(s))o.setAttribute(e,i);else{var n=o.parentNode;this.forget(s);var r=this.createElement(s);this.reconstruct(r,s),n.replaceChild(r,o)}else console.warn("Attempt to modify attr of unknown node:",t)},o.prototype.waitForLoad=function(){var t=this.loadPromises;return this.loadPromises=[],t.length?Promise.all(t):Promise.resolve()},o.prototype.reconstruct=function(t,e){var i,o;if(this.idEl.set(e.id,t),e.c)for(i=0;i<e.c.length;i++)o=this.createElement(e.c[i]),t.appendChild(o),this.reconstruct(o,e.c[i])},o.prototype.createElement=function(e){var i,t;if(1===e.t){if(this.hasParentSVG(e))i=document.createElementNS("http://www.w3.org/2000/svg",e.n);else if("canvas"===e.n.toLowerCase())i=this.createCanvasPlaceHolder(e);else try{i=document.createElement(e.n.toLowerCase())}catch(t){console.warn("Attempt to create bad element: "+e.n),i=document.createElement("badname")}if(this.willElementLoad(e)&&this.promiseOnLoad(i),e.a)for(t in e.a)this.setElAttribute(i,t,e.a[t]);e.redact&&(i.style.filter="brightness(0)"),"IFRAME"===e.n&&this.markIframeNotRecorded(i)}else if(3===e.t)i=document.createTextNode(e.v);else{if(8!==e.t)throw new Error("Unimplemented type: "+e.t);i=document.createComment(e.v)}return i},o.prototype.markIframeNotRecorded=function(t){(this.loadPromises[this.loadPromises.length-1]||Promise.resolve()).then(function(){t.contentDocument&&(t.contentDocument.body.innerHTML="<div>IFrame Not Recorded</div>",t.contentDocument.body.style.width="100%",t.contentDocument.body.style.height="100vh",t.contentDocument.body.style.display="flex",t.contentDocument.body.style.justifyContent="center",t.contentDocument.body.style.alignItems="center",t.contentDocument.body.style.backgroundColor="#bbb",t.contentDocument.body.style.overflow="hidden",t.contentDocument.body.style.fontSize="24px",t.contentDocument.body.style.margin="0")})},o.prototype.setElAttribute=function(e,i,o){try{e.setAttribute(i,o)}catch(t){var s=document.createElement("div");s.innerHTML="<div "+i+'="'+o+'"></div>';var n=s.childNodes[0].attributes[0].cloneNode();e.setAttributeNode(n)}},o.prototype.createCanvasPlaceHolder=function(t){var e=document.createElement("DIV");e.setAttribute("canvas","");var i=["div[canvas] {","  background-image: linear-gradient(45deg, #808080 25%, transparent 25%), linear-gradient(-45deg, #808080 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #808080 75%), linear-gradient(-45deg, transparent 75%, #808080 75%) !important;","  background-size: 2em 2em !important;","  background-position: 0 0, 0 1em, 1em -1em, -1em 0 !important;","}"].join("\n"),o=this.root.ownerDocument.styleSheets[this.root.ownerDocument.styleSheets.length-1];return o||console.error("No stylesheet found. Canvas",t.id,"will not render correctly.",e),o.insertRule(i,o.cssRules.length),e},o.prototype.hasParentSVG=function(t,e){if(100<e)throw new Error("Detected parent cycle!!");if(!t.p)return!1;var i=this.tree.getById(t.p);return!!i&&(!(!t.n||"SVG"!==t.n.toUpperCase())||this.hasParentSVG(i,(e||0)+1))},o.prototype.willElementLoad=function(t){return!("IMG"!==t.n||!t.a||!t.a.src||0===t.a.src.indexOf("data:"))||(!!("LINK"===t.n&&t.a&&t.a.rel&&-1<t.a.rel.indexOf("stylesheet")&&t.a.href)||("STYLE"===t.n||"IFRAME"===t.n))},o.prototype.promiseOnLoad=function(s){this.loadPromises.push(new Promise(function(t){var e=null,i=function(){e&&clearTimeout(e),s.removeEventListener("load",i,!1),s.removeEventListener("error",o,!1),t()},o=function(t){"LINK"===s.tagName&&"stylesheet"===s.getAttribute("rel")?console.error("FATAL: failed to load stylesheet: "+T.originalUrl(s.getAttribute("href"))):console.warn("Failed to load "+s.tagName+" asset: "+T.originalUrl(s.src||s.href||s.srcset)),i()};s.addEventListener("load",i,!1),s.addEventListener("error",o,!1),e=setTimeout(function(){e=null,o()},"IFRAME"===s.tagName?2e3:45e3),"IFRAME"===s.tagName||this.initialLoad||t()}.bind(this)))},o.prototype.forget=function(t){var e;if(this.idEl.delete(t.id),t.c)for(e=0;e<t.c.length;e++)this.forget(t.c[e])},n.prototype.deserializeInput=function(t,e){var i=e.t.toUpperCase()||"TEXT";"TEXTAREA"===e.n||"INPUT"===e.n&&"SELECT"!==i&&"CHECKBOX"!==i&&"RADIO"!==i?this.deserializeTextBox(t,e):"SELECT"===e.n?e.m?this.deserializeSelectMultiple(t,e):this.deserializeSelectSingle(t,e):"INPUT"!==e.n||"CHECKBOX"!==i&&"RADIO"!==i?console.error("unimplemented input deserialize:",t,e):this.deserializeCheckbox(t,e)},n.prototype.deserializeTextBox=function(t,e){t.value=e.v,!e.cs||0===e.cs&&0===e.ce||this.moveInputCaret(t,{s:e.cs,e:e.ce})},n.prototype.deserializeSelectSingle=function(t,e){t.selectedIndex=e.s},n.prototype.deserializeSelectMultiple=function(t,e){for(var i=0;i<t.length;i++){t.item(i).selected=-1<e.so.indexOf(i)}},n.prototype.deserializeCheckbox=function(t,e){t.checked=e.ch},n.prototype.focusBlurInput=function(t,e){e.v?t.focus&&t.focus():t.blur&&t.blur()},n.prototype.moveInputCaret=function(t,e){"COLOR"!==e.t&&t.setSelectionRange&&t.setSelectionRange(e.s,e.e)},n.prototype.pressKey=function(t,e){var i=t.value||"",o=e.s,s=i.length-(e.e||0);t.value=i.substr(0,o)+(e.v||"")+i.substr(s)};var c=function(){var r=/^(?:(only|not)?\s*([_a-z][_a-z0-9-]*)|(\([^\)]+\)))(?:\s*and\s*(.*))?$/i,a=/^\(\s*(?:-webkit-)?([_a-z-][_a-z0-9-]*)\s*(?:\:\s*([^\)]+))?\s*\)$/,h=/^(?:(min|max)-)?(.+)/,i=/(em|rem|px|cm|mm|in|pt|pc)?\s*$/,o=/(dpi|dpcm|dppx)?\s*$/;function d(t){var e,i=Number(t);return Number.isNaN(i)&&(i=(e=t.match(/^(\d+)\s*\/\s*(\d+)$/))[1]/e[2]),i}function l(t){var e=parseFloat(t);switch(String(t).match(o)[1]){case"dpcm":return e/2.54;case"dppx":return 96*e;default:return e}}function c(t){var e=parseFloat(t);switch(String(t).match(i)[1]){case"em":case"rem":return 16*e;case"cm":return 96*e/2.54;case"mm":return 96*e/2.54/10;case"in":return 96*e;case"pt":return 72*e;case"pc":return 72*e/12;default:return e}}return{matchQuery:function(t,n){return(e=t,e.split(",").map(function(t){var e=(t=t.trim()).match(r);if(!e)throw new SyntaxError('Unable to parse query: "'+t+'"');var i=e[1],o=e[2],s=((e[3]||"")+(e[4]||"")).trim(),n={};if(n.inverse=!!i&&"not"===i.toLowerCase(),n.type=o?o.toLowerCase():"all",!s)return n.expressions=[],n;if(!(s=s.match(/\([^\)]+\)/g)))throw new SyntaxError('Unable to parse expressions: "'+t+'"');return n.expressions=s.map(function(t){var e=t.match(a);if(!e)throw new SyntaxError('Unabled to parse expression: "'+t+'"');var i=e[1].toLowerCase().match(h);return{modifier:i[1],feature:i[2],value:e[2]}}),n})).some(function(t){var e=t.inverse,i="all"===t.type||n.type===t.type;if(i&&e||!i&&!e)return!1;var o=t.expressions.every(function(t){var e=t.feature,i=t.modifier,o=t.value,s=n[e];if(!s)throw new Error("Missing value for "+e);switch(e){case"orientation":case"scan":return s.toLowerCase()===o.toLowerCase();case"width":case"height":case"device-width":case"device-height":o=c(o),s=c(s);break;case"resolution":o=l(o),s=l(s);break;case"aspect-ratio":case"device-aspect-ratio":case"device-pixel-ratio":o=d(o),s=d(s);break;case"grid":case"color":case"color-index":case"monochrome":o=parseInt(o,10)||1,s=parseInt(s,10)||0}switch(i){case"min":return o<=s;case"max":return s<=o;default:return s===o}});return o&&!e||!o&&e});var e}}}(),r={x:4,y:2},d=40,l=40,p="fsrMouseImageIcon",u="data:image/png;base64,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",f="data:image/png;base64,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",m={x:25,y:25},y=50,v=50,g="fsrMouseClickImageIcon",w="data:image/png;base64,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",b={x:25,y:25},E=50,x=50,S="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAAXNSR0IArs4c6QAABKRJREFUaAXtWklrFEEU/qoTjUsEl2jwIO6aiyI5eBBBFAXPCkEIbiCC4I+YPyGCCC4QFMGcBYPLxYNeRBGicYkniTuouMUu33udTlVneqZfzWQmE/HB0NXdr159X1XX8t4b4L+0Vg+YaYNz7Vobfu9ajd/YQDaXA2YZDObTdW7Shv0Fi++A/UD37zAHzzHn7mv09f2ZDgz1ESndbseans1A1ANrNhLIeWGgzA8YOwLEwxgdforS7vGw+k67NiLWGlx+uwWx3UM9vtiZq6dkPyMyt3BkxWMYY0MthRMZGFuH8Wgf4nhlaGMq/Sh6g/b4Jvq7X6r0J5T0REqlCGtO7aXvfEdIAzXrGtzD6NkhlEqxxoaOyIVX82A6D8LGNA+aKCYagf16HcfX/ihqtZjIwOslGJ/fT/Ohq8hYQ95H5j3avw+gf/Wnavajai/BIzGTJBgcdyBjYCxVpK3iO54TS3b2wdpVFXWa9cJiAUxHN7YtfII7d3JXtMojIhO7yXOiWsfw/GRMFSSfyMWx9U1bnSoAy33MKyYv/znSXvZMNrv3tMyqVr2y6oiiRfRd99BGyTv9UvotSpTMF3r2ke5HaOMbpn2I7msQ3sOsPTd10yxftS6NbUWMA8FNmKiTGthNYLcR2PyRnjRqqJfsQwJzmzrs6+RjbSHCII52P/LVsw3y2UmOHb6KomyiTUTiNGn2FpNge0K0V+pw3VBhjIzVkywROQAGnp2M2U6ADpHNDs+uttghddlGkBBGweoqZYnwKTZEZCSwn6qUf6J6O4YWlv0IHpksVkeE/Qk5iisRJHOC51I9JNLGiIw9QGQ60weFV8bKmCfEEWGnKMSfkIld0+eUtj31yp8ZLRZaId9HMCf6HhHx7HRWeImV1UmnrteiFU9sK2sk3qgoOyLinioNyD5RtMQqbWXUyKbYzjysdkMudSIeEfKx1cKbXaMkxLbD7IhIoEALjnfsRkmAbQ+zIzIZ7dAATI8dGt1QnRDbaYSGwh+hzbSqvkeE4k5q4QNgoyTEtsPsiEjwTAuOT7GNkgDbHmZHJIkAKtFxUK1REmJbopYCxCNCYUytsD8BPopPt5BNsa22O4nZEeFYrFbEKSJ/YtqFbIY4XB5mjwgFlEGxWK2wUwT81Kor9H6Ko6VQTFQIKwfBJ8QR4ai4BJTTVwVX9uyMGSSt3KhGQe2pr63YCvEWGasXyXdExDRFxUPExs/oEH+DqtRDhkiQDbYVJFmsWSIc2gdFxUPE2vvUm1epSi2fGX9OV+n4fj+kScEoWF2tcqdolgYfyokk4aCTNacNGh0O4rTDka6ycFAmEiEDxUmWi2NDVD7sBi6glCyfD2j46ecLT6OJqRTXMaU4d5KTCMrOkbTdY90vaALeS29b5sqYKiSA8okwck6ycH6iVYSxMKYKUj5HfEUO5UcLT0ho33/e7DLnSOJv56slfCqPCIPlTBEnWdjQTEma6CnIWlUfkRT8LEi9VR+RlAj3xuiZK01dACQZSm0WjEQKUTciqTZfOXdior017zO+rbwy7xM2HgKvnAESToSN/xN/GPB7adb/hcMnk5Zn+E81KYz/11bpgb9S4bOsoPgKAwAAAABJRU5ErkJggg==";function A(t,e,i){t.onUpdate.subscribe(this.onViewportUpdate.bind(this),!1,!0),this.iframe=i,this.win=e,this.doc=e.document,this.paused=!1,this.visible=!1,this.previousHoverEl=null,this.previousDEBounds=null,this.viewScale=1,this.frameScale=1,this.touchPts=[],this.clickEls=[],this.touchEls=[],this.hoveredEls=[],this.setupMouseEl(),this.setPos(0,0)}function P(t){return t*t*t}function C(t){return 3*t*t*(1-t)}function I(t){return 3*t*(1-t)*(1-t)}function O(t){return(1-t)*(1-t)*(1-t)}A.prototype.dispose=function(){function t(t){t.parentNode.removeChild(t)}t(this.el),this.clickEls.forEach(t),this.touchEls.forEach(t),this.previousHoverEl=null},A.prototype.setVisible=function(t){void 0!==t&&(this.visible=t);var e=this.visible?"visible":"hidden";this.el.style.visibility!==e&&(this.el.style.visibility=e,this.visible&&this.updateMousePos())},A.prototype.transformCoord=function(t){var e,i=t.x,o=t.y,s=this.iframe.getBoundingClientRect();e=this.iframe.contentDocument.documentElement?this.iframe.contentDocument.documentElement.getBoundingClientRect():this.previousDEBounds,i+=(this.previousDEBounds=e).left/this.viewScale,o+=e.top/this.viewScale,i*=this.viewScale,o*=this.viewScale,i+=a.playbackFrameBorder,o+=a.playbackFrameBorder;var n=s.width,r=s.height;return i-=n/this.frameScale/2,o-=r/this.frameScale/2,i*=this.frameScale,o*=this.frameScale,i+=n/2,o+=r/2,i+=s.left,o+=s.top,{x:i-=this.bodyXOffset,y:o}},A.prototype.setPos=function(t,e,i){this.pos={x:t,y:e},this.updateMousePos(),this.handleHovering(),i&&0<i.distance&&this.animate(i)},A.prototype.updateMousePos=function(){if(this.visible){var t=this.transformCoord(this.pos);this.el.style.transform="translate("+(t.x-r.x)+"px,"+(t.y-r.y)+"px)"}},A.prototype.click=function(i){var t=this.transformCoord(i),o=this.doc.createElement("img");o.style.position="absolute",o.style.width=y+"px",o.style.height=v+"px",o.style.top="0px",o.style.left="0px",o.style.zIndex="999999900",o.style.transform="translate("+(t.x-m.x)+"px,"+(t.y-m.y)+"px)",o.setAttribute("id",g),o.setAttribute("src",w),this.clickEls.push(o),this.doc.body.appendChild(o),new s({singleton:o,duration:600,finished:function(){this.clickEls.splice(this.clickEls.indexOf(o),1),o.parentNode&&o.parentNode.removeChild(o)}.bind(this),frameCallback:function(t){t=1-t,o.style.opacity=t,o.style.filter="alpha(opacity="+Math.round(100*t)+")";var e=this.transformCoord(i);o.style.transform="translate("+(e.x-m.x)+"px,"+(e.y-m.y)+"px)"}.bind(this)}).go()},A.prototype.mouseDown=function(){this.el.setAttribute("src",f)},A.prototype.mouseUp=function(){this.el.setAttribute("src",u)},A.prototype.onViewportUpdate=function(t){this.bodyXOffset=t.bodyXOffset,this.viewScale=t.viewScale,this.frameScale=t.frameScale,this.touchPts.length&&this.touchUpdate(this.touchPts),this.updateMousePos()},A.prototype.touchUpdate=function(t){this.updateTouchPts(t);for(var e=0;e<this.touchEls.length;e++){var i=this.transformCoord(this.touchPts[e]);this.touchEls[e].style.transform="translate("+(i.x-b.x)+"px,"+(i.y-b.y)+"px)"}},A.prototype.touchEnd=function(){for(var t=0;t<this.touchPts.length;t++)this.click(this.touchPts[t]);this.updateTouchPts([])},A.prototype.updateTouchPts=function(t){for(this.touchPts=t;this.touchEls.length<t.length;)this.setupTouchEl();for(;this.touchEls.length>t.length;)this.touchEls[0].parentNode.removeChild(this.touchEls[0]),this.touchEls.shift()},A.prototype.handleHovering=function(){var e;if(this.visible){this.el.style.display="none";var t=utils.getScroll(this.iframe.contentWindow),i=this.pos.x-t.x,o=this.pos.y-t.y;if((e=this.iframe.contentDocument.elementFromPoint(i,o))&&"IFRAME"===e.tagName)try{utils.getScroll(e.contentWindow);var s=e.getBoundingClientRect(),n=i-Math.round(s.x),r=o-Math.round(s.y);e=e.contentDocument.elementFromPoint(n,r)}catch(t){e=null}e?this.previousHoverEl!==e&&(this.removeHoverState(),this.previousHoverEl=e,this.applyHoverState(e)):this.previousHoverEl&&(this.removeHoverState(),this.previousHoverEl=null),this.el.style.display="block"}},A.prototype.applyHoverState=function(t){t.setAttribute("fsrhover","true"),this.hoveredEls.push(t),t.parentElement&&"BODY"!==t.tagName&&this.applyHoverState(t.parentElement)},A.prototype.removeHoverState=function(){this.hoveredEls.forEach(function(t){t.removeAttribute("fsrhover")}.bind(this)),this.hoveredEls=[]},A.prototype.animate=function(i,o){this.win.requestAnimationFrame(function(t){var e=t-(o=o||t);e>=i.timeTillNext?this.setPos(i.end.x,i.end.y):(this.playFrame(i,e),this.animate(i,o))}.bind(this))},A.prototype.playFrame=function(t,e){isNaN(t.ctp1.x)&&(t.ctp1=t.ctp2);var i,o,s,n,r,a,h=e/t.timeTillNext,d=(i=h,o=t.start,s=t.ctp1,n=t.ctp2,r=t.end,(a={x:0,y:0}).x=o.x*O(i)+s.x*I(i)+n.x*C(i)+r.x*P(i),a.y=o.y*O(i)+s.y*I(i)+n.y*C(i)+r.y*P(i),a);this.setPos(Math.round(d.x),Math.round(d.y))},A.prototype.setupMouseEl=function(){this.el=this.doc.createElement("img"),this.el.style.position="absolute",this.el.style.width=d+"px",this.el.style.height=l+"px",this.el.style.top="0px",this.el.style.left="0px",this.el.style.zIndex=900,this.el.setAttribute("id",p),this.el.setAttribute("src",u),this.setVisible(),this.doc.body.appendChild(this.el)},A.prototype.setupTouchEl=function(){var t=this.doc.createElement("img");t.style.position="absolute",t.style.width=E+"px",t.style.height=x+"px",t.style.top="0px",t.style.left="0px",t.style.zIndex="999999900",t.style.transform="translate(-100px,-100px)",t.setAttribute("src",S),this.touchEls.push(t),this.doc.body.appendChild(t)};function T(){this.onProgress=new utils.FSEvent,this.failedCSSLoad=!1}function k(t,e){this.window=e,this.iframeEl=t,this.domreplay=new o(e.document.documentElement),this.keyboard=new n(this.domreplay),this.viewportSize={},this.scrollPos=utils.getScroll(e),this.handlers={},this.handlers[h.NODE_ADDED]=this.addNode.bind(this),this.handlers[h.NODE_MOVED]=this.moveNode.bind(this),this.handlers[h.NODE_REMOVED]=this.removeNode.bind(this),this.handlers[h.CHAR_DATA]=this.updateCharData.bind(this),this.handlers[h.ATTR_MODIFIED]=this.modifyAttr.bind(this),this.handlers[h.INPUT_SERIALIZE]=this.deserializeInput.bind(this),this.handlers[h.FOCUS_BLUR]=this.focusBlurInput.bind(this),this.handlers[h.CARET_INFO]=this.moveInputCaret.bind(this),this.handlers[h.KEY_PRESS]=this.pressKey.bind(this),this.handlers[h.DOC_SIZE]=this.resizeDoc.bind(this),this.handlers[h.FRAME_SIZE]=this.resizeFrame.bind(this),this.handlers[h.FRAME_SCROLL]=this.scrollFrame.bind(this),this.handlers[h.SCROLL_EL]=this.scrollElement.bind(this)}T.originalUrl=function(e){try{var t=e.split("?")[1].split("&"),i=t.find(function(t){return 0===t.indexOf("url=")}).split("=")[1],o=t.find(function(t){return 0===t.indexOf("context=")}).split("=")[1],s=atob(decodeURIComponent(i)),n=atob(decodeURIComponent(o));return new URL(s,n).href}catch(t){return e}},T.prototype.preloadAll=function(t){var e=Date.now();console.log("Starting asset preload...");var i=[];t.forEach(function(t){i=i.concat(this.domScan(t.initialDOM,t.events))}.bind(this));var o=new Set;i=i.filter(function(t){return!o.has(t.url)&&(o.add(t.url),!0)});var s=this.dedupeList(i.filter(this.isStylesheet)).filter(this.hasNoDeviceMediaQuery);return this.fetchCSS(s,i).then(function(){return i=this.dedupeList(i),console.log("Complete asset list:",i),i=i.filter(function(t){return"css-url"!==t.key&&this.hasNoDeviceMediaQuery(t)}.bind(this)),console.log("Preloading",i.length,"assets:",i),this.addPreloadLinks(i).then(function(){console.log("Asset preload finished in",Date.now()-e,"ms"),this.onProgress.unsubscribeAll()}.bind(this))}.bind(this))},T.prototype.fetchCSS=function(t,o){return console.log("Fetching "+t.length+" css assets..."),Promise.all(t.map(function(e){return fetch(e.url,{cache:"force-cache"}).then(function(t){return t.ok?t.text().then(function(t){var e=[];this.cssScan(t,e,"css-url");var i=(e=e.filter(function(t){return o.indexOf(t)<0&&(o.push(t),!0)})).filter(function(t){return"@import"===t.key});if(0<i.length)return this.fetchCSS(i,o)}.bind(this)):(e.failed||(this.failedCSSLoad=!0,console.error("FATAL: stylesheet preload failed: "+T.originalUrl(e.url),e)),null)}.bind(this))}.bind(this)))},T.prototype.addPreloadLinks=function(h){return h&&h.length?new Promise(function(r){var a=h.length;h.forEach(function(t){var e;if(this.isStylesheet(t)?e="style":this.isImage(t)?e="image":"@font-face"===t.key&&(e="font"),!e)return"href"===t.key&&t.node&&"LINK"===t.node.n||console.warn("Unable to determine type of this asset so not preloading it:",t),void a--;var i=document.createElement("link"),o=setTimeout(function(){console.error("FATAL Timed out preloading: "+T.originalUrl(t.url),t),n()}.bind(this),18e4),s=function(){this.isImage(t)?"css-url"!==t.key&&console.warn("Unable to preload: "+T.originalUrl(t.url),t):console.error("Error preloading: "+T.originalUrl(t.url),t),n()}.bind(this),n=function(){i.removeEventListener("load",n,!1),i.removeEventListener("error",s,!1),clearTimeout(o),a--,this.onProgress.fire(100*(h.length-a)/h.length),a<=0&&r()}.bind(this);i.addEventListener("load",n,!1),i.addEventListener("error",s,!1),i.setAttribute("rel","preload"),"font"===e&&i.setAttribute("crossorigin","anonymous"),i.setAttribute("as",e),i.setAttribute("href",t.url),document.head.appendChild(i)}.bind(this))}.bind(this)):Promise.resolve()},T.prototype.cssScan=function(t,o,e){var s=(t.match(/url\s*\(\s*['"]?\/replay\/proxy\?[^\)]+\)/g)||[]).map(function(t){return"/replay/proxy"+t.split("/replay/proxy")[1].replace(/['"]?\s*\)$/,"")});(t.match(/@import\s*[^;]+;/g)||[]).forEach(function(t){var e=t.match(/(\/replay\/proxy\?[^"')]+)["')]/);if(e){var i=e[1];s=s.filter(function(t){return t!==i}),o.push({url:i,key:"@import"})}}),(t.match(/@font-face\s*{[^}]+}/g)||[]).forEach(function(t){var e=(t.match(/url\s*\(\s*['"]?\/replay\/proxy\?[^\)]+\)/g)||[]).map(function(t){return"/replay/proxy"+t.split("/replay/proxy")[1].replace(/['"]?\s*\)$/,"")});s=s.filter(function(t){return e.indexOf(t)<0});var i=t.match(/url\s*\(\s*['"]?(\/replay\/proxy\?[^\)'"]+)['"]?\s*\)\s*format\(['"](woff2|woff|truetype)['"]\)/);i||(i=[0,e[0]]),i[1]&&o.push({url:i[1],key:"@font-face"})}),s.forEach(function(t){o.push({url:t,key:e})})},T.prototype.domScan=function(t,e){var n=this;function r(t,e){if(t.a){for(var i in t.a)t.a[i]&&0===t.a[i].indexOf("/replay/proxy?")&&e.push({url:t.a[i],key:i,node:t});t.a.style&&n.cssScan(t.a.style,e,"style-url")}if("STYLE"===t.n&&t.c){var o=t.c.map(function(t){return t.v||""}).join("");n.cssScan(o,e,n.hasNoDeviceMediaQuery(t)?"css-url":"style-url")}if(t.c)for(var s=0;s<t.c.length;s++)r(t.c[s],e)}var a=[];return t&&r(t,a),e.forEach(function(t){if(t.e===h.PAGE_MARKER&&t.d.doc)r(t.d.doc,a);else if(t.e===h.DOM_MODIFICATIONS)for(var e=0;e<t.d.length;e++){var i=t.d[e];if(i.e===h.NODE_ADDED)r(i.d.tree,a);else if(i.e===h.ATTR_MODIFIED)if("style"===i.d.attr&&i.d.val)this.cssScan(i.d.val,a,"style-url");else if(i.d.val&&0===i.d.val.indexOf("/replay/proxy?")){var o={};i.d.r&&(o.rel=i.d.r),o[i.d.attr]=i.d.val,a.push({url:i.d.val,key:i.d.attr,node:{id:i.d.id,n:i.d.tn,a:o}})}}else if(t.e===h.ASSET_ERROR&&t.d.a){var s=t.d.a.src||t.d.a.href||t.d.a.srcset,n=encodeURIComponent(btoa(s));a.forEach(function(t){(-1<t.url.indexOf(n)||-1<t.url.indexOf(s))&&(t.failed=!0)})}}.bind(this)),a},T.prototype.dedupeList=function(t){var e=new Set;return t.filter(function(t){return!e.has(t.url)&&(e.add(t.url),!0)})},T.prototype.isStylesheet=function(t){return"@import"===t.key||"href"===t.key&&"LINK"===t.node.n&&t.node.a&&"stylesheet"===t.node.a.rel},T.prototype.isImage=function(t){return"css-url"===t.key||"style-url"===t.key||"src"===t.key&&"IMG"===t.node.n||"srcset"===t.key&&"SOURCE"===t.node.n||"src"===t.key&&"INPUT"===t.node.n||"src"===t.key&&!t.node.n},T.prototype.hasNoDeviceMediaQuery=function(t){var e=t.node;if(!e)return!0;if(!e.a)return!0;if(!e.a.media)return!0;var i=e.a.media;return i.indexOf("width")<0&&i.indexOf("height")<0},k.prototype.getElement=function(t){return this.domreplay.get(t)},k.prototype.dispatch=function(t){var e=this.handlers[t.e];return e?e(t)||Promise.resolve():(console.error("Unhandled event type:",t),Promise.resolve())},k.prototype.load=function(t,e){return this.scrollPos=e,t?(this.domreplay.import(t),this.fixScrollPosAfter(this.domreplay.waitForLoad())):this.showPageNotRecorded()},k.prototype.showPageNotRecorded=function(){var t=document.createElement("body");return t.innerHTML="<div>Page Not Recorded</div>",t.style.width="100%",t.style.height="100vh",t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",t.style.backgroundColor="#fff",t.style.color="#555",t.style.overflow="hidden",t.style.fontSize="24px",t.style.margin="0",this.window.document.documentElement.appendChild(t),Promise.resolve()},k.prototype.setScrollPos=function(t){t||(t=this.scrollPos);var e=utils.getScroll(this.window);e.x===t.x&&e.y===t.y||(utils.setScroll(this.window,t.x,t.y),this.scrollPos=fs.ext({},t))},k.prototype.fixScrollPosAfter=function(t){return t.then(function(){this.setScrollPos()}.bind(this))},k.prototype.addNode=function(t){if(t.d.tree){try{this.domreplay.insert(t.d.idx,t.d.tree)}catch(t){console.error(t)}return this.fixScrollPosAfter(this.domreplay.waitForLoad())}console.error("Attempt to add null node:",t)},k.prototype.moveNode=function(t){return this.domreplay.move(t.d.id,t.d.p,t.d.idx),this.fixScrollPosAfter(this.domreplay.waitForLoad())},k.prototype.removeNode=function(t){return this.domreplay.remove(t.d.id),this.fixScrollPosAfter(this.domreplay.waitForLoad())},k.prototype.updateCharData=function(t){return this.domreplay.updateCharData(t.d.id,t.d.v),this.fixScrollPosAfter(this.domreplay.waitForLoad())},k.prototype.modifyAttr=function(t){return this.domreplay.modifyAttr(t.d.id,t.d.attr,t.d.val),this.fixScrollPosAfter(this.domreplay.waitForLoad())},k.prototype.scrollFrame=function(t){this.setScrollPos(t.p)},k.prototype.scrollElement=function(t){var e=this.domreplay.get(t.d.id);e?(e.scrollLeft=t.d.x,e.scrollTop=t.d.y):console.error("scrollElement on unknown element",t.d.id)},k.prototype.resizeFrame=function(t){this.iframeEl&&(this.iframeEl.width=t.d.w,this.iframeEl.height=t.d.h)},k.prototype.resizeDoc=function(t){},k.prototype.deserializeInput=function(t){var e=this.domreplay.get(t.d.id);e?this.keyboard.deserializeInput(e,t.d):console.error("deserializeInput on unknown element",t.d.id)},k.prototype.focusBlurInput=function(t){var e=this.domreplay.get(t.d.id);e?this.keyboard.focusBlurInput(e,t.d):console.error("focusBlurInput on unknown element",t.d.id)},k.prototype.moveInputCaret=function(t){var e=this.domreplay.get(t.d.id);e?this.keyboard.moveInputCaret(e,t.d):console.error("moveInputCaret on unknown element",t.d.id)},k.prototype.pressKey=function(t){var e=this.domreplay.get(t.d.id);e?this.keyboard.pressKey(e,t.d):console.error("pressKey on unknown element",t.d.id)};var M=function(t){this.elParent=t};(M.prototype=Object.assign(M.prototype,{el:null,elParent:null}))._initDOM=function(){var t=this.el;return t||((t=window.document.createElement("div")).id="shade"),t.classList.add("hidden"),t.classList.add("center"),t.classList.remove("pageEnd"),this.el||(this.el=this.elParent.appendChild(t)),this.el},M.prototype.show=function(){this._initDOM().classList.remove("hidden")},M.prototype.hide=function(){this._initDOM().classList.add("hidden")},M.prototype.showEnd=function(){this._initDOM(),this.el.classList.remove("hidden"),this.el.classList.add("pageEnd")},M.prototype.hideEnd=M.prototype.hide;var R=function(t){this.shade=t};function D(t){this.mobile=!1,this.disablePositionFixedFix=t.disablePositionFixedFix||!1,t.onUpdate.subscribe(this._onViewportUpdate.bind(this),!1,!0),this.fixedHoverRules=new Set,this.fixedPositionRules=new Set,this.fixedMediaQueries=new Set,this.originalMediaQueries=new Map,this.fixedPositionInfo=[],this.fixedPositionEls=[],this.fixedPositionComputeStyleSlowCount=0,this.fixedPositionMovingSlowCount=0,this.lastFixedMoveDisable=Date.now(),this.badgeCssFound=!1,this.badgeCssPatched=!1}(R.prototype=Object.assign(R.prototype,{el:null,shade:null,shown:!1}))._initDOM=function(){return this.el||(this.el=window.document.createElement("div"),this.el.id="progress"),this.update(0),this.el},R.prototype.show=function(){this.shown||(this.shown=!0,this.shade.el.appendChild(this._initDOM()))},R.prototype.hide=function(){this.shown&&(this.shown=!1,this.shade.el.removeChild(this.el))},R.prototype.update=function(t){this.el.style="width: "+t+"%"},U.prototype.fixUndefinedInPage=function(){var t=document.body.childNodes[0];t&&-1<t.textContent.indexOf("undefined")&&document.body.removeChild(t)},U.prototype.setupClickHandler=function(){var t=function(t){"fsrVideoDownloadLink"!==t.target.id&&(t.preventDefault(),t.stopPropagation(),this.player.loaded&&(this.player.playbackFinished?this.player.advancePage():this.player.paused?(this.player.videoSyncUp(),this.notify("Resuming playback. Left-click to pause."),this.player.resume()):(this.player.videoSyncUp(),this.notify("Pausing playback. Left-click to resume."),this.player.pause())))}.bind(this);utils.Unbind("ui:*"),utils.Bind(document.body,"ui:click",t),utils.Bind(this.iframe.contentWindow.document,"ui:click",t)},U.prototype.setupPageTitle=function(){var t=document.getElementsByTagName("title")[0];t||(t=document.createElement("title"),document.head.appendChild(t))},U.prototype.updatePageTitle=function(t){document.getElementsByTagName("title")[0].innerText="Replay "+t.session_id.substr(0,5)+" Page "+t.page_number},U.prototype.setupPageStyles=function(){var t=window.document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("as","image"),t.setAttribute("href",a.pathFSLogo),document.head.appendChild(t);var e=document.createElement("style");e.appendChild(document.createTextNode(a.data)),document.head.appendChild(e)},U.prototype.setupOverlay=function(){this.overlay=new L,this.overlay.init({width:this.iframe.width,height:this.iframe.height,transform:this.iframe.style.transform}),this.shade=new M(this.overlay.elContainer),this.progress=new R(this.shade),this.counter=new N(this.overlay.elContainer)},D.prototype.updatedDOM=function(t){this._fixCSS(t),this._updateFixedPositionElements(t),this.badgeCssFound&&(this.badgeCssPatched=!0)},D.prototype._fixCSS=function(t,e){var i,o=t.styleSheets;for(i=0;i<o.length;i++)o[i].disabled||this._recurseRules(t,o[i],e)},D.prototype._safeToUse=function(e){try{if(e.cssRules)return!0}catch(t){console.error("Failed to access CSS:",t,e),console.error("Ensure you are loading the replay over https!!")}return!1},D.prototype._recurseRules=function(t,e,i){if(this._safeToUse(e)){var o,s=e.cssRules;for(o=0;o<s.length;o++)s[o].cssRules?s[o].type===CSSRule.MEDIA_RULE?(this._fixDeviceMediaRule(t,s[o]),t.defaultView.matchMedia(s[o].conditionText).matches&&this._recurseRules(t,s[o])):s[o].type!==CSSRule.KEYFRAMES_RULE&&this._recurseRules(t,s[o]):i||(this._replaceHoverStyles(t,s[o],e,o),this._replaceFixedPositionRules(t,s[o],e,o),this._fixHiddenDocumentElement(t,s[o],e,o),this.badgeCssPatched||this._removeBadgeImportant(t,s[o],e,o))}},D.prototype._fixDeviceMediaRule=function(t,e){if(!this.fixedMediaQueries.has(e)&&(this.fixedMediaQueries.add(e),e.conditionText.match(/device|width|height|orientation|resolution|pixel-ratio/))){var i,o=e.conditionText;this.originalMediaQueries.has(e)?o=(i=this.originalMediaQueries.get(e)).cond:this.originalMediaQueries.set(e,{cond:o,list:Array.prototype.slice.call(e.media,0)});try{var s=this.viewportParams,n=s.vw>s.vh,r=n?s.dh:s.dw,a=n?s.dw:s.dh,h=Math.max(r,a)/Math.min(r,a),d=c.matchQuery(o,{type:"screen",width:s.lw+"px",height:s.lh+"px","device-width":r+"px","device-height":a+"px","device-aspect-ratio":h,"aspect-ratio":h,"device-pixel-ratio":t.defaultView.devicePixelRatio,"pixel-ratio":t.defaultView.devicePixelRatio,"device-resolution":"150dpi",resolution:"150dpi",orientation:n?"landscape":"portrait"});if(d&&!t.defaultView.matchMedia(o).matches)console.warn("Modifying to enable:",e),e.conditionText!==o+", all"&&e.media.appendMedium("all");else if(!d&&t.defaultView.matchMedia(o).matches){if(console.warn("Modifying to disable:",e),"not all"!==e.conditionText){for(;0<e.media.length;)e.media.deleteMedium(e.media[0]);e.media.appendMedium("not all")}}else if(i&&o!==e.conditionText){for(;0<e.media.length;)e.media.deleteMedium(e.media[0]);for(var l=0;l<i.list.length;l++)e.media.appendMedium(i.list[l]);console.warn("Restoring original:",e)}}catch(t){console.error("Unable to parse media query:",o,t)}}},D.prototype._updateFixedPositionElements=function(t){var e,i,o,s,n=performance.now(),r=!1,a=Date.now();function h(e){return function(t){return t.el===e}}for(e=0;e<this.fixedPositionInfo.length;e++){var d=this.fixedPositionInfo[e];if(d.doc===t){var l=t.querySelectorAll(d.rule.selectorText);for(i=0;i<l.length;i++){o=l[i];var c=this.fixedPositionEls.find(h(o));c||(c={enabled:!1,doc:t,el:o,origStyles:{left:o.style.left,top:o.style.top,bottom:o.style.bottom,right:o.style.right,width:o.style.width,height:o.style.height}},this.fixedPositionEls.push(c)),c.lastUpdate=a,(this.fixedPositionComputeStyleSlowCount<1||!c.style)&&(c.style=t.defaultView.getComputedStyle(o,null),this._calculateFixedAnchor(c));var p=c.enabled;c.enabled=this._fixedPositionVisible(c),!p&&c.enabled&&(r=!0)}}}for(i=0;i<this.fixedPositionEls.length;i++)if(this.fixedPositionEls[i].doc===t&&this.fixedPositionEls[i].lastUpdate!==a){if(o=this.fixedPositionEls[i].el,s=this.fixedPositionEls[i].origStyles,this.fixedPositionEls[i].doc.documentElement.contains(o)){for(var u=["top","left","bottom","right","width","height"],f=0;f<u.length;f++){var m=u[f];s[m]?o.style[m]=s[m]:o.style.removeProperty(m)}console.log("Reset fixed position element:",o,s)}this.fixedPositionEls.splice(i,1),i--}var y=performance.now()-n;30<y&&(this.fixedPositionComputeStyleSlowCount++,console.warn("Fixed position computed style calculation took",y,"ms")),r&&this.viewportParams&&this._onViewportUpdate(this.viewportParams)},D.prototype._fixedPositionVisible=function(t){return!(t.left&&t.left.factor<0)&&(!(t.top&&t.top.factor<0)&&(!(t.right&&t.right.factor<0)&&(!(t.bottom&&t.bottom.factor<0)&&("none"!==t.style.display&&"hidden"!==t.style.visibility&&"0"!==t.style.opacity))))},D.prototype._calculateFixedAnchor=function(n){Object.keys(n.origStyles).forEach(function(t){var e=n.origStyles[t];""!==e?n.el.style[t]=e:""!==n.el.style[t]&&n.el.style.removeProperty(t)});var r=this._allMatchedRules(n.el).concat([n.el]);r.reverse();var a=/^(-?[\d\.]+)(%|vh|vw)$/i,h=/^(-?[\d\.]+)(px|rem|em|%|vh|vw|)$/i;["top","left","bottom","right"].forEach(function(e){if(!r.find(function(t){return"important"===t.style.getPropertyPriority(e)&&"auto"===t.style[e]})){var t=r.find(function(t){return null!=t.style[e]&&""!==t.style[e]});if(t&&"auto"!==t.style[e]){var i=t.style[e].match(a);if(i)n[e]={offset:0,factor:+i[1]/100};else if(i=n.style[e].match(h)){var o=+i[1];switch(i[2]){case"":case"px":n[e]={offset:o,factor:0};break;case"em":case"rem":var s=+getComputedStyle(n.doc.documentElement).fontSize;n[e]={offset:s*o,factor:0}}}}}}),["width","height"].forEach(function(e){var t=r.find(function(t){return null!=t.style[e]&&""!==t.style[e]&&"auto"!==t.style[e]&&t.style[e].match(a)});if(t){var i=t.style[e].match(a);i&&(n[e]=+i[1]/100)}}),n.top&&0===n.top.offset&&n.left&&0===n.left.offset&&n.bottom&&0===n.bottom.offset&&n.right&&0===n.right.offset&&(delete n.bottom,delete n.right,n.width||(n.width=1),n.height||(n.height=1)),n.top||n.left||n.bottom||n.right||(n.top={offset:0,factor:0},n.left={offset:0,factor:0})},D.prototype._replaceHoverStyles=function(t,e,i,o){if(e.selectorText){var s=e.selectorText.replace(/:hover\b/gi,'[fsrhover="true"]');if(s!==e.selectorText&&!this.fixedHoverRules.has(e)){this.fixedHoverRules.add(e);try{e.selectorText=s}catch(t){}if(e.selectorText.indexOf(s)<0){var n=e.cssText.replace(e.selectorText,s);try{i.insertRule(n,o),i.deleteRule(o+1)}catch(t){}}}}},D.prototype._replaceFixedPositionRules=function(t,e){if(!this.disablePositionFixedFix&&!this._positionFixedFixUnnecessary(t)&&e.style&&"fixed"===e.style.position&&!this.fixedPositionRules.has(e)){this.fixedPositionRules.add(e);var i={enabled:!1,rule:e,doc:t};this.fixedPositionInfo.push(i)}},D.prototype._positionFixedFixUnnecessary=function(t){var e=t.body.computedStyleMap(),i=e&&e.get("height");return this.disablePositionFixedFix=i&&("percent"===i.unit||"vh"===i.unit)&&50<i.value,this.disablePositionFixedFix&&console.log("Position fixed unnecessary on this page! YAY!"),this.disablePositionFixedFix},D.prototype._fixHiddenDocumentElement=function(t,e,i,o){"html"===e.selectorText&&("none"===e.style.display&&(e.style.removeProperty("display"),console.warn("Removing iframe display:none security fix")),"hidden"===e.style.visibility&&(e.style.removeProperty("visibility"),console.warn("Removing iframe visibility:hidden security fix")))},D.prototype._removeBadgeImportant=function(t,e,i,o){switch(e.selectorText){case"._acsbadge--default":this.badgeCssFound=!0,e.style.removeProperty("top"),e.style.removeProperty("left");break;case"._acsbottomright._acsbadge--default":this.badgeCssFound=!0,e.style.removeProperty("top"),e.style.removeProperty("left"),e.style.removeProperty("right"),e.style.right="0px";break;case"._acsbottomleft._acsbadge--default":this.badgeCssFound=!0,e.style.removeProperty("top"),e.style.removeProperty("right"),e.style.left="0px";break;case"._acstopright._acsbadge--default":this.badgeCssFound=!0,e.style.removeProperty("bottom"),e.style.removeProperty("left"),e.style.removeProperty("right"),e.style.right="0px";break;case"._acstopleft._acsbadge--default":this.badgeCssFound=!0,e.style.removeProperty("bottom"),e.style.removeProperty("right"),e.style.left="0px";break;case"._acsmiddleleft._acsbadge--default":this.badgeCssFound=!0,e.style.removeProperty("right"),e.style.removeProperty("top"),e.style.left="0px",e.style.top="48%";break;case"._acsmiddleleft._acsVertical_left._acsbadge--default":this.badgeCssFound=!0,e.style.removeProperty("top"),e.style.top="50%";break;case"._acsmiddleright._acsbadge--default":this.badgeCssFound=!0,e.style.removeProperty("left"),e.style.removeProperty("right"),e.style.removeProperty("top"),e.style.top="48%",e.style.right="0px";break;case"._acsmiddleright._acsVertical_right._acsbadge--default":this.badgeCssFound=!0,e.style.removeProperty("top"),e.style.top="30%";break;case"._acsAnimate._acsbadge--default":this.badgeCssFound=!0,e.style["transition-duration"]="0ms"}},D.prototype._onViewportUpdate=function(t,e){var i=this.viewportParams&&(t.lw!==this.viewportParams.lw||t.lh!==this.viewportParams.lh);if(this.viewportParams=t,2e4<Date.now()-this.lastFixedMoveDisable&&(this.fixedPositionMovingSlowCount=0),3<this.fixedPositionMovingSlowCount)this.lastFixedMoveDisable=Date.now();else{for(var o=performance.now(),s=0;s<this.fixedPositionEls.length;s++)this._moveFixedPositionElement(this.fixedPositionEls[s],t);var n=performance.now()-o;15<n&&(console.warn("Moving fixed position elements took",n,"ms!"),this.fixedPositionMovingSlowCount++),i&&(this.fixedMediaQueries.clear(),this._fixCSS(e,!0))}},D.prototype._moveFixedPositionElement=function(t,e){if(!this.disablePositionFixedFix&&t.enabled){var i=e.vw,o=e.vh,s=t.el,n=t.doc.documentElement.getBoundingClientRect(),r=n.width,a=n.height,h=-n.top/e.viewScale,d=-n.left/e.viewScale,l=(a+n.top-o*e.viewScale)/e.viewScale,c=(r+n.left-i*e.viewScale)/e.viewScale,p=i,u=o;this.mobile&&(1.1<e.viewScale||e.viewScale<.9)&&(1!==t.width||1!==t.height)&&(c=l=d=h=0,p=r,u=a),t.width&&(s.style.width=Math.round(p*t.width)+"px"),t.height&&(s.style.height=Math.round(u*t.height)+"px"),t.top&&(s.style.top=Math.round(h+(t.top.offset+t.top.factor*o)/e.viewScale)+"px"),t.left&&(s.style.left=Math.round(d+(t.left.offset+t.left.factor*o)/e.viewScale)+"px"),t.bottom&&(s.style.bottom=Math.round(l-(t.bottom.offset+t.bottom.factor*o)/e.viewScale)+"px"),t.right&&(s.style.right=Math.round(c-(t.right.offset+t.right.factor*i)/e.viewScale)+"px")}},D.prototype._allMatchedRules=function(s){var t,e,n=[],i=s.ownerDocument,o=i.styleSheets,r=i.defaultView;function a(t){var e,i,o;for(e=0,i=t.length;e<i;e++)(o=t[e]).type===CSSRule.MEDIA_RULE?r.matchMedia(o.conditionText).matches&&a(o.cssRules):o.cssRules?a(o.cssRules):o.type===CSSRule.STYLE_RULE&&s.matches(o.selectorText)&&n.push(o)}for(t=0,e=o.length;t<e;t++)a(o[t].cssRules);return n};var N=function(t){this.elParent=t};N.prototype=Object.assign(N.prototype,{el:null,elParent:null,elSVG:null,elSVGCircle:null,elCaption:null,_timeout:null,_timeoutResolve:null}),N.prototype._initDOM=function(){this.el||(this.el=window.document.createElement("div"),this.el.id="counter",this.el.classList.add("hidden"),this.el.classList.add("center"),this.elParent.appendChild(this.el)),this.elSVG||(this.elSVG=window.document.createElementNS("http://www.w3.org/2000/svg","svg"),this.elSVG.id="graph",this.elSVG.setAttribute("viewBox","0 0 1 1"),this.el.appendChild(this.elSVG)),this.elCaption||(this.elCaption=window.document.createElement("div"),this.elCaption.id="caption",this.el.appendChild(this.elCaption)),this.elSVGCircle||(this.elSVGCircle=window.document.createElementNS("http://www.w3.org/2000/svg","circle"),this.elSVGCircle.id="c",this.elSVG.appendChild(this.elSVGCircle))},N.prototype.start=function(t,e,i,o){this._caption=t,this._duration=e,this._timeoutStart=Date.now(),this._timeoutResolve=i,this._timeout=window.setTimeout(function(){this.hide();var t=this._timeoutResolve;return delete this._duration,delete this._timeoutStart,delete this._timeoutResolve,delete this._timeout,t()}.bind(this),this._duration),this.show(t)},N.prototype.show=function(t){this._initDOM(),window.requestAnimationFrame(function(){this.el.classList.remove("hidden"),this.elCaption.textContent=t,window.requestAnimationFrame(function(){this.elSVGCircle.style.setProperty("stroke-dashoffset",0)}.bind(this))}.bind(this))},N.prototype.hide=function(){window.clearTimeout(this._timeout),delete this._timeout,this.el.classList.add("hidden"),this.elSVGCircle&&(this.elSVGCircle.remove(),delete this.elSVGCircle)},N.prototype.pause=function(){this._timeout&&(window.clearTimeout(this._timeout),delete this._timeout,this._duration-=Date.now()-this._timeoutStart,this.elSVGCircle.style.setProperty("stroke-dashoffset",getComputedStyle(this.elSVGCircle).strokeDashoffset),this.elSVGCircle.style.setProperty("transition-duration",this._duration+"ms"))},N.prototype.resume=function(){this._timeoutResolve&&this.start(this._caption,this._duration,this._timeoutResolve)};var L=function(){};function U(t){this.player=t,this.iframe=null,this.overlay=null,this.shade=null,this.counter=null,this.progress=null}function F(t,e,i,o,s){this.events=t,this.animWin=e,this.domWin=i,this.mouse=o,this.viewport=s,this.eventIndex=0,this.timeIndex=0,this.frames={0:new k(null,this.domWin)},this.cssmod=new D(s),this.handlers={},this.handlers[h.DOM_MODIFICATIONS]=this.modifyDOM.bind(this),this.handlers[h.PAGE_MARKER]=this.markPage.bind(this),this.handlers[h.PAGE_VISIBLE]=this.changePageVisible.bind(this),this.handlers[h.MOUSE_MOVE]=this.moveMouse.bind(this),this.handlers[h.WINDOW_MOUSEOUT_MOUSEENTER]=this.mouseEnterLeave.bind(this),this.handlers[h.MOUSE_CLICK]=this.clickMouse.bind(this),this.handlers[h.TOUCH]=this.touch.bind(this),this.handlers[h.MOUSE_DOWN]=this.mouseDown.bind(this),this.handlers[h.MOUSE_UP]=this.mouseUp.bind(this),this.handlers[h.ORIENTATION]=this.orientate.bind(this),this.handlers[h.ORIENTATION_CHANGE]=this.changeViewportOrientation.bind(this),this.handlers[h.ZOOM]=this.zoomViewport.bind(this),this.handlers[h.FRAME_SCROLL]=this.scrollViewport.bind(this),this.handlers[h.FRAME_SIZE]=this.resizeViewport.bind(this),this.handlers[h.SKIPTIME]=this.skipTime.bind(this),this.handlers[h.ASSET_ERROR]=this.assetError.bind(this),this.handlers[h.PAGE_ERROR]=this.pageError.bind(this),this.handlers[h.JAVASCRIPT_ERROR]=this.pageError.bind(this),this.handlers[h.NOT_RECORDED]=this.notRecorded.bind(this)}function B(t){this.iframe=t,this.doc=t.contentWindow.document,this.params={},this.viewScale=1,this.frameScale=1,this.bodyXOffset=0,this.onUpdate=new utils.FSEvent,this.forceUpdate=!0}function V(t){this.vwidth=t.vwidth,this.vheight=t.vheight,this.framerate=t.framerate,this.bitrate=t.bitrate,this.uploadPort=t.uploadPort,this.recording=!1,this.params=t,this.blobs=[],this.seq=0,this.asked=!1,this.startTime=-1,this.timeOffset=0}function _(t,e,i,o){this.sessionData=o,this.preplayer=!!i.uploadPort,this.loaded=!1,this.autoplay=e,this.pageNumber=t,this.frameTimer=null,this.capture=new V(i),this.iframe=null,this.busyEvents=0,this.preloaded=!1,this.cachedPageData={},this.ui=new U(this)}function G(t){console.log("rp: starting replay pose mode"),this.sessionData=t,this.cachedPageData={}}L.prototype=Object.assign(L.prototype,{el:null,elContainer:null}),L.prototype.init=function(t){t=Object.assign({width:0,height:0,transform:""},t);var e=this.el;e||((e=window.document.createElement("div")).classList.add("overlay"),e.style.setProperty("zoom","1.01"),this.elContainer=window.document.createElement("div"),this.elContainer.style.position="relative",this.elContainer.style.width="100%",this.elContainer.style.height="100%",e.appendChild(this.elContainer)),e.style.setProperty("width",t.width+"px"),e.style.setProperty("height",t.height+"px"),e.style.setProperty("transform",t.transform),this.el||(this.el=window.document.body.appendChild(e))},U.prototype.initialize=function(){this.fixUndefinedInPage(),this.setupPageTitle(),this.setupPageStyles(),this.setupPlaybackIframe(),this.setupOverlay(),this.setupClickHandler(),this.requestNotifyPermission()},U.prototype.requestNotifyPermission=function(){"granted"===Notification.permission||this.player.preplayer||Notification.requestPermission()},U.prototype.notify=function(t){if(console.log("rp: notify:",t),Notification&&!this.preplayer&&"granted"===Notification.permission)new Notification("cxReplay Web Playback",{icon:"/special_assets/notification.png",body:t})},U.prototype.loading=function(){return this.shade.show(),Promise.resolve()},U.prototype.updateProgress=function(t){t<100?(this.progress.show(),this.progress.update(t)):this.progress.hide()},U.prototype.advancePage=function(t){return this.shade.show(),new Promise(function(t,e){window.setTimeout(t,a.overlayShadeFadeTime)})},U.prototype.loadingDone=function(){return this.shade.hide(),this.progress.hide(),Promise.resolve()},U.prototype.skipTime=function(o){return new Promise(function(t,e){var i;this.counter.start((i=o,hh=~~(i/36e5),i-=36e5*hh,mm=~~(i/6e4),i-=6e4*mm,ss=~~(i/1e3),i-=1e3*ss,ms=~~(i/100),[hh<10?"0":"",hh,":",mm<10?"0":"",mm,":",ss<10?"0":"",ss,".",ms].join("")),a.overlayShadeSkipTime,t,e)}.bind(this))},U.prototype.pause=function(){this.counter.pause()},U.prototype.resume=function(){this.counter.resume()},U.prototype.endOfPlayback=function(){return this.shade.showEnd(),Promise.resolve()},F.prototype.load=function(t,e,i){this.viewport.update(e);var o={x:e.vx,y:e.vy};return this.frames[0].load(t,o).then(function(){return this.cssmod.updatedDOM(this.domWin.document)}.bind(this))},F.prototype.getCurrentEvent=function(){return this.events[this.eventIndex]},F.prototype.playNextEvent=function(){if(this.isDone())return Promise.resolve();var t=this.getCurrentEvent();return this.eventIndex++,this.isDone()||(this.timeIndex+=this.getCurrentEvent().td),this.dispatch(t).catch(function(t){console.error(t,t.stack)})},F.prototype.isDone=function(){return this.eventIndex>=this.events.length},F.prototype.timeToSkip=function(){return this.getCurrentEvent().e===h.SKIPTIME?this.getCurrentEvent().d.i:0},F.prototype.dispatch=function(t){var e=this.handlers[t.e];return e?e(t)||Promise.resolve():this.frames[t.d.ctx]?this.frames[t.d.ctx].dispatch(t):(console.error("Unhandled event type:",t),Promise.resolve())},F.prototype.markPage=function(t){if(0!==t.d.ctx)return this.iframeIntro(t);this.cssmod.mobile=t.d.mobile},F.prototype.iframeIntro=function(t){var e,i,o=t.d.ctx;if(this.frames[t.d.parent])if(e=this.frames[t.d.parent].getElement(o)){if(e.width=t.d.lw,e.height=t.d.lh,this.frames[o]=new k(e,e.contentWindow),t.d.doc){for(i=e.contentWindow.document.documentElement;i.childNodes.length;)i.removeChild(i.childNodes[0]);return this.frames[o].load(t.d.doc,t.d.scroll).then(function(){this.cssmod.updatedDOM(e.contentWindow.document)}.bind(this))}}else console.error("Unable to find iframe element for",o,t);else console.error("Unable to find parent frame for iframe",o,t)},F.prototype.modifyDOM=function(t){var e,i,o,s=[];if(!t.d.length)return console.error("Received empty DOM_MODIFICATIONS event!"),Promise.resolve();for(e=0;e<t.d.length;e++)i=t.d[e],this.frames[i.d.ctx]?(o=this.frames[i.d.ctx].window.document,s.push(this.frames[i.d.ctx].dispatch(i))):console.error("Unknown frame:",i.d.ctx,i);return Promise.all(s).then(function(){this.cssmod.updatedDOM(o),this.viewport.update({})}.bind(this))},F.prototype.moveMouse=function(t){this.mouse.setVisible(!0),this.mouse.setPos(t.p.x,t.p.y,t.spline)},F.prototype.mouseEnterLeave=function(t){this.mouse.setVisible(t.d.v)},F.prototype.clickMouse=function(t){this.mouse.click(t.p)},F.prototype.touch=function(t){switch(t.d.et){case"start":case"move":this.mouse.touchUpdate(t.d.ts);break;case"end":t.d.ts.length<1?this.mouse.touchEnd():this.mouse.touchUpdate(t.d.ts);break;case"cancel":case"leave":console.log("not sure what this means touch",t.d.et)}},F.prototype.mouseDown=function(t){this.mouse.mouseDown()},F.prototype.mouseUp=function(t){this.mouse.mouseUp()},F.prototype.orientate=function(t){},F.prototype.changeViewportOrientation=function(t){this.viewport.update({vw:t.d.vw,vh:t.d.vh,lw:t.d.lw,lh:t.d.lh})},F.prototype.zoomViewport=function(t){this.viewport.update({vw:t.d.vw,vh:t.d.vh,lw:t.d.lw,lh:t.d.lh})},F.prototype.resizeViewport=function(t){if(0!==t.d.ctx)return this.frames[t.d.ctx].dispatch(t);this.viewport.update({vw:t.d.vw,vh:t.d.vh,lw:t.d.w,lh:t.d.h})},F.prototype.scrollViewport=function(t){return this.frames[t.d.ctx].dispatch(t).then(function(){0===t.d.ctx&&this.viewport.update({vx:t.p.x,vy:t.p.y})}.bind(this))},F.prototype.changePageVisible=function(t){},F.prototype.skipTime=function(t){},F.prototype.assetError=function(t){console.warn("Error loading asset on recorded page: "+(t.d.a.src||t.d.a.href))},F.prototype.pageError=function(t){console.warn("Error on recorded page: "+(t.d.st||t.d.v))},F.prototype.notRecorded=function(t){return new Promise(function(t){setTimeout(t,5e3)})},B.prototype.update=function(t){var e=this.params;this.params=fs.ext({},this.params,t);var i=!1;(e.vw!==this.params.vw||e.vh!==this.params.vh||e.lw!==this.params.lw||e.lh!==this.params.lh||this.forceUpdate)&&(i=!0,this.resize()),this.forceUpdate=!1,e.vx===this.params.vx&&e.vy===this.params.vy||(i=!0),i&&(this.params.viewScale=this.viewScale,this.params.frameScale=this.frameScale,this.onUpdate.fire(this.params,this.doc))},B.prototype.dispose=function(){this.onUpdate.unsubscribeAll()},B.prototype.zoomedIframeSize=function(t,e){var i=t,o=e,s=document.documentElement.clientWidth-(20+2*a.playbackFrameBorder),n=document.documentElement.clientHeight-(20+2*a.playbackFrameBorder),r=Math.min(s/i,n/o);return{w:Math.ceil(t*r),h:Math.ceil(e*r),scale:r}},B.prototype.getIframeSize=function(t,e,i,o){var s=i,n=e*i/t;return{w:Math.round(s),h:Math.round(n)}},B.prototype.rezoom=function(t,e){var i=this.zoomedIframeSize(t,e).scale;this.iframe.style.transform="scale("+i+")",this.frameScale=i},B.prototype.resizeIframe=function(t,e,i,o){var s=this.getIframeSize(t,e,i,o);if(s.w>window.innerWidth){var n=s.w+20;document.body.style.width=n+"px",this.params.bodyXOffset=(window.innerWidth-n)/2,document.body.style.transform="translateX("+this.params.bodyXOffset+"px)"}else document.body.style.width="100%",document.body.style.removeProperty("transform"),this.params.bodyXOffset=0;this.iframe.setAttribute("width",s.w),this.iframe.setAttribute("height",s.h),this.rezoom(s.w,s.h)},B.prototype.resize=function(t){this.resizeIframe(this.params.vw,this.params.vh,this.params.lw,this.params.lh);var e=this.doc.documentElement.clientWidth,i=this.doc.documentElement.clientHeight,o=Math.min(e/this.params.vw,i/this.params.vh);this.doc.documentElement.style.transformOrigin=this.params.vx+"px "+this.params.vy+"px",this.doc.documentElement.style.transform="scale("+o+", "+o+") ",this.viewScale=o},V.prototype.pause=function(){return this._awaitRecorderAction("pause")},V.prototype.resume=function(){return this.recorder&&"paused"===this.recorder.state?this._awaitRecorderAction("resume"):this._awaitRecorderAction("start",1e4)},V.prototype.stop=function(){return this._awaitRecorderAction("stop")},V.prototype.setup=function(){return this.recorder?Promise.resolve():this.asked?Promise.resolve():(this.asked=!0,this._setTitleToKnownValue(),this._getSourceId().then(function(t){return this._restoreTitle(),this._getUserMedia(t)}.bind(this)).then(this._setupMediaRecorder.bind(this)).catch(function(t){this._restoreTitle(),console.warn("Unable to capture video: "+t)}.bind(this)))},V.prototype._setTitleToKnownValue=function(){var t=document.getElementsByTagName("title")[0];this.previousTitle=t.innerHTML,t.innerText="Choose-this-tab"},V.prototype._restoreTitle=function(){document.getElementsByTagName("title")[0].innerHTML=this.previousTitle,delete this.previousTitle},V.prototype._getSourceId=function(){return new Promise(function(e,i){var o=setTimeout(function(){window.removeEventListener("message",s),"https:"===location.protocol?i(new Error("Install simpleCapture browser extension")):i(new Error("Needs to be https"))},500),s=function(t){t.origin===window.location.origin&&("ohai-webpage"===t.data&&(clearTimeout(o),window.postMessage("get-simple-capture-source","*")),!t.data.length&&"sourceId"in t.data&&(window.removeEventListener("message",s),t.data.sourceId?e(t.data.sourceId):i(new Error("Permission denied (maybe need --allow-http-screen-capture?)"))))};window.addEventListener("message",s),window.postMessage("ohai-simple-capture","*")})},V.prototype._getUserMedia=function(t){var e={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxWidth:this.vwidth,maxHeight:this.vheight,maxFrameRate:this.framerate}}};return console.log("Asking for these constraints: "+JSON.stringify(e,null,2)),navigator.mediaDevices.getUserMedia(e)},V.prototype._setupMediaRecorder=function(t){this.stream=t,console.log("Success getting a stream with these settings: "+JSON.stringify(t.getVideoTracks()[0].getSettings(),null,2)),this.recorder=new MediaRecorder(t,{mimeType:"video/webm;codecs=h264",videoBitsPerSecond:this.bitrate}),this.recorder.addEventListener("dataavailable",this._onDataAvailable.bind(this),!1),this.recorder.addEventListener("stop",this._onRecordingStop.bind(this),!1),this.recorder.addEventListener("error",this._onRecordingError.bind(this),!1),this.recorder.addEventListener("start",function(t){this.blobs=[],this.timeOffset=0,this.startTime=t.timeStamp,this.recording=!0}.bind(this),!1),this.recorder.addEventListener("stop",function(t){-1<this.startTime&&(this.timeOffset+=t.timeStamp-this.startTime),this.startTime=-1,this.recording=!1}.bind(this),!1),this.recorder.addEventListener("resume",function(t){this.startTime<0&&(this.startTime=t.timeStamp),this.recording=!0}.bind(this),!1),this.recorder.addEventListener("pause",function(t){-1<this.startTime&&(this.timeOffset+=t.timeStamp-this.startTime),this.startTime=-1,this.recording=!1}.bind(this),!1)},V.prototype.getDuration=function(){return this.startTime<0?this.timeOffset:this.timeOffset+(performance.now()-this.startTime)},V.prototype._onDataAvailable=function(t){console.log("Data available: "+this.seq+" duration here: "+this.getDuration()),this.uploadPort?this._uploadScreenCapture(this.seq,t.data):this.blobs.push(t.data),this.seq+=1},V.prototype._onRecordingStop=function(t){this.uploadPort||this._downloadScreenCapture(),this.recorder=null,this.stream.getTracks()[0].stop(),this.stream=null},V.prototype._onRecordingError=function(t){console.log("Recording error: "+t.message)},V.prototype._awaitRecorderAction=function(s,n){var r=this.recorder;return r?new Promise(function(t,e){var i=function(){r.removeEventListener(s,i,!1),r.removeEventListener("error",o,!1),t()}.bind(this),o=function(){r.removeEventListener(s,i,!1),r.removeEventListener("error",o,!1),e()}.bind(this);r.addEventListener(s,i,!1),r.addEventListener("error",o,!1),"start"==s?this.recorder.start(n):r[s]()}.bind(this)):Promise.resolve()},V.prototype._downloadScreenCapture=function(){var t=new Blob(this.blobs,{type:"video/webm"}),e=window.URL.createObjectURL(t),i=document.createElement("a");i.id="fsrVideoDownloadLink",i.style="display:none;",i.href=e,i.download="recording-"+Date.now()+".webm",i.innerText="Download Video Here",document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(e),console.log("Replay entirely finished")},V.prototype._uploadScreenCapture=function(t,e){if(this.uploading)this.blobs.push({seq:t,data:e});else{this.uploading=!0;var i=function(){if(this.uploading=!1,0<this.blobs.length){this.blobs.sort(function(t,e){return t.seq-e.seq});var t=this.blobs.shift();this._uploadScreenCapture(t.seq,t.data)}else this.recorder&&"inactive"!==this.recorder.state||this.finishUploading()}.bind(this),o="http://localhost:"+this.uploadPort+"/upload/"+t;console.log("Uploading blob "+t+" to "+o),(new utils.AjaxTransport)._sendViaXHR({method:"POST",url:o,contentType:"video/webm",skipEncode:!0,data:e,success:i,failure:i})}},V.prototype.finishUploading=function(){var t=function(){console.log("Replay entirely finished")}.bind(this);(new utils.AjaxTransport).send({method:"POST",url:"http://localhost:"+this.uploadPort+"/upload/done",contentType:"video/webm",skipEncode:!0,data:"",success:t,failure:t})},_.prototype.initialize=function(){this.ui.initialize(),this.ui.updatePageTitle(this.sessionData),this.iframe=this.ui.iframe},_.prototype.signalMessage=function(){var t=Array.prototype.slice.call(arguments,0);fs.nextTick(function(){console.log("PPCMD:"+btoa(JSON.stringify({cmds:t})))})},_.prototype.load=function(){return this.paused=!0,this.loaded=!1,this.playbackFinished=!1,this.timeOffset=0,this.timeStart=0,this.ui.loading().then(function(){return this.loadThisPageData()}.bind(this)).then(function(){if(!this.preloaded)return this.preloaded=!0,this.preloadAll()}.bind(this)).then(function(){return this.ui.clearPlaybackIframe(this.data)}.bind(this)).then(function(){return this.loadWorker()}.bind(this)).then(function(){return this.capture.setup()}.bind(this)).then(function(){return this.finishLoading()}.bind(this)).then(function(){return this.ui.loadingDone()}.bind(this)).catch(function(t){console.error(t.stack)})},_.prototype.loadThisPageData=function(){return this.loadPageData(this.sessionData).then(function(t){this.data=t}.bind(this)).catch(function(){this.data=null}.bind(this))},_.prototype.loadPageData=function(s){return this.cachedPageData[s.page_number]?Promise.resolve(this.cachedPageData[s.page_number]):new Promise(function(i,o){(new utils.AjaxTransport).send({method:"GET",url:"/replay/page_data",data:s,success:function(t){var e=JSON.parse(t);this.cachedPageData[s.page_number]=e,i(e)}.bind(this),failure:function(t,e){o(new Error("Failed to fetch pageData: "+e[0]))}.bind(this)})}.bind(this))},_.prototype.preloadAll=function(){for(var t=[],e=this.sessionData.page_number+1;e<this.data.totalPageCount;e++)t.push(this.loadPageData(fs.ext({},this.sessionData,{page_number:e})));return Promise.all(t).then(function(t){t.unshift(this.data);var e=new T;return e.onProgress.subscribe(function(t){this.ui.updateProgress(t)}.bind(this),!1,!0),e.preloadAll(t)}.bind(this))},_.prototype.loadWorker=function(){this.viewport&&this.viewport.dispose(),this.viewport=new B(this.iframe),-1<this.data.url.indexOf("//online.citi.com")&&(this.viewport.disablePositionFixedFix=!0),this.mouse&&this.mouse.dispose(),this.mouse=new A(this.viewport,window,this.iframe);var t=window,e=this.iframe.contentWindow;this.worker=new F(this.data.events,t,e,this.mouse,this.viewport);var i={dw:this.data.deviceSize.width,dh:this.data.deviceSize.height,lw:this.data.initialFrameSize.width||640,lh:this.data.initialFrameSize.height||480,vw:this.data.initialViewportSize.width||640,vh:this.data.initialViewportSize.height||480,vx:this.data.initialScrollPosition.x,vy:this.data.initialScrollPosition.y};return this.worker.load(this.data.initialDOM,i,this.data.knownAssetsProxied)},_.prototype.finishLoading=function(){this.loaded=!0,this.autoplay?(this.videoSyncUp("pagescenestart"),fs.nextTick(this.resume.bind(this))):this.ui.notify("Waiting for left-click to start!")},_.prototype.hasMorePages=function(){return this.pageNumber+1<this.data.totalPageCount},_.prototype.advancePage=function(){return this.hasMorePages()?(this.ui.notify("Navigating to page "+(this.pageNumber+1)),(this._pausePromise||Promise.resolve()).then(function(){return this._pausePromise=null,this.ui.advancePage(this.pageNumber)}.bind(this)).then(function(){var t=window.location.toString();-1<t.indexOf("page_number=")?t=t.replace("page_number="+this.pageNumber,"page_number="+(this.pageNumber+1)):t+="&page_number="+(this.pageNumber+1),window.history.pushState({},"",t),this.pageNumber+=1,this.sessionData.page_number=this.pageNumber,this.ui.updatePageTitle(this.sessionData)}.bind(this)).then(this.load.bind(this))):(this.ui.notify("No more pages"),Promise.resolve())},_.prototype.getTimeIndex=function(){return this.paused?this.timeOffset:utils.now()-this.timeStart+this.timeOffset},_.prototype.pause=function(){if(!this.paused)return this.paused=!0,this.frameTimer&&(clearTimeout(this.frameTimer),this.frameTimer=null),this.timeOffset+=utils.now()-this.timeStart,this.ui.pause(),this.capture.pause()},_.prototype.videoSyncUp=function(t){t=t||"SYNC",this.signalMessage({command:t,videoTimeIndex:Math.round(this.capture.getDuration()),playbackTime:this.getTimeIndex(),eventIndex:this.eventIndex,pageNumber:this.pageNumber})},_.prototype.resume=function(){this.paused&&(this.paused=!1,this.timeStart=utils.now(),this.capture.resume().then(this.playNextEvent.bind(this)),this.ui.resume())},_.prototype.playNextEvent=function(){if(!this.paused){if(this.getTimeIndex()<this.worker.timeIndex)return this.busyEvents=0,void this.awaitNextFrame();if(this.busyEvents++,this.worker.isDone())this.finishPlayback();else{var t,e=this.worker.timeToSkip();0<e?(this.ui.notify("Skipping "+e+" ms"),t=this.ui.skipTime(e),(e-=a.overlayShadeSkipTime)<0&&(e=0)):t=Promise.resolve(),t.then(function(){return this.timeOffset+=e,this.worker.playNextEvent()}.bind(this)).then(function(){10<=this.busyEvents?(this.busyEvents=0,window.requestAnimationFrame(this.playNextEvent.bind(this))):this.playNextEvent()}.bind(this))}}},_.prototype.awaitNextFrame=function(){var t=this.worker.timeIndex-this.getTimeIndex();t<0&&(t=0),this.frameTimer=setTimeout(this.playNextEvent.bind(this),t)},_.prototype.finishPlayback=function(){this.videoSyncUp(),this._pausePromise=this.pause(),this.hasMorePages()||(this.ui.notify("Playback finished"),this.ui.endOfPlayback()),this.playbackFinished=!0,this.videoSyncUp("pagesceneend"),this.autoplay&&this.hasMorePages()?this.advancePage():this.capture.stop()},G.prototype.load=function(){return Promise.resolve().then(function(){return console.log("loading page data"),this.loadThisPageData()}.bind(this)).then(function(){return this.preloadAll()}.bind(this)).then(function(){return this.clearDOM()}.bind(this)).then(function(){return this.loadInitialDOM()}.bind(this)).then(function(){return this.signalReadyForPicture()}.bind(this)).catch(function(t){console.error(t.stack)})},G.prototype.loadThisPageData=_.prototype.loadThisPageData,G.prototype.loadPageData=_.prototype.loadPageData,G.prototype.preloadAll=function(){return console.log("preloading assets"),(new T).preloadAll([this.data])},G.prototype.clearDOM=function(){for(var t=window.document.documentElement.children;0<t.length;)window.document.documentElement.removeChild(t[0])},G.prototype.loadInitialDOM=function(){return this.domreplay=new o(window.document.documentElement),this.domreplay.initialLoad=!1,this.domreplay.import(this.data.initialDOM),console.log("waiting for the DOM to completely load"),this.domreplay.waitForLoad()},G.prototype.signalReadyForPicture=function(){console.log("ready for picture")},U.prototype.setupPlaybackIframe=function(){this.iframe=document.createElement("iframe"),this.iframe.id="playback",this.iframe.width=window.innerWidth-20,this.iframe.height=window.innerHeight-20,new ResizeObserver(function(){this.overlay.init({width:this.iframe.width,height:this.iframe.height,transform:this.iframe.style.transform})}.bind(this)).observe(this.iframe),document.body.appendChild(this.iframe)},U.prototype.clearPlaybackIframe=function(i){return new Promise(function(t){var e=function(){this.iframe.removeEventListener("load",e,!1),t()}.bind(this);this.iframe.addEventListener("load",e,!1),this.iframe.srcdoc=(i.docType||"<!DOCTYPE html>")+"<html></html>"}.bind(this)).then(function(){var t=this.iframe.contentWindow.document,e=t.head;e.parentNode.removeChild(e);var i=t.body;i.parentNode.removeChild(i),this.setupClickHandler()}.bind(this))};var z,Q=new utils.Browser;fs.winReady(function(){Q.ready.subscribe(function(){var t=JSON.parse(atob(fs.embedAttrs["data-sessioninfo"]));if("true"===(fs.getParam("pose")||"false")){var e=new G(t);return z=e,void fs.nextTick(e.load.bind(e))}var i=(fs.getParam("autoplay")||"true").toLowerCase();i="true"==i;var o={vwidth:parseInt(fs.getParam("vwidth")||"1280",10),vheight:parseInt(fs.getParam("vheight")||"720",10),framerate:parseInt(fs.getParam("framerate")||"30",10),bitrate:parseInt(fs.getParam("bitrate")||"2500000",10),uploadPort:parseInt(fs.getParam("uploadport")||"0",10)};window.player=z=new _(t.page_number,i,o,t),z.initialize(),fs.nextTick(z.load.bind(z))},!0,!0)})});