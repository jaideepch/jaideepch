/***************************************
* @preserve
* ForeSee Web SDK: Feedback Standalone Survey
* Built April 27, 19 21:55:14
* Code version: 19.5.2
* Template version: 19.5.2
***************************************/
_fsDefine(["require","fs",_fsNormalizeUrl("$fs.utils.js"),_fsNormalizeUrl("$fs.survey.js")],function(t,e,i,s){/**
   * @preserve
   * @@CONFIG_GOES_HERE@@
   */
var r={remove:function(){this.parentNode&&this.parentNode.removeChild(this)},hasClass:function(t){return this.className.indexOf(t)>-1},addClass:function(t){this.hasClass(t)||(this.className+=" "+t)},removeClass:function(t){this.className=(this.className||"").replace(t,""),this.className=this.className.replace(/[ ]+$/g,"")},$:function(t){return this.querySelectorAll(t)},css:function(t){for(var e in t)t.hasOwnProperty(e)&&(this.style[e]=t[e])}},n=function(t){if("string"==typeof t&&-1==t.indexOf("<"))return document.querySelectorAll(t);if("string"==typeof t){var e=document.createElement("div");e.innerHTML=t,t=e.firstChild}for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i]);return t},o=function(){this.$el=n('<img src="'+_fsNormalizeUrl("$loader.gif")+'" class="acs-loader">'),this.$el.setAttribute("alt","loading survey"),this.$el.setAttribute("tabindex","-1"),this.moveOffScreen()};o.prototype.center=function(){var t=i.getSize(window),e=i.getScroll(window),s=this.$el.offsetWidth,r=this.$el.offsetHeight;this.$el.css({left:(t.w-s)/2+"px",top:(t.h-r)/2+e.y+"px",opacity:1,position:"absolute"})},o.prototype.moveOffScreen=function(){this.$el.css({left:"-999px",top:"-999px",opacity:0})},o.prototype.remove=function(){this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)};var a=function(t,e){var i;return i=new window.Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"),e?i(e):i},c=function(t,r,a,c,h,l,d){var u;if(this.isStandalone=d,this.cpps=new p(l),this.networkError=new i.FSEvent,h){!e.isObject(h)&&h.length>2&&(h=JSON.parse(i.Compress.decompress(h)));for(var f in h)this.cpps.set(f,h[f])}if(this.br=r,this.didSubmit=!1,this.loader=new o,document.body.appendChild(this.loader.$el),t&&t.instances&&t.instances.length)for(var m=0;m<t.instances.length;m++)if(t.instances[m].mid==c){u=this.cfg=t.instances[m];break}if(void 0===u&&(t.preview||"preview"===l)){var v=e.getParam("datauri"),y=e.getParam("template")||"default";u=this.cfg={mid:c,datauri:v,posturi:"",reporturi:"",surveytype:"popup",autowhitelist:!0,preview:!0,template:y,replay:!1}}if(u){var g=this,b=r.isIE&&10==r.browser.actualVersion?" acsIE10":"";document.title=this.cfg.label,this.jrny=a,this.sv=new s.SurveyBuilder(this.cfg,this.cpps,this.br),this.sv.cfg.privacyuri=this.sv.cfg.privacyuri?this.sv.cfg.privacyuri:"http://www.foresee.com/about-us/privacy-policy/",this.sv.cfg.privacytext=this.sv.cfg.privacytext?this.sv.cfg.privacytext:"Privacy policy",this.$content=n('<div class="acsMainContainerMobile--'+u.template+b+'"></div>'),r.isMobile&&g.jrny&&g.jrny.addEventObj({name:"feedback_clicked_mobile",properties:{mid:[g.cfg.mid]}}),this.networkError.subscribe(e.proxy(function(t){g.jrny&&(t&&t.type?g.jrny.addEventObj({name:"survey_"+t.type,properties:{mid:[g.cfg.mid]}}):g.jrny.addEventObj({name:"server_error",properties:{mid:[g.cfg.mid]}})),this.renderError(t.type)},this)),this.initQ=new i.Async(!0,e.proxy(function(){this._getTemplatesAndRender()},this),e.proxy(function(){window.close()},this)),this.initQ.enqueue(e.proxy(function(t){this._getCSS(t)},this)),this.initQ.enqueue(e.proxy(function(t){this._getTemplate("serviceunavailable",t,e.proxy(function(t){this.errTemplate=t},this))},this))}i.Bind(window,"unload",function(){!g.didSubmit&&g.jrny&&g.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[g.cfg.mid]}})})};c.prototype._getTemplatesAndRender=function(){var t=new i.Async(!0,e.proxy(function(){this.renderSurvey()},this),e.proxy(function(){this.renderError()},this));t.enqueue(e.proxy(function(t){this._getSurveyData(e.proxy(function(e){this.survey=e,t.resolve()},this))},this)),t.enqueue(e.proxy(function(t){this._getTemplate("epilogue",t,e.proxy(function(t){this.epTemplate=t},this))},this)),t.enqueue(e.proxy(function(t){this._getTemplate("surveycontents",t,e.proxy(function(t){this.svContentsTemplate=t},this))},this)),t.enqueue(e.proxy(function(t){i.Healthy(this.br,["survey","static"],t.resolve,t.error)},this))},c.prototype._getCSS=function(t){i.loadCSS(_fsNormalizeUrl("$templates/feedback/"+(this.sv.cfg.template||"default")+"/main.css"),function(e){e?t.resolve():t.error()},null,this.br)},c.prototype._getTemplate=function(t,s,r){var n=this.cfg.template||"default",o=_fsNormalizeUrl("$templates/feedback/"+n+"/"+t+".html");new i.JSONP({success:e.proxy(function(t){r(t),s&&s.resolve()},this),failure:e.proxy(function(t){s&&s.error()},this)}).get(o,"templates_feedback_"+n+"_")},c.prototype._showThankyou=function(){var t=this,e=a(this.epTemplate,this.survey);t.didSubmit=!0,this.$content.innerHTML=e;for(var s=this.$content.$("h1"),r=0;r<s.length;r++)n(s[r]).addClass("acs-feedback__heading acs-feedback__heading--h1");var o=this.$content.$(".acs-close-button")[0];this.cfg.preview||i.Bind(o,"click",function(){window.close()}),this.hideLoad()},c.prototype.showLoad=function(){this.loader.center(),this.$content.css({opacity:0})},c.prototype.hideLoad=function(){this.loader.moveOffScreen(),i.hasClass(this.loader.$el,"acs-loader")&&this.loader.$el.setAttribute("aria-hidden",!0),this.$content.css({opacity:1})},c.prototype.renderSurvey=function(){var t=this;t.jrny&&t.jrny.addEventObj({name:"feedback_survey_shown",properties:{mid:[t.cfg.mid]}});var s=n("#acsPleaseWaitTable")[0];s.parentNode.removeChild(s),this.survey.ansLogoSrc=_fsNormalizeUrl("$p_b_foresee.svg");var r=a(this.svContentsTemplate,this.survey);this.$content.innerHTML=r,window.document.body.appendChild(this.$content),this.sv.bind(this.$content),this.sv.SubmitClicked.subscribe(e.proxy(function(){this.showLoad(),t.jrny&&t.jrny.addEventObj({name:"feedback_submitted",properties:{mid:[t.cfg.mid]}}),i.Healthy(this.br,["survey","static"],e.proxy(function(){this._postSurveyData(e.proxy(function(t){t?(this.cfg.preview||h.processImmediate(),this._showThankyou()):this.networkError.fire({type:"postdata_failed"})},this))},this),e.proxy(function(){this.networkError.fire({type:"postdata_failed"})},this))},this)),this.hideLoad()},c.prototype.renderError=function(t){this.$content.innerHTML=a(this.errTemplate,this.sv);var e=this.$content.$(".acs-serviceunavailable__message")[0];if("expired"===t){for(;e.firstChild;)e.removeChild(e.firstChild);this.sv.cfg.fbexpiremessage?e.appendChild(n("<p>"+this.sv.cfg.fbexpiremessage+"</p>")):e.appendChild(n(this._unencodeHTML(this.sv.defaultCfg.expired)))}else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(n(this._unencodeHTML(this.sv.defaultCfg.unavailable)))}document.body.appendChild(this.$content);for(var s=this.$content.$("h3"),r=0;r<s.length;r++)n(s[r]).addClass("acs-feedback__heading acs-feedback__heading--h1");var o=this.$content.$(".acs-close-button")[0];this.cfg.preview||i.Bind(o,"click",function(){window.close()}),this.hideLoad();var c=n("#acsPleaseWaitTable")[0];c&&c.parentNode.removeChild(c)},c.prototype._unencodeHTML=function(t){var e=/&lt;/gi,i=/&gt;/gi;return t.replace(e,"<").replace(i,">")},c.prototype._getSurveyData=function(t){if(this.sv.isExpired())this.networkError.fire({type:"expired"});else{this._surveyTimer=setTimeout(e.proxy(function(){this.networkError.fire({type:"timedout"})},this),1e4);new i.AjaxTransport({url:this.cfg.datauri,method:"GET",success:e.proxy(function(i){this.networkError.didFire||(clearTimeout(this._surveyTimer),this.sv.SurveyData.fire(i,e.proxy(function(e){t&&t(e)},this)))},this),failure:e.proxy(function(t){clearTimeout(this._surveyTimer),this.networkError.fire({type:"getdata_failed"})},this)}).send({data:{mid:this.cfg.mid,cachebust:(new Date).getTime(),version:this.cfg.version}})}},c.prototype._postSurveyData=function(t){if(this.cfg.preview)return void e.nextTick(function(){t&&t(!0)});this._surveyTimer=setTimeout(e.proxy(function(){this.networkError.fire({type:"timedout"})},this),1e4);var s,r=new i.AjaxTransport({url:this.sv.cfg.posturi,method:"POST",success:e.proxy(function(e){clearTimeout(this._surveyTimer),t&&t(!0)},this),failure:e.proxy(function(e){clearTimeout(this._surveyTimer),sessionStorage.setItem("acsFeedbackSubmitted","true"),t&&t(!1)},this)}),n=JSON.parse(this.sv._serialize());e.isArray(n.responses)&&n.responses.push({questionId:"deployment_type",answerText:this.isStandalone?"URL":"BADGE"}),s=i.Compress.compress(JSON.stringify(e.ext({rating:this.sv._getScore()},n))),this.isStandalone||(window.location.hash="fsSurveyComplete="+encodeURIComponent(s)),r.send({data:n,skipEncode:!0,contentType:"application/json"})};var h={cxrid:e.getParam("cxrid"),cxrurl:e.getParam("cxrurl"),processImmediate:function(){if(h.cxrid&&h.cxrurl){(new i.AjaxTransport).send({method:"GET",url:i.sign(h.cxrurl+"process/"+e.enc(h.cxrid)),failure:e.proxy(function(t){},this),success:e.proxy(function(t){},this)})}}},p=function(t){this.ns=t};p.prototype={set:function(t,i){if(e.supportsDomStorage){var s=JSON.parse(localStorage.getItem(this.ns)||"{}");s[t]=i,localStorage.setItem(this.ns,JSON.stringify(s))}},get:function(t){return JSON.parse(localStorage.getItem(this.ns)||"{}")[t]},all:function(){return JSON.parse(localStorage.getItem(this.ns)||"{}")}},function(t,e,i){this.from=t,this.to=e,this.diff=this.to-this.from,this.callback=i||function(){}}.prototype={_tween:function(t){return--t*t*t+1},go:function(t){this.stop(),this.tm=t,this.startTime=new Date,this.timer=setInterval(Utils.bind(function(){var t=new Date,e=t-this.startTime,i=Math.min(e/this.tm,1),s=this._tween(i);i>=1&&(clearInterval(this.timer),this.timer=null),this.val=s*this.diff+this.from,this.callback(this.val)},this),20)},stop:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},e.winReady(function(){var t=new i.Browser;t.ready.subscribe(function(){var s,r,n,o,a,h,p,config,l,d,u=document.getElementsByTagName("head")[0];if("true"==u.getAttribute("data-isstandalone")){var f,m={};location.search.substring(1).split("&").forEach(function(t,e,i){(f=t.match(/cpp\[([\d\w]*)\]=([\d\w\'\"]*)/i))&&(m[f[1]]=f[2])}),s=u.getAttribute("data-cid"),n=u.getAttribute("data-mid"),o=u.getAttribute("data-url"),h=u.getAttribute("data-post-url"),a=u.getAttribute("data-version"),config={cxReplay:!1,instances:[{autowhitelist:!0,datauri:o,delay:0,disabled:!0,fbanimate:!1,fbdirection:"horizontal",fbfixed:!1,fblocation:"middleright",fbtype:"badge",icon:"aspark100.png",label:"Feedback",mid:n,popup:!0,posturi:h,reporturi:"https://voc.foresee.com/client/feedback-admin/summary",saved:null,template:"default",topics:[{answerId:"",id:"1",order:1,topicText:"Default Topic",whitelistActive:!1}],version:a||1}]},new c(config,t,null,n,m,"fs",!0)}else s=e.getParam("cid"),r=i.APPID.FEEDBACK,p=e.getParam("uid"),l="preview"===e.getParam("ns")?null:new i.Journey(s,r,p,t),d=JSON.parse(e.dec(i.Compress.decompress(e.gwConfigOverride))),d=e.ext({global:i.defaultConfigs.global},d),d.product&&d.product.instances&&(d.product.instances=d.product.instances.map(function(t){return e.ext({},i.defaultConfigs.survey,t)})),config=d.product||{},new c(config,t,l,e.getParam("mid"),e.getParam("cpps"),e.getParam("ns"),!1)},!0,!0)})});